<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running on Atos · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/System/ECMWF/RunningHarmonieOnAtos/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../../Overview/da_graph/">Graphical Overview</a></li><li class="is-active"><a class="tocitem" href>Running on Atos</a><ul class="internal"><li><a class="tocitem" href="#Before-you-start"><span>Before you start</span></a></li><li><a class="tocitem" href="#Configure-your-experiment-(option-1)"><span>Configure your experiment (option 1)</span></a></li><li><a class="tocitem" href="#Configure-your-experiment-using-github-repo-(option-2)"><span>Configure your experiment using github repo (option 2)</span></a></li><li><a class="tocitem" href="#Start-your-experiment"><span>Start your experiment</span></a></li><li><a class="tocitem" href="#Continue-your-experiment"><span>Continue your experiment</span></a></li><li><a class="tocitem" href="#Start/Restart-of-ecflow_ui"><span>Start/Restart of <code>ecflow_ui</code></span></a></li><li><a class="tocitem" href="#Making-local-changes"><span>Making local changes</span></a></li><li><a class="tocitem" href="#Issues"><span>Issues</span></a></li><li><a class="tocitem" href="#Directory-structure"><span>Directory structure</span></a></li><li><a class="tocitem" href="#Cleanup-of-old-experiments"><span>Cleanup of old experiments</span></a></li><li class="toplevel"><a class="tocitem" href="#Debugging-Harmonie-with-ARM-DDT"><span>Debugging Harmonie with ARM DDT</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../../DataAssimilation/MTEN/">MTEN</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Forecast(spin-up)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/CHKEVO/">CHKEVO</a></li><li><a class="tocitem" href="../../../DataAssimilation/NWECHKEVO/">NWECHKEVO</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-5-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../../EPS/System/">System</a></li><li><a class="tocitem" href="../../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href>Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../DrHook/">DrHook</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href>Running on Atos</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running on Atos</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/System/ECMWF/RunningHarmonieOnAtos.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-Harmonie-on-Atos"><a class="docs-heading-anchor" href="#Running-Harmonie-on-Atos">Running Harmonie on Atos</a><a id="Running-Harmonie-on-Atos-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Harmonie-on-Atos" title="Permalink"></a></h1><h2 id="Before-you-start"><a class="docs-heading-anchor" href="#Before-you-start">Before you start</a><a id="Before-you-start-1"></a><a class="docs-heading-anchor-permalink" href="#Before-you-start" title="Permalink"></a></h2><p>New Harmonie users will require membership of the accord user group at ECMWF. Please contact the HIRLAM System Manager, Daniel Santos, to make this request on your behalf. Futhermore ECMWF will have to setup a virtual machine for you to run the ecFlow server on (see <a href="../../../SuiteManagement/ECFLOW/#ecflow">here</a>). Finally, make sure that your login shell is set to <code>/bin/bash</code>.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To share your experiments with the members of the accord group do: </p><pre><code class="nohighlight hljs">chmod 755 $HOME $SCRATCH $PERM $HPCPERM
chgrp -R accord $HOME/hm_home $SCRATCH/hm_home $PERM/HARMONIE $HPCPERM/hm_home
chmod g+s $HOME/hm_home $SCRATCH/hm_home $PERM/HARMONIE $HPCPERM/hm_home</code></pre><p>The <code>chmod g+s</code> sets the <a href="https://linuxhandbook.com/suid-sgid-sticky-bit/">SGID</a> bit which will ensure that new experiments created in <code>hm_home</code> will automatically be in the <code>accord</code> group</p></div></div><h2 id="Configure-your-experiment-(option-1)"><a class="docs-heading-anchor" href="#Configure-your-experiment-(option-1)">Configure your experiment (option 1)</a><a id="Configure-your-experiment-(option-1)-1"></a><a class="docs-heading-anchor-permalink" href="#Configure-your-experiment-(option-1)" title="Permalink"></a></h2><ul><li><p>Create an experiment directory under <code>$HOME/hm_home</code> and use the master script Harmonie to set up a minimum environment for your experiment. </p><pre><code class="nohighlight hljs">mkdir -p $HOME/hm_home/my_exp
cd $HOME/hm_home/my_exp
ln -sf /path/to/git/repository/config-sh/Harmonie
./Harmonie setup -r /path/to/git/repository -h ECMWF.atos</code></pre><p>where    </p><ul><li><code>-r</code> Specifies the path to the git repository. Make sure you have <code>checkout</code>-ed the correct branch. </li><li><code>-h</code> tells which configuration files to use. At ECMWF <code>config.ECMWF.atos</code> is the default one. For <code>harmonie-43h2.2</code> use <code>-h config.aa</code><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>An Atos tagged versions of Harmonie are available in <code>~hlam/harmonie_release/git/tags/</code></p><pre><code class="nohighlight hljs">ln -sf ~hlam/harmonie_release/git/tags/&lt;taggedversion&gt; 
Harmonie setup -r ~hlam/harmonie_release/git/tags/&lt;taggedversion&gt;  -h ECMWF.atos</code></pre></div></div></li></ul></li></ul><ul><li>This would give you the default setup which currently is <code>AROME</code> physics with <code>CANARI+OI_MAIN</code> surface assimilation and 3DVAR upper air assimilations with 3h cycling on a domain covering Denmark using 2.5km horizontal resolution and 65 levels in the vertical.</li><li>Now you can edit the basic configuration file <code>ecf/config_exp.h</code> to configure your experiment scenarios. Modify specifications for domain, data locations, settings for dynamics, physics, coupling host model etc. Read more about the options <a href="../../../ExperimentConfiguration/ConfigureYourExperiment/#configure-your-experiment">here</a>. You can also use some of the predefined configurations by calling Harmonie with the <code>-c</code> option:<pre><code class="nohighlight hljs">./Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST -c CONFIG -d DOMAIN</code></pre>where <code>CONFIG</code> is one of the setups defined in <code>scr/Harmonie_configurations.pm</code>. If you give <code>-c</code> without an argument or a non existing configuration a list of configurations will be printed.</li><li>In some cases you might have to edit the general system configuration file <code>config-sh/config.ECMWF.atos</code>. See <a href="../../../ExperimentConfiguration/PlatformConfiguration/#platform-configuration">here</a> for further information. </li><li>The rules for how to submit jobs on Atos are defined in <code>config-sh/submit.ECMWF.atos</code>. See <a href="../../../ExperimentConfiguration/PlatformConfiguration/#platform-configuration">here</a> for further information</li><li>If you experiment in data assimilation you might also want to change settings in <code>scr/include.ass</code>.</li></ul><h2 id="Configure-your-experiment-using-github-repo-(option-2)"><a class="docs-heading-anchor" href="#Configure-your-experiment-using-github-repo-(option-2)">Configure your experiment using github repo (option 2)</a><a id="Configure-your-experiment-using-github-repo-(option-2)-1"></a><a class="docs-heading-anchor-permalink" href="#Configure-your-experiment-using-github-repo-(option-2)" title="Permalink"></a></h2><p>Disadvantage of option 1 for version control in git is that code is located in two places. Instead you can :  </p><ul><li>Make a fork of the Harmonie repository. From now we assume your fork will be located at <code>https://github.com/&lt;user&gt;/Harmonie</code>.</li><li>Log in to ATOS as usual and perform the following commands:</li></ul><pre><code class="language-sh hljs">mkdir -p $PERM/hm_home &amp;&amp; cd $PERM/hm_home/
git clone -b &lt;remote_branch&gt; git@github.com:&lt;user&gt;/Harmonie.git  &lt;exp_name&gt;
cd &lt;exp_name&gt;
git checkout -b &lt;feature/branch_name&gt;
export PERL5LIB=$(pwd)
config-sh/Harmonie setup -r $(pwd) -h ECMWF.atos</code></pre><p>Where the <code>git clone</code> command clones a specific branch into a directory called <code>&lt;exp_name&gt;</code>. <code>git checkout</code> with the <code>-b</code> flag, then creates a new branch for you to work on. Call it something meaningful. Then the experiment is set up as usual, but using your local repository as reference to itself.</p><p>Then you do some work and when ready to commit something you do</p><pre><code class="language-sh hljs">git add &lt;path to modified file&gt;
git commit --author &quot;Name &lt;name@host&gt;&quot; -m &quot;Commit message&quot;
git push --set-upstream origin &lt;feature/branch_name&gt;</code></pre><p>Specifying <code>--set-upstream origin &lt;feature/branch_name&gt;</code> to <code>git push</code> is only necessary the first time you push your branch to the remote. When ready you can now go to GitHub and make a pull-request to the Harmonie repository from your fork.</p><h2 id="Start-your-experiment"><a class="docs-heading-anchor" href="#Start-your-experiment">Start your experiment</a><a id="Start-your-experiment-1"></a><a class="docs-heading-anchor-permalink" href="#Start-your-experiment" title="Permalink"></a></h2><p>Launch the experiment by giving start time, <code>DTG</code>, end time, <code>DTGEND</code></p><pre><code class="nohighlight hljs">./Harmonie start DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH
# e.g., ./Harmonie start DTG=2012122400 DTGEND=2012122406</code></pre><p>If successful, Harmonie will identify your experiment name and start building your binaries and run your forecast. If not, you need to examine the ECFLOW log file <code>$HM_DATA/ECF.log</code>. <code>$HM_DATA</code> is defined in your <code>Env_system</code> file. At ECMWF <code>$HM_DATA=$SCRATCH/hm_home/$EXP</code> where <code>$EXP</code> is your experiment name. Read more about where things happen further down.</p><h2 id="Continue-your-experiment"><a class="docs-heading-anchor" href="#Continue-your-experiment">Continue your experiment</a><a id="Continue-your-experiment-1"></a><a class="docs-heading-anchor-permalink" href="#Continue-your-experiment" title="Permalink"></a></h2><p>If your experiment have successfully completed and you would like to continue for another period you should write</p><pre><code class="nohighlight hljs">./Harmonie prod DTGEND=YYYYMMDDHH</code></pre><p>By using <code>prod</code> you tell the system that you are continuing the experiment and using the first guess from the previous cycle. The start date is take from a file <code>progress.log</code> created in your <code>$HOME/hm_home/my_exp</code> directory. If you would have used <code>start</code> the initial data would have been interpolated from the boundaries, a cold start in other words.</p><h2 id="Start/Restart-of-ecflow_ui"><a class="docs-heading-anchor" href="#Start/Restart-of-ecflow_ui">Start/Restart of <code>ecflow_ui</code></a><a id="Start/Restart-of-ecflow_ui-1"></a><a class="docs-heading-anchor-permalink" href="#Start/Restart-of-ecflow_ui" title="Permalink"></a></h2><p>To start the graphical window for ECFLOW</p><pre><code class="nohighlight hljs">./Harmonie mon</code></pre><p>The graphical window runs independently of the experiment and can be closed and restarted again with the same command. With the graphical interface you can control and view logfiles of each task. </p><h2 id="Making-local-changes"><a class="docs-heading-anchor" href="#Making-local-changes">Making local changes</a><a id="Making-local-changes-1"></a><a class="docs-heading-anchor-permalink" href="#Making-local-changes" title="Permalink"></a></h2><p>Very soon you will find that you need to do changes in a script or in the source code. Once you have identified which file to edit you put it into the current <code>$HOME/hm_home/my_exp</code> directory, with exactly the same subdirectory structure as in the reference. e.g, if you want to modify a namelist setting </p><pre><code class="nohighlight hljs">./Harmonie co nam/harmonie_namelists.pm   # retrieve default namelist harmonie_namelists.pm
vi nam/harmonie_namelists.pm              # modify the namelist</code></pre><p>Next time you run your experiment the changed file will be used. You can also make changes in a running experiment. Make the change you wish and rerun the <code>InitRun</code> task from the viewer. The <code>InitRun</code> task copies all files from your local experiment directory to your working directory <code>$HM_DATA</code>. Once your <code>InitRun</code> task is complete your can rerun the task you are interested in. If you wish to recompile something you will also have to rerun the <code>Build</code> tasks.</p><h2 id="Issues"><a class="docs-heading-anchor" href="#Issues">Issues</a><a id="Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Issues" title="Permalink"></a></h2><p>Harmonie exp stop at ECMWF(Atos) due PERM mounting problem  https://github.com/Hirlam/Harmonie/issues/628</p><h2 id="Directory-structure"><a class="docs-heading-anchor" href="#Directory-structure">Directory structure</a><a id="Directory-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Directory-structure" title="Permalink"></a></h2><h3 id="SCRATCH"><a class="docs-heading-anchor" href="#SCRATCH"><code>$SCRATCH</code></a><a id="SCRATCH-1"></a><a class="docs-heading-anchor-permalink" href="#SCRATCH" title="Permalink"></a></h3><p>In <code>$SCRATCH/hm_home/$EXP</code> you will find </p><table><tr><th style="text-align: left">Directory</th><th style="text-align: left">Content</th></tr><tr><td style="text-align: left"><code>bin</code></td><td style="text-align: left">Binaries</td></tr><tr><td style="text-align: left"><code>lib</code></td><td style="text-align: left">Source code synced from HM_LIB and compiled code</td></tr><tr><td style="text-align: left"><code>lib/src</code></td><td style="text-align: left">Object files and source code (if you build with makeup, set by MAKEUP<em>BUILD</em>DIR)</td></tr><tr><td style="text-align: left"><code>lib/util</code></td><td style="text-align: left">Utilities such as <code>makeup</code>, <code>gl_grib_api</code> or <code>oulan</code></td></tr><tr><td style="text-align: left"><code>climate</code></td><td style="text-align: left">Climate files</td></tr><tr><td style="text-align: left"><code>YYYYMMDD_HH</code></td><td style="text-align: left">Working directory for the current cycle. If an experiment fails it is useful to check the IFS log file, <code>NODE.001_01</code>, in the working directory of the current cycle. The failed job will be in a directory called something like <code>Failed_this_job</code>.</td></tr><tr><td style="text-align: left"><code>archive</code></td><td style="text-align: left">Archived files. A <code>YYYY/MM/DD/HH</code> structure for per cycle data. <code>ICMSHHARM+NNNN</code> and <code>ICMSHHARM+NNNN.sfx</code> are atmospheric and surfex forecast output files</td></tr><tr><td style="text-align: left"><code>extract</code></td><td style="text-align: left">Verification input data. This is also stored on the permanent disk <code>$HPCPERM/HARMONIE/archive/$EXP/parchive/archive/extract</code></td></tr><tr><td style="text-align: left"><code>ECF.log</code></td><td style="text-align: left">Log of job submission</td></tr></table><h3 id="ECFS"><a class="docs-heading-anchor" href="#ECFS">ECFS</a><a id="ECFS-1"></a><a class="docs-heading-anchor-permalink" href="#ECFS" title="Permalink"></a></h3><ul><li><p>Since <code>$SCRATCH</code> is cleaned regularly we need to store data permanently on ECFS, the EC file system, as well. There are two options for ECFS, <code>ectmp</code> and <code>ec</code>. The latter is a permanent storage and first one is cleaned after 90 days. Which one you use is defined by the`<code>ECFSLOC</code> variable. To view your data type e.g.</p><pre><code class="nohighlight hljs">els ectmp:/$USER/harmonie/my_exp</code></pre></li><li><p>The level of archiving depends on <code>ARSTRATEGY</code> in <code>ecf/config_exp.h</code>. The default setting will give you one <code>YYYY/MM/DD/HH</code> structure per cycle data containing:</p><ul><li>Surface analysis, <code>ICMSHANAL+0000[.sfx]</code></li><li>Atmospheric analysis result <code>MXMIN1999+0000</code></li><li>Blending between surface/atmospheric analysis and cloud variable from the first guess <code>LSMIXBCout</code></li><li><code>ICMSHHARM+NNNN</code> and <code>ICMSHHARM+NNNN.sfx</code> are atmospheric and surfex forecast model state files</li><li><code>PFHARM*</code> files produced by the inline postprocessing</li><li><code>ICMSHSELE+NNNN.sfx</code> are surfex files with selected output</li><li>GRIB files for fullpos and surfex select files</li><li>Logfiles in a tar file <code>logfiles.tar</code></li><li>Observation database and feedback information in <code>odb_stuff.tar</code>.</li><li>Extracted files for obsmon in <code>sqlite.tar</code></li></ul></li><li><p>Climate files are stored in the <code>climate</code> directory</p></li><li><p>One directory each for <code>vfld</code> and <code>vobs</code> data respectively for verification data</p></li></ul><h3 id="PERM"><a class="docs-heading-anchor" href="#PERM"><code>$PERM</code></a><a id="PERM-1"></a><a class="docs-heading-anchor-permalink" href="#PERM" title="Permalink"></a></h3><table><tr><th style="text-align: left">Directory</th><th style="text-align: left">Content</th></tr><tr><td style="text-align: left"><code>HARMONIE/$EXP</code></td><td style="text-align: left">ecflow log and job files</td></tr><tr><td style="text-align: left"><code>hm_lib/$EXP/lib</code></td><td style="text-align: left">Scipts, config files, ecf and suite, source code (not compiled, set by HM_LIB). Reference with experiment&#39;s changes on top</td></tr></table><h3 id="HPCPERM"><a class="docs-heading-anchor" href="#HPCPERM"><code>$HPCPERM</code></a><a id="HPCPERM-1"></a><a class="docs-heading-anchor-permalink" href="#HPCPERM" title="Permalink"></a></h3><p>In <code>$HPCPERM/hm_home/$EXP</code></p><table><tr><th style="text-align: left">Directory</th><th style="text-align: left">Content</th></tr><tr><td style="text-align: left"><code>parchive/archive/extract/</code></td><td style="text-align: left">Verification input data.</td></tr></table><h3 id="HOME-on-ecflow-gen-:({user})-001"><a class="docs-heading-anchor" href="#HOME-on-ecflow-gen-:({user})-001"><code>$HOME</code> on ecflow-gen-{user}-001</a><a id="HOME-on-ecflow-gen-:({user})-001-1"></a><a class="docs-heading-anchor-permalink" href="#HOME-on-ecflow-gen-:({user})-001" title="Permalink"></a></h3><table><tr><th style="text-align: left">Directory</th><th style="text-align: left">Content</th></tr><tr><td style="text-align: left"><code>ecflow_server/</code></td><td style="text-align: left">ecFlow checkpoint and log files</td></tr></table><h2 id="Cleanup-of-old-experiments"><a class="docs-heading-anchor" href="#Cleanup-of-old-experiments">Cleanup of old experiments</a><a id="Cleanup-of-old-experiments-1"></a><a class="docs-heading-anchor-permalink" href="#Cleanup-of-old-experiments" title="Permalink"></a></h2><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>These commands may not work properly in all versions. Do not run the removal before you&#39;re sure it&#39;s OK</p></div></div><p>Once you have complete your experiment you may wish to remove code, scripts and data from the disks. Harmonie provides some simple tools to do this. First check the content of the different disks by</p><pre><code class="nohighlight hljs">Harmonie CleanUp -ALL</code></pre><p>Once you have convinced yourself that this is OK you can proceed with the removal.</p><pre><code class="nohighlight hljs">Harmonie CleanUp -ALL -go </code></pre><p>If you would like to exclude the data stored on e.g ECFS ( at ECMWF ) or in more general terms stored under <code>HM_EXP</code> ( as defined in <code>Env_system</code> ) you run </p><pre><code class="nohighlight hljs">Harmonie CleanUp -d</code></pre><p>to list the directories intended for cleaning. Again, convince yourself that this is OK and proceed with the cleaning by</p><pre><code class="nohighlight hljs">Harmonie CleanUp -d -go</code></pre><p>You can always remove the data from ECFS directly by running e.g.</p><pre><code class="nohighlight hljs">erm -R ec:/YOUR_USER/harmonie/EXPERIMENT_NAME </code></pre><p>or</p><pre><code class="nohighlight hljs">erm -R ectmp:/YOUR_USER/harmonie/EXPERIMENT_NAME </code></pre><ul><li>For more information about cleaning with Harmonie read <a href="../../TheHarmonieScript/#harmonie-script">here</a></li><li>For more information about the ECFS commands read <a href="https://confluence.ecmwf.int/display/UDOC/ecfs.1">here</a></li></ul><h1 id="Debugging-Harmonie-with-ARM-DDT"><a class="docs-heading-anchor" href="#Debugging-Harmonie-with-ARM-DDT">Debugging Harmonie with ARM DDT</a><a id="Debugging-Harmonie-with-ARM-DDT-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-Harmonie-with-ARM-DDT" title="Permalink"></a></h1><p>Follow instructions <a href="https://confluence.ecmwf.int/display/UDOC/HPC2020%3A+ARM+DDT">here</a>. Use <strong>Run DDT client on your Personal Computer or End User Device</strong> </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Overview/da_graph/">« Graphical Overview</a><a class="docs-footer-nextpage" href="../../../Overview/Content/">Content »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 13 July 2023 15:13">Thursday 13 July 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
