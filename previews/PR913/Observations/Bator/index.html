<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bator · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/Observations/Bator/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../Oulan/">Oulan</a></li><li class="is-active"><a class="tocitem" href>Bator</a><ul class="internal"><li><a class="tocitem" href="#General-Description"><span>General Description</span></a></li><li><a class="tocitem" href="#BATOR"><span>BATOR</span></a></li><li><a class="tocitem" href="#Blacklisting"><span>Blacklisting</span></a></li></ul></li><li><a class="tocitem" href="../Cope/">Cope</a></li><li><a class="tocitem" href="../ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../Amv/">AMV</a></li><li><a class="tocitem" href="../Atovs/">ATOVS</a></li><li><a class="tocitem" href="../Iasi/">IASI</a></li><li><a class="tocitem" href="../Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../Scatt/">Scatt</a></li><li><a class="tocitem" href="../Ascat/">AScat</a></li><li><a class="tocitem" href="../GNSS/">GNSS</a></li><li><a class="tocitem" href="../Modes/">Modes</a></li><li><a class="tocitem" href="../RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../DataAssimilation/MTEN/">MTEN</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Forecast(spin-up)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/CHKEVO/">CHKEVO</a></li><li><a class="tocitem" href="../../DataAssimilation/NWECHKEVO/">NWECHKEVO</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-5-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../System/UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Observations</a></li><li><a class="is-disabled">Preprocessing</a></li><li class="is-active"><a href>Bator</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bator</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/Observations/Bator.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="bator"><a class="docs-heading-anchor" href="#bator">ODB creation: Bator</a><a id="bator-1"></a><a class="docs-heading-anchor-permalink" href="#bator" title="Permalink"></a></h1><h2 id="General-Description"><a class="docs-heading-anchor" href="#General-Description">General Description</a><a id="General-Description-1"></a><a class="docs-heading-anchor-permalink" href="#General-Description" title="Permalink"></a></h2><p>The pre-processing step creates ODB (Observational Data Base) from various observation data files possibly in different formats.</p><ul><li>Software: The programs used for pre-processing (<code>ShuffleBufr</code>, <code>oulan</code> and <code>BATOR</code>) are not part of the IFS code. oulan is software developed at Météo France to extract (conventional) observations from their local database (BDM). The ASCII output from oulan, the OBSOUL file, is one of the inputs of BATOR. By default, oulan is no longer part of the observation processing chain. BATOR is also developed at Météo France to generate the ODB (Observational !DataBase) database for the ARPEGE/ALADIN/HARMONIE analysis system. ODB is a tailor made database software developed at ECMWF to manage very large observational data volumes assimilated in the IFS 4DVAR system, and to enable flexible post-processing of this data <a href="http://old.ecmwf.int/services/odb/odb_overview.pdf">(Sami Saarinen, 2006)</a>. HARMONIE&#39;s BATOR originates from the MF export-pack. The figure below describes the mechanism of the observation pre-processing in HARMONIE DA. To sum it up, !ShuffleBufr splits different observations into BUFR files and BATOR creates the ODB file using from BUFR/HDF5/NetCDF input files.</li></ul><ul><li>Compilation: BATOR is compiled using gmakpack or makeup.</li><li>Scripts: <code>scr/Bator</code>.</li><li>Input: BUFR/HDF5/NetCDF</li><li>Output: ODB databases for surface and upper-air data assimilation</li></ul><h2 id="BATOR"><a class="docs-heading-anchor" href="#BATOR">BATOR</a><a id="BATOR-1"></a><a class="docs-heading-anchor-permalink" href="#BATOR" title="Permalink"></a></h2><p>BATOR creates the ODB files from observational data in BUFR/HDF5/NetCDF format. BATOR also includes filtering (blacklisting) of parameters from stations of different observation types. To run the BATOR program one needs files containing blacklist rules/information, namelist(s), file containing information about observations and their format – refdata -, and some setting for the ODB environment. Documentation provided by Météo France is available at <a href="http://www.umr-cnrm.fr/gmapdoc/spip.php?article229">http://www.umr-cnrm.fr/gmapdoc/spip.php?article229</a>. In particular: <a href="http://www.umr-cnrm.fr/gmapdoc/IMG/pdf/namel_bator_cy43-en.pdf">BATOR namelists</a>, <a href="http://www.umr-cnrm.fr/gmapdoc/IMG/pdf/param_bator_cy43-en.pdf">the param_bator.cfg file</a> and <a href="http://www.umr-cnrm.fr/gmapdoc/IMG/pdf/bator_changes.cy42_op1.pdf">the batormap files</a>.</p><h3 id="observation-window-and-timeslots"><a class="docs-heading-anchor" href="#observation-window-and-timeslots">observation window and timeslots</a><a id="observation-window-and-timeslots-1"></a><a class="docs-heading-anchor-permalink" href="#observation-window-and-timeslots" title="Permalink"></a></h3><p>The timeslots characteristics are provided by BATOR using the following environment variables. These are defined in scr/Bator based on settings provided in scr/include.ass and ecf/config_exp.h.</p><table><tr><th style="text-align: left">Environment variable</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>ODB_ANALYSIS_DATE</code></td><td style="text-align: left">analysis date (YYYYMMDD)</td></tr><tr><td style="text-align: left"><code>ODB_ANALYSIS_TIME</code></td><td style="text-align: left">analysis time (hhmmss)</td></tr><tr><td style="text-align: left"><code>BATOR_NBSLOT</code></td><td style="text-align: left">number of timeslots needed [1, 9999]</td></tr><tr><td style="text-align: left"><code>BATOR_WINDOW_LEN</code></td><td style="text-align: left">width of the temporal assimilation window (in minutes) [1, 9999]</td></tr><tr><td style="text-align: left"><code>BATOR_WINDOW_SHIFT</code></td><td style="text-align: left">shift of the temporal assimilation window relative to the analysis time (in minutes). Must be negative.</td></tr><tr><td style="text-align: left"><code>BATOR_SLOT_LEN</code></td><td style="text-align: left">width of a standard timeslot (in minutes) [1, 9999]</td></tr><tr><td style="text-align: left"><code>BATOR_CENTER_LEN</code></td><td style="text-align: left">width of the centred timeslot (in minutes) [1, 9999]</td></tr></table><h3 id="batormap"><a class="docs-heading-anchor" href="#batormap">batormap</a><a id="batormap-1"></a><a class="docs-heading-anchor-permalink" href="#batormap" title="Permalink"></a></h3><p>The <code>batormap</code> file lists all the input data files (BUFR,NETCDF,HDF5,OBSOUL) to translate and put in a particular ODB database. Several records can be stored in this file, each one composed by the following 4 fields (blank spaces are used as separator). The <code>batormap</code> file is created by <code>scr/Bator</code> based on settings provided in <code>scr/include.ass</code> and task arguments.</p><ul><li>The ECMA database extension in which data will be stored, up to 8 characters.</li><li>The data filename extension, up to 8 characters.</li><li>Data filename format, up to 8 characters.</li><li>Kind of data or instrument, up to 16 characters. Must match a kind of data in the subroutine <code>bator_initlong</code> (<code>src/odb/pandormodule/bator_init_mod.F90</code>)</li></ul><p>For example:</p><pre><code class="language-bash hljs">conv     conv     OBSOUL   conv
conv     synop    BUFR     synop</code></pre><h3 id="param.cfg"><a class="docs-heading-anchor" href="#param.cfg"><code>param.cfg</code></a><a id="param.cfg-1"></a><a class="docs-heading-anchor-permalink" href="#param.cfg" title="Permalink"></a></h3><p>BATOR reads BUFR data according to definitions describing BUFR templates in the <code>param.cfg</code> file. The general layout of definitions in the <code>param.cfg</code> file is as follows:</p><pre><code class="language-bash hljs">BUFR label
a b c d
codage  a1  desc_a1
...
codage  an   desc_an
control b1   val1
...
control bn   valn
offset  c1   inc1
...
offset  cn   incn
values  pos_d1 desc_d1
...
values  pos_dn desc_dn
/BUFR label</code></pre><p>where: </p><ul><li>a: number of unexpanded descriptors (NTDLEN if you are familiar with bufrdc software).</li><li>b: number of &quot;control&quot; entries - &quot;control&quot; values used by <code>src/odb/pandor/module/bator_decodbufr_mod.F90</code></li><li>c: number of &quot;offset&quot; entries - &quot;jump&quot; values used by <code>src/odb/pandor/module/bator_decodbufr_mod.F90</code></li><li>d: number of &quot;values&quot; entries - bufrdc VALUES array indices of parameters</li><li>codage desc: FXY&#39;s of NTDLST array values</li><li>values desc: FXY&#39;s of NTDEXP array values</li></ul><p><code>param.cfg</code> files are stored in <code>const/bator_param</code> and linked for use by <code>BATOR</code> in <code>scr/Bator</code></p><h3 id="Namelists"><a class="docs-heading-anchor" href="#Namelists">Namelists</a><a id="Namelists-1"></a><a class="docs-heading-anchor-permalink" href="#Namelists" title="Permalink"></a></h3><ul><li>Namelists are needed for BATOR to deal with observations having format structure different than that of MF. For example to read local Seviri data in grib format, one should set some parameters (<code>NLON_GRIB</code> and <code>NLAT_GRIB</code>) in the <code>NADIRS</code> group. Note: If my last modifications will be accepted, we will need to set parameters in the mentioned group, so the use of this namelist become obligatory for “local” (outside MF) HARMONIE system. The namelist looks like this:</li></ul><pre><code class="language-bash hljs"> &amp;NADIRS
   LMFBUFR=.FALSE.,                                         # we are not using Météo France BUFR
   ASCAT_XYGRID=12500.,                                     # ASCAT XYGRID RESOLUTION /LR=25000m/HR=12500m/
   GPSSOLMETHOD=&quot;CENT&quot;,                                     # Selection method for GNSS data &quot;CENT&quot;/&quot;MEAN&quot;
   NbTempMaxLevels=6000,                                    # Maximum number of radiosonde levels read
   TempSondOrTraj=.FALSE.,                                  # .TRUE. = sondage vertical, .FALSE. = trajectoire
   TempSondSplit=.FALSE.,                                   # .TRUE. = on coupe le radiosondage/timeslot, .FALSE. = profil simple
   ElimTemp0=.FALSE.,                                       # suppression des TEMP sans delta lat/lon/time si .TRUE.
   ElimPilot0=.FALSE.,                                      # suppression des PILOT sans delta lat/lon/time si .TRUE.
   NFREQVERT_TPHR=100,                                      # thinning factor for radiosonde data
   NbMinLevelHr=300,                                        # level threshold for high-resolution treatement of sonde data
   TS_AMSUA(206)%t_select%ChannelsList(:) = -1,             # ...
   TS_AMSUA(206)%t_select%TabFov(:) = -1,                   # ...
   TS_AMSUA(206)%t_select%TabFovInterlace(:) = -1,          # ...
   :                                                        # :
   :                                                        # :
   :                                                        # :
   SIGMAO_COEF(1:18)=18*1.0,                                # Scaling of sigmo-o coefficients
 /
 &amp;NAMSCEN
 /
 &amp;NAMDYNCORE
 /
 &amp;NAMSATFREQ
 /
</code></pre><ul><li><p>Namelist to activate (bator) <code>LAMFLAG</code> (needed to extract the observations for the model + extension zone domain): one needs to fetch the <code>bator_lamflag</code> namelist using the following command</p><pre><code class="language-bash hljs">lamflag_namelist VAR</code></pre><pre><code class="language-bash hljs"> &amp;NAMFCNT
   LOBSONLY=.FALSE.,
 /
 &amp;NAMFGEOM
   EFLAT0=$LAT0,
   EFLON0=$LON0,
   EFLATC=$LATC,
   EFLONC=$LONC,
   EFLAT1=$LAT1,
   EFLON1=$LON1,
   EFDELX=$GSIZE,
   EFDELY=$GSIZE,
   NFDLUN=1,
   NFDGUN=1,
   NFDLUX=$NDLUXG,
   NFDGUX=$NDGUXG,
   Z_CANZONE=1500.,
   REDZONE=$REDZONE_BATOR,
   LVAR=$LVAR,
   LNEWGEOM=.TRUE.,
 /
 &amp;NAMFOBS
   LSYNOP=$LSYNOP,
   LAIREP=$LAIREP,
   LDRIBU=$LDRIBU,
   LTEMP=$LTEMP,
   LPILOT=$LPILOT,
   LPAOB=$LPAOB,
   LSCATT=$LSCATT,
   LSATEM=$LSATEM,
   LSATOB=$LSATOB,
   LSLIMB=$LSLIMB,
   LRADAR=$LRADAR,</code></pre></li></ul><h3 id="Environment-variables"><a class="docs-heading-anchor" href="#Environment-variables">Environment variables</a><a id="Environment-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Environment-variables" title="Permalink"></a></h3><ul><li>ODB settings for BATOR:<pre><code class="language-bash hljs">		export ODB_CMA=ECMA
		export ODB_SRCPATH_ECMA=${d_DB}/ECMA.${base}
		export ODB_DATAPATH_ECMA=${d_DB}/ECMA.${base} 
		export ODB_ANALYSIS_DATE=${YMD}
		export ODB_ANALYSIS_TIME=${HH}0000
		export IOASSIGN=${d_DB}/ECMA.${base}/IOASSIGN
		export BATOR_NBPOOL=${NPOOLS}

		#--- prepare db dir
		RecreateDir ${d_DB}/ECMA.${base}	   
		#-- create IOASSIGN file for the given sub-base
		cd ${d_DB}/ECMA.${base}	
		export ODB_IOASSIGN_MAXPROC=${NPOOLS}
		$HM_LIB/scr/create_ioassign -l &quot;ECMA&quot; -n ${BATOR_NBPOOL}</code></pre></li></ul><p>where <code>$base</code> is the ODB base (<code>$base</code> can be <code>conv</code> (for conventional data), <code>amsu</code> (ATOVS/AMSU-A,AMSU-B/MHS), <code>sev</code> (for Sevir), <code>iasi</code>, <code>radarv</code> (radar) for example). Important: If you would like to have more bases, do not forget to take that into consideration when generating the &quot;batormap&quot; file for BATOR to define which observations you would like to have in each base.</p><h2 id="Blacklisting"><a class="docs-heading-anchor" href="#Blacklisting">Blacklisting</a><a id="Blacklisting-1"></a><a class="docs-heading-anchor-permalink" href="#Blacklisting" title="Permalink"></a></h2><p>To avoid model forecast degradation, two files can be used to blacklist or exclude data from the analysis. They are also used to blacklist observations that the model cannot deal with because they are not representative (orography, breeze effects...). The reason for the existence of this method of &#39;blacklisting&#39;, built-in Bator, alongside with <code>hirlam_blacklist.b</code> (built-in Screening) is to allow simple and quick changes (and especially without changing binary) in the operational suite.</p><p>The selection of an observation to be &#39;blacklisted&#39; can be done using multi-criteria (SID/STATID, obstype, codetype, varno, channel/level, production center, sub-center producer, network (s) concerned (s), cycle (prod / assim), ..).</p><h3 id="LISTE_LOC"><a class="docs-heading-anchor" href="#LISTE_LOC"><code>LISTE_LOC</code></a><a id="LISTE_LOC-1"></a><a class="docs-heading-anchor-permalink" href="#LISTE_LOC" title="Permalink"></a></h3><p>The <code>LISTE_LOC</code> file can be used to blacklist satellite data and also for other data by type and / or subtype for a given parameter (described by varno or not). The contents of the <code>LISTE_LOC</code> are as follows:</p><table><tr><th style="text-align: left">Column</th><th style="text-align: left">Description</th><th style="text-align: left">Format</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">Type of action: N: blacklisted, E: exclude</td><td style="text-align: left">a1</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">The observation type (obsytpe@hdr)</td><td style="text-align: left">i3</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">The observation code-type (codetype@hdr)</td><td style="text-align: left">i4</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">The satellite ID with leading zeros (satid@sat)</td><td style="text-align: left">a9</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">The centre that produced the satellite data</td><td style="text-align: left">i4</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">The parameter ID (varno@body) or the satellite sensor ID (sensor@hdr)</td><td style="text-align: left">i4</td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">Optional keywords of ZONx4, TOVSn, PPPPn, PROFn</td><td style="text-align: left"></td></tr></table><p><code>TOVSn C1 C2 ... Cn</code></p><ul><li>can be aplied to ATOVS radiances</li><li>n can be at most 9 indicating the involved channels</li><li>the Ci values specify the channels to be blacklisted</li></ul><p><code>PPPPn P1 P2 ... Pn</code></p><ul><li>can be aplied to blacklist different pressure levels</li><li>n can be at most 9 indicating the involved levels</li><li>the Pi values specify the pressure levels (in hPa) to be blacklisted</li></ul><p><code>PROFn P1a P2 ... Pn-1 I1 I2 ... In-1</code></p><ul><li>n can be at most 9 indicating the involved layers</li><li>the Pi values specify the bottom and top levels of pressure layers (in hPa).</li><li>The first layer is always [1000,P1]</li><li>the Ii values indicate if blacklisting should be applied (=1) or not (=0) to the given layer.</li></ul><p><code>ZONx4 latmin latmax lonmin lonmax</code></p><ul><li>can be applied to SATOB/GEOWIND data</li><li>if x=B then the pixels with lat &lt; latmin or lat &gt; latmax or lon &lt; lonmin or lon &gt; lonmax will be blacklisted</li><li>if x=C then the pixels with lat &lt; latmin or lat &gt; latmax or (lon &gt; lonmin and lon &lt; lonmax) will be blacklisted.</li></ul><h3 id="LISTE_NOIRE_DIAP"><a class="docs-heading-anchor" href="#LISTE_NOIRE_DIAP"><code>LISTE_NOIRE_DIAP</code></a><a id="LISTE_NOIRE_DIAP-1"></a><a class="docs-heading-anchor-permalink" href="#LISTE_NOIRE_DIAP" title="Permalink"></a></h3><p>The <code>LISTE_NOIRE_DIAP</code> (<code>const/bator_liste</code>) can be used to blacklist conventional observations by station identifier. The contents of the <code>LISTE_NOIRE_DIAP</code> are as follows:</p><table><tr><th style="text-align: left">Column</th><th style="text-align: left">Description</th><th style="text-align: left">Format</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">Observation type (obstype@hdr)</td><td style="text-align: left">i2</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">Observation name</td><td style="text-align: left">a10</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">Observation codetype (codetype@hdr)</td><td style="text-align: left">i3</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">Parameter ID (varno@body)</td><td style="text-align: left">i3</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">Station ID (statid@hdr)</td><td style="text-align: left">a8</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">Start date of blacklisting yyyymmdd</td><td style="text-align: left">a8</td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">Optional layer blacklisting (PROFn)</td><td style="text-align: left">a180</td></tr></table><p><code>PROFn P1a P2 ... Pn-1 I1 I2 ... In</code></p><ul><li>n can be at most 9 indicating the involved layers</li><li>the Pi values specify the bottom and top levels of pressure layers (in hPa).The first layer is always [1000,P1]</li><li>the Ii values indicate if blacklisting should be applied (=1) or not (=0) to the given layer. </li><li>The Hxx keyword specifies the analysis hour that should be blacklisted e.g. H00 or H06 etc</li></ul><p>Particularities - the blacklisting of certain parameters involves the automatic blacklisting of other parameter summarized in the table below:</p><table><tr><th style="text-align: left">obstype</th><th style="text-align: left">specified parameter</th><th style="text-align: left">blacklisted parameters</th></tr><tr><td style="text-align: left">SYNOP</td><td style="text-align: left">39 (t2)</td><td style="text-align: left">39 (t2), 58 (rh2), 7 (q)</td></tr><tr><td style="text-align: left">SYNOP</td><td style="text-align: left">58 (rh2)</td><td style="text-align: left">58 (rh2), 7 (q)</td></tr><tr><td style="text-align: left">TEMP</td><td style="text-align: left">1 (z)</td><td style="text-align: left">1 (z), 29 (rh), 2 (t), 59 (td), 7 (q)</td></tr><tr><td style="text-align: left">TEMP</td><td style="text-align: left">2 (t)</td><td style="text-align: left">2 (t), 29 (rh), 7 (q)</td></tr><tr><td style="text-align: left">TEMP</td><td style="text-align: left">29 (rh)</td><td style="text-align: left">29 (rh), 7 (q)</td></tr></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Oulan/">« Oulan</a><a class="docs-footer-nextpage" href="../Cope/">Cope »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 13 July 2023 12:42">Thursday 13 July 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
