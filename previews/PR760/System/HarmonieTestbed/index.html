<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Testbed · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-221448594-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-221448594-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/System/HarmonieTestbed/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li><li><a class="tocitem" href="../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../DataAssimilation/MTEN/">MTEN</a></li><li><a class="tocitem" href="../../DataAssimilation/CHKEVO/">CHKEVO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-4-5" type="checkbox"/><label class="tocitem" for="menuitem-3-4-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../Local/QuickStartLocal/">Local</a></li><li class="is-active"><a class="tocitem" href>Testbed</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-configurations"><span>Defining the configurations</span></a></li><li><a class="tocitem" href="#Testbed-members"><span>Testbed members</span></a></li><li><a class="tocitem" href="#Testbed-domains"><span>Testbed domains</span></a></li><li><a class="tocitem" href="#The-playfile"><span>The playfile</span></a></li><li><a class="tocitem" href="#Input-data"><span>Input data</span></a></li><li><a class="tocitem" href="#Starting-the-testbed"><span>Starting the testbed</span></a></li><li><a class="tocitem" href="#Evaluation-of-the-result"><span>Evaluation of the result</span></a></li><li><a class="tocitem" href="#When-to-use-the-testbed"><span>When to use the testbed</span></a></li></ul></li><li><a class="tocitem" href="../ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../DrHook/">DrHook</a></li><li><a class="tocitem" href="../StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">System</a></li><li class="is-active"><a href>Testbed</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Testbed</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/System/HarmonieTestbed.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-HARMONIE-testbed"><a class="docs-heading-anchor" href="#The-HARMONIE-testbed">The HARMONIE testbed</a><a id="The-HARMONIE-testbed-1"></a><a class="docs-heading-anchor-permalink" href="#The-HARMONIE-testbed" title="Permalink"></a></h1><p>The HARMONIE testbed provides a facility to run a number of well defined test cases using the existing script environment in HARMONIE. The ALADIN testbed, Mitraillette runs test on the hart of the model, the dynamical core. The HARMONIE testbed tests the full script system as it is supposed to be used.</p><h2 id="Defining-the-configurations"><a class="docs-heading-anchor" href="#Defining-the-configurations">Defining the configurations</a><a id="Defining-the-configurations-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-configurations" title="Permalink"></a></h2><h3 id="General"><a class="docs-heading-anchor" href="#General">General</a><a id="General-1"></a><a class="docs-heading-anchor-permalink" href="#General" title="Permalink"></a></h3><p>The testbed is a suite that launches and follows new experiments one at a time in a controlled environment. The testbed experiment takes care of compilation and also hosts the climate files generated by the tested configurations. Source and scripts changes shall be done in the testbed experiment and will be synchronized to the child experiment using the hm_CMODS option in HARMONIE. </p><p>A number of basic configurations have been defined in <code>scr/Harmonie_configurations.pm</code> as the deviation from the default setup in  <code>ecf/config_exp.h</code>, <code>scr/include.ass</code> and <code>suites/harmonie.pm</code>. These configurations are controlled by the script  <code>scr/Harmonie_testbed.pl</code>. The script also contains a number of extra configurations tested from time to time. With the current settings, a test of AROME without 3DVAR would look like.</p><pre><code class="language-bash hljs">
    # AROME no 3D-VAR but default blending of upper air from boundaries
    &#39;AROME&#39; =&gt; {
      &#39;description&#39; =&gt; &#39;Standard AROME settings without upper air DA&#39;,
      &#39;PHYSICS&#39;     =&gt; &#39;arome&#39;,
      &#39;SURFACE&#39;     =&gt; &#39;surfex&#39;,
      &#39;DYNAMICS&#39;    =&gt; &#39;nh&#39;,
      &#39;ANAATMO&#39;     =&gt; &#39;blending&#39;,
      &#39;ANASURF&#39;     =&gt; &#39;none&#39;,
      &#39;DFI&#39;         =&gt; &#39;none&#39;,
      &#39;HOST_MODEL&#39;  =&gt; &#39;ifs&#39;,
      &#39;DOMAIN&#39;      =&gt; &#39;DKCOEXP&#39;,
      &#39;VLEV&#39;        =&gt; &#39;65&#39;,
      &#39;BDINT&#39;       =&gt; &#39;3&#39;,
    },
</code></pre><p>The resulting output, in this case from AROME<em>BD</em>ARO running at ECMWF would look like:</p><pre><code class="language-bash hljs">
 Using the configuration AROME_BD_ARO


 Input /scratch/hlam/hm_home/testbed_ECMWF.atos.gnu_12413/ecf/config_exp.h  
 Output ecf/config_exp.h  

 Change BUILD=${BUILD-yes}                     to BUILD=no 
 Change       BUILD_ROOTPACK=no to BUILD_ROOTPACK=no 
 Change BINDIR=${BINDIR-$HM_DATA/bin}                 to BINDIR=$HM_COMDAT/testbed_ECMWF.atos.gnu_12413/bin 
 Change DOMAIN=DKCOEXP                          to DOMAIN=TEST_8 
 Change VLEV=65                                 to VLEV=HIRLAM_60 
 Change LL=${LL-06}                             to LL=6 
 Change DYNAMICS=&quot;nh&quot;                           to DYNAMICS=nh 
 Change PHYSICS=&quot;arome&quot;                         to PHYSICS=arome 
 Change SURFACE=&quot;surfex&quot;                        to SURFACE=surfex 
 Change DFI=&quot;none&quot;                              to DFI=none 
 Change ANAATMO=3DVAR                           to ANAATMO=none 
 Change ANASURF=CANARI_OI_MAIN                  to ANASURF=none 
 Change OBDIR=$HM_DATA/observations             to OBDIR=$HM_DATA/../testbed_ECMWF.atos.gnu_12413/observations/ 
 Change HOST_MODEL=&quot;ifs&quot;                        to HOST_MODEL=aro 
 Change HOST_SURFEX=&quot;no&quot;                        to HOST_SURFEX=yes 
 Change SURFEX_INPUT_FORMAT=lfi                 to SURFEX_INPUT_FORMAT=fa 
 Change BDLIB=ECMWF                             to BDLIB=AROME 
 Change BDDIR=$HM_DATA/${BDLIB}/archive/@YYYY@/@MM@/@DD@/@HH@   to BDDIR=$HM_DATA/../testbed_ECMWF.atos.gnu_12413/archive_AROME/@YYYY@/@MM@/@DD@/@HH@/ 
 Change INT_BDFILE=$WRK/ELSCF${CNMEXP}ALBC@NNN@                 to INT_BDFILE=$ARCHIVE_ROOT/$YY/$MM/$DD/$HH/ELSCF${CNMEXP}ALBC@NNN@ 
 Change BDSTRATEGY=simulate_operational to BDSTRATEGY=same_forecast 
 Change BDINT=1                         to BDINT=3 
 Change SURFEX_PREP=&quot;no&quot;                to SURFEX_PREP=yes 
 Change CLIMDIR=$HM_DATA/climate                to CLIMDIR=$HM_DATA/../testbed_ECMWF.atos.gnu_12413/climate/$DOMAIN/$PHYSICS 
 Change BDCLIM=$HM_DATA/${BDLIB}/climate        to BDCLIM=$HM_DATA/../testbed_ECMWF.atos.gnu_12413/climate/TEST_11/arome/ 
 Change INT_SINI_FILE=$WRK/SURFXINI.$SURFEX_OUTPUT_FORMAT       to INT_SINI_FILE=$ARCHIVE_ROOT/$YY/$MM/$DD/$HH/SURFXINI.$SURFEX_OUTPUT_FORMAT 
 Change ARCHIVE_ECMWF=yes                       to ARCHIVE_ECMWF=no 
 Change POSTP=&quot;inline&quot;                          to POSTP=inline 
 Change MAKEGRIB=no                             to MAKEGRIB=yes 
 Add new settings JBDIR=$HM_REV/testbed_data/jb_data 
 Add new settings LARGE_EC_BD=no 
 Add new settings PLAYFILE=harmonie 
 Add new settings config=AROME 


 Input /scratch/hlam/hm_home/testbed_ECMWF.atos.gnu_12413/Env_submit 
 Output Env_submit 

 Change $nprocx=16; to $nprocx=2 
 Change $nprocy=16; to $nprocy=2 
 Change $nprocx=8; to $nprocx=2 
 Change $nprocy=16; to $nprocy=2 
</code></pre><p>As seen from the example above the script also changes the submission rules. These rules can be defined, per host, at the end of the script. Other host specific settings may also be defined to allow local changes of the test environment. In <code>Harmonie_testbed.pl</code> we find e.g. changes for the default at ECMWF:</p><pre><code class="language-bash hljs">
 &#39;default&#39; =&gt; {
   &#39;BINDIR&#39;     =&gt; &#39;$HM_COMDAT/&#39;.$EXP.&#39;/bin&#39;,
   &#39;BDDIR&#39;      =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/$BDLIB/$DOMAIN&#39;,
   &#39;OBDIR&#39;      =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/observations/$DOMAIN&#39;,
   &#39;LARGE_EC_BD&#39; =&gt; &#39;no&#39;,
   &#39;CLIMDIR&#39;    =&gt; &#39;$HM_DATA/../&#39;.$EXP.&#39;/climate/$DOMAIN/$PHYSICS&#39;,
  },
</code></pre><p>The host dependent settings will be imposed on all configurations. If a setting in any configuration is in conflict with the host settings the configuration settings will be used.</p><h3 id="Define-changes-in-harmonie.pm"><a class="docs-heading-anchor" href="#Define-changes-in-harmonie.pm">Define changes in <code>harmonie.pm</code></a><a id="Define-changes-in-harmonie.pm-1"></a><a class="docs-heading-anchor-permalink" href="#Define-changes-in-harmonie.pm" title="Permalink"></a></h3><p>The changes to <code>msms/harmonie.pm</code> are controlled with a special syntax, like in the <code>AROME_JB</code> configuration.</p><pre><code class="language-bash hljs">   # AROME Structure function derivation
   &#39;AROME_JB&#39; =&gt; {
     &#39;description&#39; =&gt; &#39;Derive structure functions for AROME 3DVAR&#39;,
      ...
      &#39;harmonie.pm&#39; =&gt; [&#39;ENSBDMBR&#39;,&#39;ENSCTL&#39;,&#39;SLAFLAG&#39;],
        &#39;ENSBDMBR&#39;    =&gt; &#39;[1,2,3,4]&#39;,
        &#39;ENSCTL&#39;      =&gt; &#39;[&quot;001&quot;,&quot;002&quot;,&quot;003&quot;,&quot;004&quot;]&#39;,
        &#39;SLAFLAG&#39;     =&gt; &#39;[0]&#39;,
    },
</code></pre><p>The <code>harmonie.pm</code> key determines which keyword to find and replace. The list guarantees that the same keywords are not changed in e.g. <code>ecf/config_exp.h</code> .</p><h2 id="Testbed-members"><a class="docs-heading-anchor" href="#Testbed-members">Testbed members</a><a id="Testbed-members-1"></a><a class="docs-heading-anchor-permalink" href="#Testbed-members" title="Permalink"></a></h2><table><tr><th style="text-align: left"><strong>Name</strong></th><th style="text-align: left"><strong>DOMAIN</strong></th><th style="text-align: left"><strong>DTGs</strong></th><th style="text-align: left"><strong>Dependencies</strong></th><th style="text-align: left"><strong>Description</strong></th><th style="text-align: left"><strong>Active in</strong></th></tr><tr><td style="text-align: left"><code>AROME</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME with 2-D decomposition</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_1D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME with 1-D decomposition</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_2D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME with 2-D decomposition</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_3DVAR</code></td><td style="text-align: left"><code>IRELAND150</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left"><code>AROME_3DVAR</code></td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_3DVAR_MARSOBS</code></td><td style="text-align: left"><code>IRELAND150</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left"><code>AROME_3DVAR</code> including non-conventional observations from MARS</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_3DVAR_2P</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left"><code>AROME_3DVAR</code> with two patches</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_4DVAR</code></td><td style="text-align: left"><code>SCANDINAVIA</code></td><td style="text-align: left">2017093021-2017100100</td><td style="text-align: left">None</td><td style="text-align: left"><code>AROME_4DVAR</code></td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_BD_ALA</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>ALARO</code></td><td style="text-align: left">AROME with ALARO LBCs</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_BD_ALA_ARO</code></td><td style="text-align: left"><code>TEST_2.5</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME_BD_ALA</code></td><td style="text-align: left">AROME with AROME LBCs</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_BD_ARO</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME</code></td><td style="text-align: left">AROME with AROME LBCs, no IO-server</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_BD_ARO_IO_SERV</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME</code></td><td style="text-align: left">AROME with AROME LBCs, with IO-server</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_BD_ARO_2P</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME</code></td><td style="text-align: left">AROME two patches with AROME LBCs</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_CLIMSIM</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2012053100-2012060200</td><td style="text-align: left">None</td><td style="text-align: left">AROME climate simulation, netcdf output</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_EKF</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME with <code>CANARI_EKF_SURFEX</code></td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_EPS_COMP</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>HarmonEPS</code></td><td style="text-align: left">AROME_3DVAR comparison of EPS control</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_MUSC</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME</code></td><td style="text-align: left">AROME MUSC</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>AROME_NONE</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME no SFC/UA DA</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_NONE_2D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">AROME no SFC/UA DA</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_NONE_BD_ALA_NONE</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>ALARO_NONE</code></td><td style="text-align: left">AROME no SFC/UA DA with ALARO LBCs</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>AROME_NONE_BD_ARO_NONE</code></td><td style="text-align: left"><code>TEST_8</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME_NONE</code></td><td style="text-align: left">AROME no SFC/UA DA with AROME LBCs</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ARONE_JB</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">Generation of JB statistics</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>HarmonEPS</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>AROME_EPS_COMP</code></td><td style="text-align: left">HarmonEPS</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>HarmonEPS_IFSENSBD</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2019111021-2019111103</td><td style="text-align: left"><code>AROME_EPS_COMP</code></td><td style="text-align: left">HarmonEPS with IFSENS boundaries</td><td style="text-align: left">CY43</td></tr><tr><td style="text-align: left"><code>ALARO1_3DVAR_OLD</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO1 with 3DVAR and old_surface</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_1D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with 1-D decomposition</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_2D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with 2-D decomposition</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_3DVAR_OLD</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO<em>3DVAR with old</em>surface</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_EKF</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with <code>CANARI_EKF_SURFEX</code></td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_EPS_COMP</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">???</td><td style="text-align: left">ALARO EPS?</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_MF_60</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with <code>VLEV=MF_60</code></td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_MUSC</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>ALARO</code></td><td style="text-align: left">ALARO MUSC</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_NH_1D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with NH dynamics and 1-D decomposition</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_NH_2D</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with NH dynamics and 2-D decomposition</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_NONE</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with no SFC/UA DA</td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_OLD</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left">None</td><td style="text-align: left">ALARO with <code>old_surface</code></td><td style="text-align: left"></td></tr><tr><td style="text-align: left"><code>ALARO_OLD_MUSC</code></td><td style="text-align: left"><code>TEST_11</code></td><td style="text-align: left">2017093018-2017100100</td><td style="text-align: left"><code>ALARO</code></td><td style="text-align: left">ALARO MUSC with <code>old_surface</code></td><td style="text-align: left"></td></tr></table><h2 id="Testbed-domains"><a class="docs-heading-anchor" href="#Testbed-domains">Testbed domains</a><a id="Testbed-domains-1"></a><a class="docs-heading-anchor-permalink" href="#Testbed-domains" title="Permalink"></a></h2><h2 id="The-playfile"><a class="docs-heading-anchor" href="#The-playfile">The playfile</a><a id="The-playfile-1"></a><a class="docs-heading-anchor-permalink" href="#The-playfile" title="Permalink"></a></h2><p>The playfile used for the testbed is  <code>msms/testbed.tdf</code>. Here each configuration is defined with a trigger, a task to create and one to follow the child experiments.  Configurations inluded are listed in the <code>TESTBED_LIST</code> environment variable in <code>ecf/config_exp.h</code></p><pre><code class="language-bash hljs"> TESTBED_LIST=&quot;ALADIN ALADIN_3DVAR AROME&quot;</code></pre><p>If the child experiment fails the Follow_exp task will also fail. When the child experiment problem has been corrected and the task restarted, the follow task should be restarted. When, finally, the child experiment is finished the test family will be completed and next test case will be triggered.</p><h2 id="Input-data"><a class="docs-heading-anchor" href="#Input-data">Input data</a><a id="Input-data-1"></a><a class="docs-heading-anchor-permalink" href="#Input-data" title="Permalink"></a></h2><p>The standard testbed configuration is run over several. The domain and resolution is chosen to be computationally cheap and not to give meteorologically interesting and meaningful results. Input data for running the testbed is ECMWF boundaries, observations, background error statistics and climate files. The latest data may be found  on <code>/scratch/hlam/hm_home/some_recent_testbed_experiment/testbed_data</code> and the data included is the following:</p><ul><li>ECMWF boundaries for the tested periods</li><li>Observations</li><li>Background errors</li><li>Climate files</li><li>Forcing data for nested experiments</li></ul><p>Download the data to your machine and put it on the default location <code>$HM_REV/testbed_data</code> or define your location in <code>scr/Harmonie_testbed.pl</code>. If you wish to test the climate generation you simple redefine the location of the climate files or remove the existing ones in the climate directory of the testbed. The testbed data typically includes the following:</p><h2 id="Starting-the-testbed"><a class="docs-heading-anchor" href="#Starting-the-testbed">Starting the testbed</a><a id="Starting-the-testbed-1"></a><a class="docs-heading-anchor-permalink" href="#Starting-the-testbed" title="Permalink"></a></h2><p>The testbed experiment is setup as any normal experiment with</p><pre><code class="language-bash hljs">Harmonie setup -r REVISION -h HOST</code></pre><p>The testbed is launched by</p><pre><code class="language-bash hljs">Harmonie testbed </code></pre><p>Before you start the testbed you should define your reference experiment. The reference experiment is picked automatically as an experiment with the same name but with lower revision number. The reference experiment can also be defined by the by setting <code>REFEXP</code> in <code>ecf/config_exp.h</code>  as the full path to another testbed experiment:</p><pre><code class="language-bash hljs">export REFEXP=/scratch/hlam/hm_home/test_37h12
</code></pre><h2 id="Evaluation-of-the-result"><a class="docs-heading-anchor" href="#Evaluation-of-the-result">Evaluation of the result</a><a id="Evaluation-of-the-result-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation-of-the-result" title="Permalink"></a></h2><p>At the end of each testbed run the results are compared to a reference experiment using the script <code>scr/Testbed_copmp</code>. The script uses xtool to check the numerical difference for the following output:</p><ul><li>ECMWF input data</li><li>climate files</li><li>Interpolated boundary files</li><li>Output forecast files in FA format</li><li>Output forecast files in GRIB format</li><li>vfld/vobs files</li></ul><p>In addition the internal consistency is checked by comparing runs with </p><ul><li>1D vs 2D decomposition</li><li>EPS control vs a deterministic run</li><li>Run with and without IO-server</li></ul><p>The choice of internal consistency tests reflects the history of problems and inconsistencies encountered.</p><pre><code class="language-bash hljs">
HARMONIE testbed results from ecflow-gen-hlam-001
Sat Nov 16 20:41:27 GMT 2019

Configuration: ECMWF.atos.gnu

Compare experiment testbed_ECMWF.atos.gnu_12414 and testbed_ECMWF.atos.gnu_12413

Check:ecmwf_bd
  Output grib file summary (differ/missing/total) 0/0/37
   comparison took 164 seconds
 Configuration ecmwf_bd is equal

Check:climate
  Output internal file summary (differ/missing/total) 0/0/52
   comparison took 34 seconds
 Configuration climate is equal

Check:AROME_3DVAR
  Output internal file summary (differ/missing/total) 0/0/36
   comparison took 79 seconds
  Output grib file summary (differ/missing/total) 0/0/96
   comparison took 91 seconds
  vfld/vobs file summary (differ/missing/total) 0/0/36
   comparison took 4 seconds
 Configuration AROME_3DVAR is equal

 ...

Compare AROME_BD_ARO and AROME_BD_ARO_IO_SERV
 No differences found
   comparison took 423 seconds

Testbed comparison complete

[ Status: OK]

 For more details please check /scratch/hlam/hm_home/testbed_ECMWF.atos.gnu_12414/testbed_comp_12414.log_details
</code></pre><p>All the logs from any testbed experiment are posted to the testbed mailing list on <a href="https://hirlam.org/pipermail/testbed">hirlam.org</a> or to the mail address <code>MAIL_TESTBED</code> set in <code>ecf_config_exp.h</code>. If a github token <code>GH_TOKEN</code> is set in <code>scr/Testbed_comp</code> the results will also be posted on <a href="https://github.com/orgs/Hirlam/teams/testbed">testbed discussions on github</a>. See <a href="https://github.com/settings/tokens">github settings</a> to create a token. Tick at least the box to write discussions.   The test returns three different status signals</p><ul><li>OK means that all configurations reproduces the result of your reference experiment.</li><li>OK, BUT NO COMPARISON means that the suit run through but that there was nothing to compare with</li><li>FAILED means that the internal comparisons failed</li><li>DIFFER means that one more configurations differ from your reference experiment</li><li>FAILED and DIFFER is a combination of the last two</li></ul><p>In addition to the summary information detailed information can be found in the archive about the art of the difference.</p><h2 id="When-to-use-the-testbed"><a class="docs-heading-anchor" href="#When-to-use-the-testbed">When to use the testbed</a><a id="When-to-use-the-testbed-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-use-the-testbed" title="Permalink"></a></h2><p>It is recommended to use the testbed when adding new options or make other changes in the configurations. If your new option is not activated the result compared with the reference experiment should be the same, if not you have to start debugging. When changing things for one configuration it&#39;s easy to break other ones. In such cases the testbed is a very good tool make sure you haven&#39;t destroyed anything.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Local/QuickStartLocal/">« Local</a><a class="docs-footer-nextpage" href="../ECMWF/ECMWF_teleport/">Teleport »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 13 April 2023 10:12">Thursday 13 April 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
