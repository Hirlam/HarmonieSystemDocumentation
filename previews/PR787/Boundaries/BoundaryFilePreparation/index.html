<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Preparation · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/Boundaries/BoundaryFilePreparation/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../DataAssimilation/MTEN/">MTEN</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Forecast(spin-up)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/CHKEVO/">CHKEVO</a></li><li><a class="tocitem" href="../../DataAssimilation/NWECHKEVO/">NWECHKEVO</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Preparation</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Boundary-strategies"><span>Boundary strategies</span></a></li><li><a class="tocitem" href="#Near-real-time-aerosols"><span>Near real time aerosols</span></a></li><li><a class="tocitem" href="#Initial-and-Boundary-file-generation"><span>Initial and Boundary file generation</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-5-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../System/UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Boundaries</a></li><li class="is-active"><a href>Preparation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Preparation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/Boundaries/BoundaryFilePreparation.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Preparation-of-initial-and-boundary-files"><a class="docs-heading-anchor" href="#Preparation-of-initial-and-boundary-files">Preparation of initial and boundary files</a><a id="Preparation-of-initial-and-boundary-files-1"></a><a class="docs-heading-anchor-permalink" href="#Preparation-of-initial-and-boundary-files" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>HARMONIE can be coupled with external models as IFS, ARPEGE, HIRLAM. Internally it is possible to nest the different ALADIN/ALARO/AROME with some restrictions. In the following we describe the host initial and boundary files are generated depending on different configurations. Boundary file preparation basically includes two parts: forecast file fetching and boundary file generation.</p><p><em>The ECFLOW tasks for initial and boundary preparation</em></p><h2 id="Boundary-strategies"><a class="docs-heading-anchor" href="#Boundary-strategies">Boundary strategies</a><a id="Boundary-strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-strategies" title="Permalink"></a></h2><p>There are a number of ways to chose which forecast lengths you use as boundaries. The strategy is determined by <code>BDSTRATEGY</code> in <code>ecf/config_exp.h</code>  and there are a number of strategies implemented.</p><ul><li><code>available</code>            : Search for available files in BDDIR adn try to keep forecast consistency. This is ment to be used operationally since it will at least keep your run going, but with old boundaries, if no new boundaries are available.</li><li><code>simulate_operational</code> : Mimic the behaviour of the operational runs using ECMWF 6h old boundaries.</li><li><code>same_forecast</code>        : Use all boundaries from the same forecast, start from analysis</li><li><code>analysis_only</code>        : Use only analyses as boundaries. Note that <code>BDINT</code> cannot be shorter than the frequency of the analyses.</li><li><code>latest</code>               : Use the latest possible boundary with the shortest forecast length</li><li><code>RCR_operational</code>      : Mimic the behaviour of the RCR runs, ie</li><li>12h old boundaries at 00 and 12 and</li><li>06h old boundaries at 06 and 18</li><li><code>jb_ensemble</code>          : Same as <code>same_forecast</code> but used for JB-statistics generation. With this you should <code>export JB_ENS_MEMBER=some_number</code></li><li><code>eps_ec</code>               : ECMWF EPS members (on reduced Gaussian grid). It is only meaningful with <code>ENSMSEL</code> non-empty, i.e., <code>ENSSIZE &gt; 0</code></li></ul><p>All the strategies are defined in <code>scr/Boundary_strategy.pl</code>. The script generates a file bdstrategy in your working directory that could look like:</p><pre><code class="language-bash hljs"> Boundary strategy

       DTG: 2011090618
        LL: 36
     BDINT: 3
   BDCYCLE: 6
  STRATEGY: simulate_operational
     BDDIR: /scratch/snh/hm_home/alaro_37h1_trunk/ECMWF/archive/@YYYY@/@MM@/@DD@/@HH@
HOST_MODEL: ifs
INT_BDFILE: /scratch/snh/hm_home/alaro_37h1_trunk/20110906_18/ELSCFHARMALBC@NNN@

# The output bdstrategy file has the format of 
# NNN|YYYYMMDDHH INT_BDFILE BDFILE BDFILE_REQUEST_METHOD 
# where 
# NNN        is the input hour
# YYYYMMDDHH is the valid hour for this boundary
# INT_BDFILE is the final boundary file
# BDFILE                is the input boundary file
# BDFILE_REQUEST_METHOD is the method to the request BDFILE from e.g. MARS, ECFS or via scp

SURFEX_INI| /scratch/snh/hm_home/alaro_37h1_trunk/20110906_18/SURFXINI.lfi 
000|2011090618 /scratch/snh/hm_home/alaro_37h1_trunk/20110906_18/ELSCFHARMALBC000 /scratch/snh/hm_home/alaro_37h1_trunk/ECMWF/archive/2011/09/06/12/fc20110906_12+006 MARS_umbrella -d 20110906 -h 12 -l 6 -t
003|2011090621 /scratch/snh/hm_home/alaro_37h1_trunk/20110906_18/ELSCFHARMALBC001 /scratch/snh/hm_home/alaro_37h1_trunk/ECMWF/archive/2011/09/06/12/fc20110906_12+009 MARS_umbrella -d 20110906 -h 12 -l 9 -t
...</code></pre><p>Meaning that the if the boundary file is not found under <code>BDDIR</code> the command <code>MARS_umbrella -d YYYYMMDD -h HH -l LLL -t BDDIR</code> will be executed. A local interpretation could be to search for external data if your file is not on <code>BDDIR</code>. Like the example from SMHI:</p><pre><code class="language-bash hljs"> Boundary strategy

       DTG: 2011090112
        LL: 24
     BDINT: 3
   BDCYCLE: 06
  STRATEGY: latest
     BDDIR: /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/g05a/archive/@YYYY@/@MM@/@DD@/@HH@
HOST_MODEL: hir
INT_BDFILE: /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/20110901_12/ELSCFHARMALBC@NNN@
 EXT_BDDIR: smhi_file:/data/arkiv/field/f_archive/hirlam/G05_60lev/@YYYY@@MM@/G05_@YYYY@@MM@@DD@@HH@00+@LLL@H00M
EXT_ACCESS: scp

# The output bdstrategy file has the format of 
# NNN|YYYYMMDDHH INT_BDFILE BDFILE BDFILE_REQUEST_METHOD 
# where 
# NNN        is the input hour
# YYYYMMDDHH is the valid hour for this boundary
# INT_BDFILE is the final boundary file
# BDFILE                is the input boundary file
# BDFILE_REQUEST_METHOD is the method to the request BDFILE from e.g. MARS, ECFS or via scp

# hh_offset is 0 ; DTG is  
SURFEX_INI| /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/20110901_12/SURFXINI.lfi 
000|2011090112 /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/20110901_12/ELSCFHARMALBC000 /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/g05a/archive/2011/09/01/12/fc20110901_12+000 scp smhi:/data/arkiv/field/f_archive/hirlam/G05_60lev/201109/G05_201109011200+000H00M 
003|2011090115 /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/20110901_12/ELSCFHARMALBC001 /nobackup/smhid9/sm_esbol/hm_home/ice_36h1_4/g05a/archive/2011/09/01/12/fc20110901_12+003 scp smhi:/data/arkiv/field/f_archive/hirlam/G05_60lev/201109/G05_201109011200+003H00M </code></pre><p>In this example an scp from smhi will be executed if the expected file is not in BDDIR. There are a few environment variables that one can play with in sms/confi_exp.h that deals with the initial and boundary files</p><ul><li><code>HOST_MODEL</code> : Tells the origin of your boundary data      * <code>ifs</code> : ecmwf data      * <code>hir</code> : hirlam data      * <code>ald</code> : Output from aladin physics, this also covers arpege data after fullpos processing.      * <code>ala</code> : Output from alaro physics      * <code>aro</code> : Output from arome physics</li><li><code>BDINT</code> : Interval of boundaries in hours</li><li><code>BDLIB</code> : Name of the forcing experiment. Set<ul><li><code>ECMWF</code> to use MARS data</li><li><code>RCRa</code>  to use RCRa data from ECFS</li><li>Other HARMONIE/HIRLAM experiment</li></ul></li><li><code>BDDIR</code> : The path to the boundary file. In the default location <code>BDDIR=$HM_DATA/${BDLIB}/archive/@YYYY@/@MM@/@DD@/@HH@</code> the file retrieved from e.g. MARS will be stored in a separate directory. On could also consider to configure this so that all the retrieved files are located in your working directory <code>$WRK</code>. Locally this points to the directory where you have all your common boundary HIRLAM or ECMWF files.</li><li><code>INT_BDFILE</code> : is the full path of the interpolated boundary files. The default setting is to let the boundary file be removed by directing it to <code>$WRK</code>.</li><li><code>INT_SINI_FILE</code> : The full path of the initial surfex file. </li></ul><p>There are a few optional environment variables that could be used that are not visible in <code>config_exp.h</code> </p><ul><li><code>EXT_BDDIR</code> : External location of boundary data. If not set rules are depending on <code>HOST_MODEL</code></li><li><code>EXT_ACCESS</code> : Method for accessing external data. If not set rules are depending on <code>HOST_MODEL</code></li><li><code>BDCYCLE</code> : Assimilation cycle interval of forcing data, default is 6h.</li></ul><p>More about this can be bounds in the <code>Boundary_strategy.pl</code> script.</p><p>The bdstrategy file is parsed by the script <code>ExtractBD</code>. </p><ul><li><code>scr/ExtractBD</code> Checks if data are on <code>BDDIR</code> otherwise copy from <code>EXT_BDDIR</code>.  The operation performed can be different depending on <code>HOST</code> and <code>HOST_MODEL</code>. IFS data at ECMWF are extracted from MARS, RCR data are copied from ECFS.<ul><li>Input parameters: Forecast hour</li><li>Executables: none.</li></ul></li></ul><p>In case data should be retrieved from MARS there is also a stage step. When calling MARS with the stage command we ask MARS to make sure data are on disk. In HARMONIE we ask for all data for one day of r forecasts ( normally four cycles ) at the time. </p><h2 id="Near-real-time-aerosols"><a class="docs-heading-anchor" href="#Near-real-time-aerosols">Near real time aerosols</a><a id="Near-real-time-aerosols-1"></a><a class="docs-heading-anchor-permalink" href="#Near-real-time-aerosols" title="Permalink"></a></h2><p>The use of near real time aerosols require the presence of aerosol fields in the boundary files.</p><ul><li><code>BDAERO</code> : Origin of the aerosol fields<ul><li><code>none</code> : no aerosols (default configuration)</li><li><code>cams</code> : aerosol from CAMS.</li></ul></li></ul><p>A bdstrategy<em>cams file is generated. After the data is retrieved, the files are merge with the files from the HOST</em>MODEL to get the final boundary conditions files.</p><h2 id="Initial-and-Boundary-file-generation"><a class="docs-heading-anchor" href="#Initial-and-Boundary-file-generation">Initial and Boundary file generation</a><a id="Initial-and-Boundary-file-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-and-Boundary-file-generation" title="Permalink"></a></h2><p>To be able to start the model we need the variables defining the model state.</p><ul><li>T,U,V,PS in spectral space</li><li>Q in gridpoint or spectral space</li></ul><p>Optional:</p><ul><li>Q,,l,,, Q,,i,,, Q,,r,,, Q,,g,,,  Q,,s,,, Q,,h,,</li><li>TKE</li></ul><p>For the surface we need the different state variables for the different tiles. The scheme selected determines the variables.</p><p>Boundary files (coupling files) for HARMONIE are prepared in two different ways depending on the  nesting procedure defined by <code>HOST_MODEL</code>.</p><h3 id="Using-gl"><a class="docs-heading-anchor" href="#Using-gl">Using gl</a><a id="Using-gl-1"></a><a class="docs-heading-anchor-permalink" href="#Using-gl" title="Permalink"></a></h3><p>If you use data from HIRLAM or ECMWF <code>gl_grib_api</code> will be called to generate boundaries. The generation can be summarized in the following steps:</p><ul><li>Setup geometry and what kind of fields to read depending on <code>HOST_MODEL</code></li><li>Read the necessary climate data from a climate file</li><li>Translate and interpolate the surface variables horizontally if the file is to be used as an initial file. All interpolation respects land sea mask properties. The soil water is not interpolated directly but interpolated using the Soil Wetness Index to preserve the properties of the soil between different models. The treatment of the surface fields is only done for the initial file.</li><li>Horizontal interpolation of upper air fields as well as restaggering of winds.</li><li>Vertical interpolation using the same method (etaeta) as in HIRLAM<ul><li>Conserve boundary layer structure</li><li>Conserve integrated quantities</li></ul></li><li>Output to an FA file ( partly in spectral space )</li></ul><p><code>gl_grib_api</code> is called by the script <code>scr/gl_bd</code> where we make different choices depending on <code>PHYSICS</code> and <code>HOST_MODEL</code></p><p>When starting a forecast there are options to whether e.g. cloud properties and TKE should be read from the initial/boundary file through <code>NREQIN</code> and <code>NCOUPLING</code>. At the moment these fields are read from the initial file but not coupled to. gl reads them if they are available in the input files and sets them to zero otherwise. For a Non-Hydrostatic run the non-hydrostatic pressure departure and the vertical divergence are demanded as an initial field. The pressure departure is by definition zero if you start from a non-hydrostatic mode and since the error done when disregarding the vertical divergence is small it is also set to zero in gl. There are also a choice in the forecast model to run with Q in gridpoint or in spectral space.</p><p>It&#39;s possible to use an input file without e.g. the uppermost levels. By setting <code>LDEMAND_ALL_LEVELS=.FALSE.</code> the missing levels will be ignored. This is used at some institutes to reduce the amount of data transferred for the operational runs. </p><h3 id="Using-fullpos"><a class="docs-heading-anchor" href="#Using-fullpos">Using fullpos</a><a id="Using-fullpos-1"></a><a class="docs-heading-anchor-permalink" href="#Using-fullpos" title="Permalink"></a></h3><p>If you use data generated by HARMONIE you will use fullpos to generate boundaries and initial conditions. Here we will describe how it&#39;s implemented in HARMONIE but there are also good documentation on the gmapdoc site.</p><ul><li><a href="http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&amp;recherche=fullpos">fullpos</a></li></ul><p>In HARMONIE it is done by the script <code>scr/E927</code>. It contains the following steps:</p><ul><li><p>Fetcht climate files. Fullpos needs a climate file and the geometry definition for both the input and output domains. </p></li><li><p>Set different moist variables in the namelists depending if your run AROME or ALADIN/ALARO.</p></li><li><p>Check if input data has Q in gridpoint or spectral space.</p></li><li><p>Demand NH variables if we run NH.</p></li><li><p>Determine the number of levels in the input file and extract the correct levels from the definition in <code>scr/Vertical_level.pl</code></p></li><li><p>Run fullpos</p></li></ul><p>E927 is also called from 4DVAR when the resolution is changed between the inner and outer loops.</p><h3 id="Generation-of-initial-data-for-SURFEX"><a class="docs-heading-anchor" href="#Generation-of-initial-data-for-SURFEX">Generation of initial data for SURFEX</a><a id="Generation-of-initial-data-for-SURFEX-1"></a><a class="docs-heading-anchor-permalink" href="#Generation-of-initial-data-for-SURFEX" title="Permalink"></a></h3><p>For SURFEX we have to fill the different tiles with correct information from the input data. This is called the PREP step in the SURFEX context. <code>scr/Prep_ini_surfex</code> creates an initial SURFEX file from an FA file if you run with <code>SURFACE=surfex</code>. </p><p><a href="http://www.cnrm.meteo.fr/surfex/">Read more about SURFEX</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../DataAssimilation/NWECHKEVO/">« NWECHKEVO</a><a class="docs-footer-nextpage" href="../../ForecastModel/Forecast/">Forecast »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 15 May 2023 05:27">Monday 15 May 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
