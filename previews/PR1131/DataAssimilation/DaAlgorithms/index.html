<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Algorithms · Harmonie wiki</title><meta name="title" content="Algorithms · Harmonie wiki"/><meta property="og:title" content="Algorithms · Harmonie wiki"/><meta property="twitter:title" content="Algorithms · Harmonie wiki"/><meta name="description" content="Documentation for Harmonie wiki."/><meta property="og:description" content="Documentation for Harmonie wiki."/><meta property="twitter:description" content="Documentation for Harmonie wiki."/><meta property="og:url" content="https://hirlam.github.io/HarmonieSystemDocumentation/dev/DataAssimilation/DaAlgorithms/"/><meta property="twitter:url" content="https://hirlam.github.io/HarmonieSystemDocumentation/dev/DataAssimilation/DaAlgorithms/"/><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/DataAssimilation/DaAlgorithms/"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../System/UsingSubmodulesinHarmonie/">GitHub workflow with submodules</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../Observations/RadarData/">Radar</a></li><li><a class="tocitem" href="../../Observations/Aeolus/">Aeolus</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../Screening/">Screening</a></li><li><a class="tocitem" href="../StructureFunctions/">Structure functions</a></li><li class="is-active"><a class="tocitem" href>Algorithms</a><ul class="internal"><li><a class="tocitem" href="#3D-Var"><span>3D-Var</span></a></li><li><a class="tocitem" href="#4D-Var"><span>4D-Var</span></a></li><li><a class="tocitem" href="#Cloudingest-Cloud-Initialization"><span>Cloudingest - Cloud Initialization</span></a></li><li><a class="tocitem" href="#Incremental-Analysis-Updates-IAU"><span>Incremental Analysis Updates - IAU</span></a></li></ul></li><li><a class="tocitem" href="../DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../LSMIXandJk/">LSMIX and Jk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DFS/">DFS</a></li><li><a class="tocitem" href="../MTEN/">MTEN</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Forecast(spin-up)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../CHKEVO/">CHKEVO</a></li><li><a class="tocitem" href="../NWECHKEVO/">NWECHKEVO</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-5-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_EMS/">MUSC EMS</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li><li><a class="tocitem" href="../../ForecastModel/DDH/">Use of DDH</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/AllobsVerification/">allobs Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../System/UpdateNamelists/">Update Namelist</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Data Assimilation</a></li><li class="is-active"><a href>Algorithms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Algorithms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Hirlam/Harmonie" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/DataAssimilation/DaAlgorithms.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Data-assimilation-algorithms"><a class="docs-heading-anchor" href="#Data-assimilation-algorithms">Data assimilation algorithms</a><a id="Data-assimilation-algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Data-assimilation-algorithms" title="Permalink"></a></h1><h2 id="3D-Var"><a class="docs-heading-anchor" href="#3D-Var">3D-Var</a><a id="3D-Var-1"></a><a class="docs-heading-anchor-permalink" href="#3D-Var" title="Permalink"></a></h2><p>The default upper-air data assimilation algorithm is three-dimensional variational assimilation (3D-Var). To use 3D-Var no changes to <code>ecf/config_exp.h</code> should be required assuming structure function data files are available for your domain. Structure function input is defined in <code>scr/include.ass</code>.</p><h3 id="Settings"><a class="docs-heading-anchor" href="#Settings">Settings</a><a id="Settings-1"></a><a class="docs-heading-anchor-permalink" href="#Settings" title="Permalink"></a></h3><p>List of 3D-Var settings that the user should be concerned about.</p><h2 id="4D-Var"><a class="docs-heading-anchor" href="#4D-Var">4D-Var</a><a id="4D-Var-1"></a><a class="docs-heading-anchor-permalink" href="#4D-Var" title="Permalink"></a></h2><p>With 43h2.2 four-dimensional variational assimilation (4D-Var) is available as a non-default option. In order to setup an experiment to use 4D-Var one should issue the following commands:</p><pre><code class="nohighlight hljs">mkdir -p /path/to/home/hm_home/MY_EXP
cd /path/to/home/hm_home/MY_EXP
/path/to/Harmonie/config-sh/Harmonie setup -r /path/to/Harmonie -c AROME_4DVAR</code></pre><p>To use 4D-Var no changes to <code>ecf/config_exp.h</code> should be required assuming suitable structure function data files are available for your domain (see also <code>ILRES</code> in the settings section). Structure function input is defined in <code>scr/include.ass</code>.</p><h3 id="Settings-2"><a class="docs-heading-anchor" href="#Settings-2">Settings</a><a class="docs-heading-anchor-permalink" href="#Settings-2" title="Permalink"></a></h3><p>List of 4D-Var settings that the user should be concerned about.</p><p>With the following settings the working of the 4D-Var can be changed. Defaults values are given</p><pre><code class="nohighlight hljs">NOUTERLOOP=2                            # number of 4DVAR outer loops
ILRES=6,3                               # Resolution (in parts of full) of outer loops as compared to the forecast resolution. The domain NLATxNLON should have the property that for the settings of ILRES  both NLON/ILRES and NLAT/ILRES are of the form  5^c^ 3^d^ 2^e^, where c, d and e are integers &gt;= 0 and e&gt;=1.
TSTEP4D=300,150                         # Timestep length (seconds) of outer loops TL+AD
TSTEPTRAJ=300,300                       # How often the model state is saved for linearization
NITER4D=10,15                           # Maximum number of inner loop iterations in 4D-Var outer loops
NSIMU4D=15,20                           # Maximum number of cost function simulations in 4D-Var outer loops
CH_RES_SPEC=yes                         # yes =&gt; change of resolution of the increment spectrally; no =&gt; by FULLPOS
FORCE1=no                               # yes =&gt; tendency increment; no =&gt; analysis increment in loop 1
FORCE2=no                               # yes =&gt; tendency increment; no =&gt; analysis increment in loop 2</code></pre><h3 id="Schematic-work-flow-of-4D-Var"><a class="docs-heading-anchor" href="#Schematic-work-flow-of-4D-Var">Schematic work flow of 4D-Var</a><a id="Schematic-work-flow-of-4D-Var-1"></a><a class="docs-heading-anchor-permalink" href="#Schematic-work-flow-of-4D-Var" title="Permalink"></a></h3><p><img src="../../assets/smsanua.png" alt/></p><ul><li>After the screening <code>4DVscreen</code> for the default 3h observation window (2h before and 1h after the start of the main forecast), </li><li><code>4DVprolog</code> prepares the initial conditions at the appropriate resolution (<code>ILRES</code> settings) for the forecasts used in minimization. The input here is the background <code>BGHR (ICMSHHARM+0001</code> fields of the former cycle supplemented with some surface fields). </li><li>Subsequently <code>4DVminim</code> produces initially the low resolution at the beginning of the observation  window (<code>an_lowres_$loop</code>), which is then (<code>CH_RES_SPEC=yes</code> in <code>config_exp.h</code>) transformed to the field at forecast resolution (<code>an_hr_begwin</code>). </li><li>This field is complemented in <code>Blendhr</code> with necessary surface fields and the resulting field  (<code>anb_hr_begwin</code>) acts as the initial condition for the trajectory run <code>4DVtraj</code>. </li><li>From the 2h forecast of <code>4DVtraj</code> (<code>ICMSHTRAJ+0002</code> fields) the main forecast is started.</li></ul><h2 id="Cloudingest-Cloud-Initialization"><a class="docs-heading-anchor" href="#Cloudingest-Cloud-Initialization">Cloudingest - Cloud Initialization</a><a id="Cloudingest-Cloud-Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Cloudingest-Cloud-Initialization" title="Permalink"></a></h2><p>The cloud initialization modifies temperature and humidity fields with help of MSGcloudYYYYMMDDHH.grib file, which contains 2-d fields of cloudtop-temperature [K], cloudmask [0-1] and cloudbase [m].  Pre cy46h the Cloudingest happened within MASTERODB in <code>src/arpifs</code> specifically in <code>src/arpifs/phys_dmn/msginit.F90</code> routine. Since cy46h the Cloudingest uses pysurfex and gl to do the job. </p><h3 id="Settings-3"><a class="docs-heading-anchor" href="#Settings-3">Settings</a><a class="docs-heading-anchor-permalink" href="#Settings-3" title="Permalink"></a></h3><p>Enable Cloudingest in <code>ecf/config_exp.h</code>:</p><pre><code class="nohighlight hljs">USE_MSG=yes                              # Use MSG data for adjustment of inital profiles, EXPERIMENTAL! (no|yes), expects MSGcloudYYYYMMDDHH.grib in $OBDIR</code></pre><p>And in src/include.ass:</p><pre><code class="nohighlight hljs">export CLOUD_BASE=1                # 1 and USE_MSG=true (ecf/config_exp.h) =&gt; msginit</code></pre><p>to replace the cloudbase field in <code>MSGcloudYYYYMMDDHH.grib</code> with an OI interpolated field of SYNOP observations of CloudBaseHeights and postprocessed field of cloudbases of the first-guess file.</p><h3 id="Ecflow-and-schematic-work-flow-of-Cloudingest"><a class="docs-heading-anchor" href="#Ecflow-and-schematic-work-flow-of-Cloudingest">Ecflow and schematic work flow of Cloudingest</a><a id="Ecflow-and-schematic-work-flow-of-Cloudingest-1"></a><a class="docs-heading-anchor-permalink" href="#Ecflow-and-schematic-work-flow-of-Cloudingest" title="Permalink"></a></h3><p>In case of 3DVar assimilation, the ecflow AnUA family should look like this:</p><p><img src="../../assets/CloudIngest_scheme.png" alt/></p><p>And a schematic work-flow of tasks and files involved:</p><p><img src="../../assets/cloudingest.svg" alt/></p><h2 id="Incremental-Analysis-Updates-IAU"><a class="docs-heading-anchor" href="#Incremental-Analysis-Updates-IAU">Incremental Analysis Updates - IAU</a><a id="Incremental-Analysis-Updates-IAU-1"></a><a class="docs-heading-anchor-permalink" href="#Incremental-Analysis-Updates-IAU" title="Permalink"></a></h2><p>This is a modified and experimental version of the default implemented Forward-Facing Incremental Analysis Update, that is described elsewhere (and mainly controlled via namelist settings). This algoritm is using the same code but is changed in a few fundamental ways on the logistical plane. Instead of introducing the innovations gradually in the forecast from the analysis point (as in default 3Dvar) the analysis is done at &quot;t=0&quot; and then the forecast is started at an earlier point so that the center of the introductions of the innovations are located at the above mentioned analysis point.</p><p>This is done through shifting the forecast start to 1h before &quot;t=0&quot; and activating a namelist change in the forecast namelist:</p><pre><code class="nohighlight hljs">NAMIAU=&gt;{
  &#39;LIAU&#39; =&gt; &#39;.TRUE.,&#39;,
  &#39;TSTARTIAU&#39; =&gt; &#39;1800.0,&#39;,
  &#39;TSTOPIAU&#39; =&gt; &#39;5400.0,&#39;,
  &#39;ALPHAIAU&#39; =&gt; &#39;1.0,&#39;,</code></pre><p>Hence the forecast is running freely for 30min and then starts adding the increments during 1h centered around the &quot;t=0&quot; point, during 1h. If these times are subject of change (for example if a larger window is desired, mind that you also need to have change what files are linked to various process such as the forecast so that the correct start files are linked to that process.</p><h3 id="Settings-4"><a class="docs-heading-anchor" href="#Settings-4">Settings</a><a class="docs-heading-anchor-permalink" href="#Settings-4" title="Permalink"></a></h3><p>If you want to try this method, or want to test it in order to develop it further there is a few thing to keep in mind. Before doing anything else you have to modify the write up times in <code>ecf/config_exp.h</code> so that the model have access to the startfiles that it needs inorder to start.</p><p>From the DEFAULT:</p><pre><code class="nohighlight hljs">    LL_LIST=&quot;12,3&quot;                          # Forecast lengths for the cycles [h], replaces LL, LLMAIN
    HWRITUPTIMES=&quot;00-21:3,24-60:6&quot;          # History file output times
    FULLFAFTIMES=$HWRITUPTIMES              # History FA file IO server gather times
    PWRITUPTIMES=&quot;00-60:3&quot;                  # Postprocessing times
    PFFULLWFTIMES=$PWRITUPTIMES             # Postprocessing FA file IO server gathering times
    VERITIMES=&quot;00-60:1&quot;                     # Verification output times, changes PWRITUPTIMES/SFXSELTIMES
    SFXSELTIMES=$PWRITUPTIMES               # Surfex select file output times</code></pre><p>to:</p><pre><code class="nohighlight hljs">    LL_LIST=&quot;12,6&quot;                          # Forecast lengths for the cycles [h], replaces LL, LLMAIN
    HWRITUPTIMES=&quot;00-06:1,06-21:3,24-60:6&quot;  # History file output times
    FULLFAFTIMES=$HWRITUPTIMES              # History FA file IO server gather times
    PWRITUPTIMES=&quot;00-06:1,06-60:3&quot;          # Postprocessing times
    PFFULLWFTIMES=$PWRITUPTIMES             # Postprocessing FA file IO server gathering times
    VERITIMES=&quot;00-60:1&quot;                     # Verification output times, changes PWRITUPTIMES/SFXSELTIMES
    SFXSELTIMES=$PWRITUPTIMES               # Surfex select file output times
                                            # Only meaningful if SURFEX_LSELECT=yes
    SFXSWFTIMES=$SFXSELTIMES                # SURFEX select FA file IO server gathering times
    SWRITUPTIMES=&quot;00-06:1&quot;                  # Surfex model state output times
    SFXWFTIMES=$SWRITUPTIMES                # SURFEX history FA file IO server gathering times</code></pre><ul><li><p>Then run one cycle for at least 6h so that all the prerequesite files are generated before turning on IAUVAR.</p></li><li><p>Second thing, when the previous run has completed, is to set the IAUVAR <code>ecf/config_exp.h</code> to yes and keep running.  It should be automatic to continue as usual. Make sure that you do not manually set <code>LL</code> to be shorter then 6h.</p></li></ul><p>The surface assimilation is moved to the start of the forecast and hence it is only the upper air assimilation that is involved in the IAU.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>There is a difference between the first run with IAUVAR and all the following, due to the first run couples to a run done without IAU and the others couple to a run that has done IAU, so the files used as startfiles are different in valid times. To this effect the first run saves a semaphore file in the <code>$SCRATCH/hm_home/exp_name/</code> directory for the following runs to react to!  So if you need to rerun the first run, for some reason, that semaphore file (named <code>is_iauvar</code>) needs to be manually removed!!</p></div></div><h3 id="Flow-diagram-of-IAU-(Magnus-will-help)"><a class="docs-heading-anchor" href="#Flow-diagram-of-IAU-(Magnus-will-help)">Flow diagram of IAU (Magnus will help)</a><a id="Flow-diagram-of-IAU-(Magnus-will-help)-1"></a><a class="docs-heading-anchor-permalink" href="#Flow-diagram-of-IAU-(Magnus-will-help)" title="Permalink"></a></h3></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../StructureFunctions/">« Structure functions</a><a class="docs-footer-nextpage" href="../DigitalFilterInitialization/">Digital Filter Initialization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Wednesday 16 October 2024 09:19">Wednesday 16 October 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
