<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MUSC · Harmonie wiki</title><meta name="title" content="MUSC · Harmonie wiki"/><meta property="og:title" content="MUSC · Harmonie wiki"/><meta property="twitter:title" content="MUSC · Harmonie wiki"/><meta name="description" content="Documentation for Harmonie wiki."/><meta property="og:description" content="Documentation for Harmonie wiki."/><meta property="twitter:description" content="Documentation for Harmonie wiki."/><meta property="og:url" content="https://hirlam.github.io/HarmonieSystemDocumentation/dev/ForecastModel/SingleColumnModel/MUSC/"/><meta property="twitter:url" content="https://hirlam.github.io/HarmonieSystemDocumentation/dev/ForecastModel/SingleColumnModel/MUSC/"/><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/ForecastModel/SingleColumnModel/MUSC/"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Harmonie wiki</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../../DataAssimilation/MTEN/">MTEN</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-3-2"><span class="docs-label">Forecast(spin-up)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/CHKEVO/">CHKEVO</a></li><li><a class="tocitem" href="../../../DataAssimilation/NWECHKEVO/">NWECHKEVO</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox" checked/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../Outputlist/">Output List</a></li><li><a class="tocitem" href="../../HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-5-5" type="checkbox" checked/><label class="tocitem" for="menuitem-3-5-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>MUSC</a><ul class="internal"><li><a class="tocitem" href="#MUSC-using-the-develop-branch-(CY46)-in-the-git-repository"><span>MUSC using the develop branch (CY46) in the git repository</span></a></li><li><a class="tocitem" href="#Set-up-MUSC"><span>Set up MUSC</span></a></li><li><a class="tocitem" href="#Run-MUSC"><span>Run MUSC</span></a></li><li><a class="tocitem" href="#MUSC-Output"><span>MUSC Output</span></a></li><li><a class="tocitem" href="#Creating-your-own-input-files"><span>Creating your own input files</span></a></li><li><a class="tocitem" href="#Forcing-in-MUSC"><span>Forcing in MUSC</span></a></li><li><a class="tocitem" href="#MUSC-local-adaptation"><span>MUSC local adaptation</span></a></li><li><a class="tocitem" href="#MUSC-FAQ"><span>MUSC FAQ</span></a></li><li><a class="tocitem" href="#MUSC-variable-names"><span>MUSC variable names</span></a></li><li><a class="tocitem" href="#Outstanding-Issues"><span>Outstanding Issues</span></a></li><li><a class="tocitem" href="#MUSC-using-EMS"><span>MUSC using EMS</span></a></li></ul></li><li><a class="tocitem" href="../Forcing/">Forcing</a></li><li><a class="tocitem" href="../MUSC_EMS/">MUSC EMS</a></li><li><a class="tocitem" href="../MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../../EPS/System/">System</a></li><li><a class="tocitem" href="../../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../../System/UpdateNamelists/">Update Namelist</a></li></ul></li><li><a class="tocitem" href="../../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Forecast Model</a></li><li><a class="is-disabled">Single Column Model</a></li><li class="is-active"><a href>MUSC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MUSC</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Hirlam/Harmonie" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/ForecastModel/SingleColumnModel/MUSC.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MUSC"><a class="docs-heading-anchor" href="#MUSC">MUSC</a><a id="MUSC-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC" title="Permalink"></a></h1><h2 id="MUSC-using-the-develop-branch-(CY46)-in-the-git-repository"><a class="docs-heading-anchor" href="#MUSC-using-the-develop-branch-(CY46)-in-the-git-repository">MUSC using the develop branch (CY46) in the git repository</a><a id="MUSC-using-the-develop-branch-(CY46)-in-the-git-repository-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-using-the-develop-branch-(CY46)-in-the-git-repository" title="Permalink"></a></h2><p>If you find any issues with any of the instructions or scripts, feel free to notify Emily Gleeson (emily.gleesonATmet.ie) and Eoin Whelan (eoin.whelanATmet.ie)</p><p>Currently a &quot;reference&quot; test case, called <code>musc_ref</code>, works on ATOS, as well as  the ARMCU cases (with and without SURFEX for both AROME and HARMONIE namelists) and the two microphysics-related cases (supercooled liquid) developed by Bjorg Jenny Engdahl in cycle 40. </p><p>Some instructions on how to use MUSC are included below. See <a href="https://asr.copernicus.org/articles/17/255/2020/">here</a> for some information on HARMONIE-AROME experiments using MUSC but note that the scripts have changed somewhat since that paper was written.</p><h2 id="Set-up-MUSC"><a class="docs-heading-anchor" href="#Set-up-MUSC">Set up MUSC</a><a id="Set-up-MUSC-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-MUSC" title="Permalink"></a></h2><ol><li><p>Get the code:</p><pre><code class="language-bash hljs">mkdir -p $SCRATCH/harmonie_releases/git/HCY46
cd $SCRATCH/harmonie_releases/git/HCY46
git clone git@github.com:Hirlam/Harmonie.git
cd Harmonie
git checkout dev-CY46h1 
# If you already have a clone of the code but want to update it to the latest version, 
use &quot;git pull&quot; rather than &quot;git branch&quot;.</code></pre></li><li><p>Set up a MUSC experiment using HARMONIE scripting </p><p>In this example the <code>ECMWF.atos</code> config file is used. </p><pre><code class="language-bash hljs">mkdir -p $HOME/hm_home/test_0001
cd $HOME/hm_home/test_0001
$SCRATCH/harmonie_releases/git/HCY46/Harmonie/config-sh/Harmonie setup -r $SCRATCH/harmonie_releases/git/HCY46/Harmonie/ -h ECMWF.atos </code></pre></li><li><p>Compile your experiment (still in <code>$HOME/hm_home/test_0001</code>)</p><pre><code class="language-bash hljs">$SCRATCH/harmonie_releases/git/HCY46/Harmonie/config-sh/Harmonie install BUILD_WITH=cmake
# Note that for the ARMCU cases cmake needs FFT modifications (not yet committed by Yurii)</code></pre></li><li><p>Some MUSC specific settings including copying over scripts and a check that Harmonie setup has been run</p><pre><code class="language-bash hljs">$SCRATCH/harmonie_releases/git/HCY46/Harmonie/util/musc/scr/musc_setup.sh -r $SCRATCH/harmonie_releases/git/HCY46/Harmonie/</code></pre></li><li><p>Generate your namelist, unless you&#39;re using an idealised case with pre-defined namelists (so for ARMCU* you do not generate the namelists for example). If you wish to change the radiation scheme (RADSCHEME- RAYFM (IFS) or RAY (ACRANEB2)) or how you use aerosols (BDAER - cams or none), you need to edit ecf/config<em>exp.h in your expt before running musc</em>namelist.sh. For using NRT aerosols, they need to be included in your input files already e.g. the MUSCIN* files should come from a 3D NRT aerosol expt.</p><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_namelist.sh -h
./musc_namelist.sh -l &lt;length of run&gt; -i &lt;the ID name on the generated namelist files e.g. DEF&gt; 
                     -[N nudging - optional]</code></pre></li><li><p>Get a copy of the input files</p><pre><code class="language-bash hljs">cd $SCRATCH
retrieve the input files from https://github.com/Hirlam/HarmonieMuscData</code></pre></li></ol><ul><li>Note that if you need to do experiments with 2 patches etc, ensure you derive some MUSC input files yourself using 3D HARMONIE-AROME files run with 2 patches. <code>MUSC*REFL65*</code> input files have only 1 patch. Changing MUSC namelists won&#39;t enable 2 patch output from a MUSC run.</li></ul><h2 id="Run-MUSC"><a class="docs-heading-anchor" href="#Run-MUSC">Run MUSC</a><a id="Run-MUSC-1"></a><a class="docs-heading-anchor-permalink" href="#Run-MUSC" title="Permalink"></a></h2><h3 id="Musc_ref"><a class="docs-heading-anchor" href="#Musc_ref"><code>Musc_ref</code></a><a id="Musc_ref-1"></a><a class="docs-heading-anchor-permalink" href="#Musc_ref" title="Permalink"></a></h3><p>The reference test is a X-hr experiment (change CSTOP in <code>musc_namelist.sh</code> if you wish to change the run length) and produces Out <code>*lfa</code> files for each model time-step of the time period. <code>ICM*</code> files are produced at each hour.</p><ol><li><p>Run your experiment</p><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_run.sh -h
./musc_run.sh -d $SCRATCH/muscCY46InputData/musc_ref -n REFL65 -i DEF [ -e ECOCLIMAP_PATH]
# optional path for ECOCLIMAP data may be given. For musc_ref -i must be given as no 
# namelists are provided with this experiment and must be generated before musc_run.sh 
# is executed. For the idealised cases, if -i is not specified -i becomes the name of 
# the idealised case once the namelist files are copied to $HOME/hm_home/test_0001 e.g. 
# for armcu the namelist files become namelist_atm_armcu etc.
</code></pre></li></ol><h3 id="ARMCU"><a class="docs-heading-anchor" href="#ARMCU">ARMCU</a><a id="ARMCU-1"></a><a class="docs-heading-anchor-permalink" href="#ARMCU" title="Permalink"></a></h3><p>** Note that these will not work until we can compile with FFTW.</p><p>This is an idealized SCM test case, the &quot;Sixth GCSS WG-1 case (ARM—Atmospheric Radiation Measurement)&quot;, focussing on the diurnal cycle of cumulus clouds over land (<a href="https://doi.org/10.1256/003590002320373210">Brown et al, 2002</a>, <a href="https://doi.org/10.1256/qj.03.122">Lenderink et al, 2004</a>. The input files and namelist settings have been taken from /src/validation/mitraille/namelist/L1<em>ARO</em> but the atmospheric namelist needed editing for use in our environment. Atmospheric and surface forcings are included in the MUSC input files and the namelists in the util/musc/test/armcu directory are set up specifically for this case and are hence not edited by musc_run.sh.</p><ol><li>Run your experiment<pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_run.sh -h
./musc_run.sh -d $HOME/muscCY46InputData/ARMCU_HAR -n ARMCU (There are now 4 ARMCU experiments to chose from e.g. ARMCU_EB and ARMCUs_EB are ones that use AROME namelists, ARMCU_Har and ARMCUs_Har use HARMONIE-AROME namelists. Currently, the results are a bit different.)</code></pre></li></ol><h2 id="MUSC-Output"><a class="docs-heading-anchor" href="#MUSC-Output">MUSC Output</a><a id="MUSC-Output-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-Output" title="Permalink"></a></h2><h3 id="DDH-Toolbox"><a class="docs-heading-anchor" href="#DDH-Toolbox">DDH Toolbox</a><a id="DDH-Toolbox-1"></a><a class="docs-heading-anchor-permalink" href="#DDH-Toolbox" title="Permalink"></a></h3><p>The outputs from a MUSC run are small files in lfa format. DDH tools can be used to handle these files.</p><p>To download the DDH toolbox, go to https://www.umr-cnrm.fr/gmapdoc/spip.php?article19 and download the tarball. Untar it and within the <code>tools</code> folder run <code>./install</code>. Now the various &quot;tools&quot; are compiled. For example <code>lfaminm $file</code> shows you the max, min and mean of all the output variables in a file. <code>lfac $file $var</code> shows the value(s) of <code>$var</code> in <code>$file</code> e.g. <code>lfac Out.000.0000.lfa</code> PTS shows you surface temperature. In order to be able to use the plotting scripts below, you&#39;ll need the lfac tool in your path. </p><p>For example on ATOS, I set the following paths (may differ a bit for you depending on where you downloaded the ddhtools to). Perhaps add to your .bashrc file:</p><ul><li><code>export PATH=$HOME/ddhtoolbox/tools/lfa/:$PATH</code></li><li><code>export DDHI_BPS=$HOME/ddhtoolbox/ddh_budget_lists/</code></li><li><code>export DDHI_LIST=$HOME/ddhtoolbox/ddh_budget_lists/conversion_list</code></li></ul><h3 id="Plot-output-time-series-from-the-MUSC-output-lfa-files"><a class="docs-heading-anchor" href="#Plot-output-time-series-from-the-MUSC-output-lfa-files">Plot output time-series from the MUSC output lfa files</a><a id="Plot-output-time-series-from-the-MUSC-output-lfa-files-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-output-time-series-from-the-MUSC-output-lfa-files" title="Permalink"></a></h3><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_plot1Dts.sh -d &lt;musc-data-dir&gt;

## python based plotting scripts and &quot;default&quot; png plots 
## will be produced in $HOME/hm_home/test_0001/plots1Dts
</code></pre><h3 id="Extract-output-from-the-MUSC-output-ICM*-fa-files-and-plot-time-series-using-these"><a class="docs-heading-anchor" href="#Extract-output-from-the-MUSC-output-ICM*-fa-files-and-plot-time-series-using-these">Extract output from the MUSC output <code>ICM*</code> fa files and plot time-series using these</a><a id="Extract-output-from-the-MUSC-output-ICM*-fa-files-and-plot-time-series-using-these-1"></a><a class="docs-heading-anchor-permalink" href="#Extract-output-from-the-MUSC-output-ICM*-fa-files-and-plot-time-series-using-these" title="Permalink"></a></h3><ul><li>By default you get ICM* files on the hour - you can change the namelist should you require a higher frequency.</li></ul><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_convertICM2ascii.sh -l &lt;number_hours_in_expt_run&gt; -f &lt;path_to_your_musc_output&gt;

## Generates an OUT ascii file for each atm and sfx ICM* input file
## ICM files have additional input not in lfa files e.g. TKE which is useful - also similar to 3D outputs

./musc_plot_profiles_ICMfiles.sh -d &lt;data-dir&gt; -p &lt;parameter-model-level&gt; -l &lt;run_length_hours&gt;
</code></pre><h2 id="Creating-your-own-input-files"><a class="docs-heading-anchor" href="#Creating-your-own-input-files">Creating your own input files</a><a id="Creating-your-own-input-files-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-your-own-input-files" title="Permalink"></a></h2><p>A converter script, <code>musc_convert.sh</code>, is available to extract a MUSC column from a model state file (<code>ICMSHHARM+HHHH</code>). <code>musc_convert.sh</code> is a Bash script that calls <code>gl_grib_api</code> to carry the data conversions.</p><h3 id="Extract-a-MUSC-input-file"><a class="docs-heading-anchor" href="#Extract-a-MUSC-input-file">Extract a MUSC input file</a><a id="Extract-a-MUSC-input-file-1"></a><a class="docs-heading-anchor-permalink" href="#Extract-a-MUSC-input-file" title="Permalink"></a></h3><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_convert.sh -d $HOME/muscCY46InputData/harm_arome/ -c extr3d -n REFIRL -l 53.5,-7.5 -t 6
mkdir $HOME/muscCY46InputData/musc_refirl
cp MUSCIN_REFIRL_atm.fa MUSCIN_REFIRL_sfx.fa MUSCIN_REFIRL_pgd.fa $HOME/muscCY46InputData/musc_refirl/</code></pre><h3 id="Convert-MUSC-FA-to-MUSC-ASCII"><a class="docs-heading-anchor" href="#Convert-MUSC-FA-to-MUSC-ASCII">Convert MUSC FA to MUSC ASCII</a><a id="Convert-MUSC-FA-to-MUSC-ASCII-1"></a><a class="docs-heading-anchor-permalink" href="#Convert-MUSC-FA-to-MUSC-ASCII" title="Permalink"></a></h3><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_convert.sh -c fa2ascii -d $HOME/muscCY46InputData/musc_refirl -n REFIRL
ls -ltr
cp MUSCIN_REFIRL_atm.ascii MUSCIN_REFIRL_sfx.ascii $HOME/muscCY46InputData/musc_refirl/</code></pre><h3 id="Convert-MUSC-ASCII-to-MUSC-FA"><a class="docs-heading-anchor" href="#Convert-MUSC-ASCII-to-MUSC-FA">Convert MUSC ASCII to MUSC FA</a><a id="Convert-MUSC-ASCII-to-MUSC-FA-1"></a><a class="docs-heading-anchor-permalink" href="#Convert-MUSC-ASCII-to-MUSC-FA" title="Permalink"></a></h3><pre><code class="language-bash hljs">cd $HOME/hm_home/test_0001
./musc_convert.sh -c ascii2fa -d $HOME/muscCY46InputData/musc_refirl -n REFIRL
ls -ltr</code></pre><h2 id="Forcing-in-MUSC"><a class="docs-heading-anchor" href="#Forcing-in-MUSC">Forcing in MUSC</a><a id="Forcing-in-MUSC-1"></a><a class="docs-heading-anchor-permalink" href="#Forcing-in-MUSC" title="Permalink"></a></h2><ul><li><code>musc_convert.sh</code> includes forcing for temperature (11), humidity (51) and wind speed (32) . </li></ul><p>You may edit the following lines to include other forcing:</p><pre><code class="language-bash hljs">  PPPKEY(1:4)%shortname  = &#39;ws&#39;,&#39;#&#39;,&#39;#&#39;,&#39;#&#39;,
  PPPKEY(1:4)%faname  = &#39;#&#39;,&#39;SNNNFORC001&#39;,&#39;SNNNFORC002&#39;,&#39;SNNNFORC003&#39;
  PPPKEY(1:4)%levtype = &#39;hybrid&#39;,&#39;hybrid&#39;,&#39;hybrid&#39;,&#39;hybrid&#39;,
  PPPKEY(1:4)%level   = -1,-1,-1,-1,
  PPPKEY(1:4)%pid     = 32,-1,-1,-1,
  PPPKEY(1:4)%nnn     = 0,0,0,0,
  PPPKEY(1:4)%lwrite  = F,T,T,T,
  IFORCE              = 11,51,32,</code></pre><ul><li>Further information on forcing is available here: <a href="../Forcing/#musc-forcing">MUSC/Forcing</a></li></ul><h2 id="MUSC-local-adaptation"><a class="docs-heading-anchor" href="#MUSC-local-adaptation">MUSC local adaptation</a><a id="MUSC-local-adaptation-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-local-adaptation" title="Permalink"></a></h2><h3 id="KNMI-workstations"><a class="docs-heading-anchor" href="#KNMI-workstations">KNMI workstations</a><a id="KNMI-workstations-1"></a><a class="docs-heading-anchor-permalink" href="#KNMI-workstations" title="Permalink"></a></h3><p>The following files were added to make it possible to run MUSC on KNMI workstations:</p><pre><code class="language-bash hljs">config-sh/config.LinuxPC-MPI-KNMI
config-sh/submit.LinuxPC-MPI-KNMI
util/makeup/config.linux.gfortran.mpi-knmi </code></pre><p>for use with the setup script:</p><pre><code class="language-bash hljs">./musc_setup.sh [...] -c LinuxPC-MPI-KNMI</code></pre><p>In addition, the following workaround has to be applied to be able to run the <code>REFL65</code> test case:</p><pre><code class="language-bash hljs">$ git diff src/ifsaux/utilities/echien.F90
diff --git a/src/ifsaux/utilities/echien.F90 b/src/ifsaux/utilities/echien.F90
index 55d5ce94e..694c87d83 100644
--- a/src/ifsaux/utilities/echien.F90
+++ b/src/ifsaux/utilities/echien.F90
@@ -532,7 +532,7 @@ IF((KINF == 0).OR.(KINF == -1).OR.(KINF == -2).OR.(KINF == -3)) THEN
            &amp; &#39;LEVEL &#39;,JFLEV,&#39; : &#39;,&amp;
            &amp; &#39;FILE = &#39;,ZVALH(JFLEV), &#39; ; ARGUMENT = &#39;,PVALH(JFLEV)
           IERRA=1
-          IERR=1
+!         IERR=1
         ENDIF
         IF(ABS(ZVBH(JFLEV)-PVBH(JFLEV)) &gt; PEPS) THEN
           WRITE(KULOUT,*) &#39; VERTICAL FUNCTION *B* MISMATCH ON &#39;,&amp;</code></pre><p>Then you are ready to compile:</p><ul><li>remove the file experiment<em>is</em>locked from the experiment directory.</li><li>remove the directory with your previous build (if any).</li><li>start the compile with the musc_compile.sh script</li></ul><p>When starting the MUSC run, add the PATH to mpirun and the libraries:</p><pre><code class="language-bash hljs">export PATH=$PATH:/usr/lib64/openmpi/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib64/openmpi/lib
./musc_run.sh [...]</code></pre><h2 id="MUSC-FAQ"><a class="docs-heading-anchor" href="#MUSC-FAQ">MUSC FAQ</a><a id="MUSC-FAQ-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-FAQ" title="Permalink"></a></h2><ol><li><p>If there is an error, what files do I look in? <code>NODE.001_01</code> and lola in your output directory.</p></li><li><p>How to I handle the output files? The output files are of the form <code>Out.XXX.XXXX</code> and appear in your output directory. There are in lfa format and can be handled using ddh tools. See the bash script <code>musc_plot1Dts.sh</code> for ideas. There are also <code>ICM*lfa</code> output files that are also handy for plotting profiles - use <code>musc_convertICM2ascii.sh</code> to convert these files to ASCII and <code>musc_plot_profiles_ICMfiles.sh</code> to plot some profiles e.g. TKE, cloud liquid etc.</p></li><li><p>I ran a different idealised case but did not get different results? The likely reason for this is that you did not delete the namelists from your experiment directory. If the namelists are there, the <code>musc_run.sh</code> script neither creates them nor copies them from the repository.</p></li><li><p>How do I create a new idealised case? This is not straightforward but the following was used to create the ASTEX cases in cy43 using info from cy38: https://www.overleaf.com/7513443985ckqvfdcphnng</p></li><li><p>How can I access a list of MUSC output parameters? Ensure you have the ddhtoolbox compiled. Then use lfaminm <code>$file</code> on any of your output files and it will show what is there. To look at a particular variable try <code>lfac $file $parameter</code> e.g. <code>lfac $file PTS</code> (for surface temperature). You can use cat to copy the values to an ASCII file for ease of use (e.g. <code>lfac $file PTS &gt; $ASCIIfile</code>).  </p></li><li><p>Is MUSC similar to the full 3D model version - is the physics the same? Yes, if you checkout develop then you have MUSC up-to-date with that.</p></li><li><p>Do I need to recompile the model if I modify code? Yes, if you modify code in a single file you must recompile the code but do not delete the original compiled model first. This will recompile relatively quickly. If you modify code in multiple files and you change what variables are passed between files, then you must delete your original compiled model and recompile the code. This will take longer to recompile. </p></li></ol><h2 id="MUSC-variable-names"><a class="docs-heading-anchor" href="#MUSC-variable-names">MUSC variable names</a><a id="MUSC-variable-names-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-variable-names" title="Permalink"></a></h2><p>A list of variable names found in the MUSC lfa output files can be found <a href="../MUSC_vars/#musc-vars">here</a>. Please note that this is not a complete list of MUSC output parameters (yet). The variables in regular <code>ICMSH...</code> fa output are documented <a href="../../Outputlist/#outputlist">here</a></p><h2 id="Outstanding-Issues"><a class="docs-heading-anchor" href="#Outstanding-Issues">Outstanding Issues</a><a id="Outstanding-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Outstanding-Issues" title="Permalink"></a></h2><ol><li>ARMCU and Jenny&#39;s cases run without surface physics, radiation etc and hence return <code>NANs</code> in <code>apl_arome</code>. To circumvent this on ECMWF, we needed to compile less strictly. This needs to be investigated further.</li><li>The ASTEX cases currently do not run on ECMWF but work perfectly at Met Eireann - debugging needed.</li></ol><h2 id="MUSC-using-EMS"><a class="docs-heading-anchor" href="#MUSC-using-EMS">MUSC using EMS</a><a id="MUSC-using-EMS-1"></a><a class="docs-heading-anchor-permalink" href="#MUSC-using-EMS" title="Permalink"></a></h2><p>These instructions have moved to <a href="../MUSC_EMS/">MUSC EMS</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../HR/">« High Res</a><a class="docs-footer-nextpage" href="../Forcing/">Forcing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.0.1 on <span class="colophon-date" title="Monday 4 December 2023 11:14">Monday 4 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
