<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Makeup · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-221448594-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-221448594-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/Build/Build_with_makeup/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li><li><a class="tocitem" href="../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../DataAssimilation/MTEN/">MTEN</a></li><li><a class="tocitem" href="../../DataAssimilation/CHKEVO/">CHKEVO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-4-5" type="checkbox"/><label class="tocitem" for="menuitem-3-4-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox" checked/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Build_with_cmake/">CMake</a></li><li class="is-active"><a class="tocitem" href>Makeup</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#MAKEUP-very-quickly"><span>MAKEUP very quickly</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)"><span>Using MAKEUP to build <code>auxlibs</code> (<code>bufr</code>, <code>gribex</code>, <code>rgb</code>)</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-also-util/gl-tools"><span>Using MAKEUP to build also util/gl -tools</span></a></li><li><a class="tocitem" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools"><span>Using MAKEUP to build also Oulan and/or Monitor -tools</span></a></li><li><a class="tocitem" href="#Building-objects-away-from-HARMONIE_SRC-directory"><span>Building objects away from <code>$HARMONIE_SRC</code>-directory</span></a></li><li><a class="tocitem" href="#More-details"><span>More details</span></a></li><li><a class="tocitem" href="#How-is-ODB-related-stuff-handled-?"><span>How is ODB related stuff handled ?</span></a></li><li><a class="tocitem" href="#Miscellaneous-stuff"><span>Miscellaneous stuff</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../System/UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">System</a></li><li><a class="is-disabled">Build</a></li><li class="is-active"><a href>Makeup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Makeup</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/Build/Build_with_makeup.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Building-with-MAKEUP"><a class="docs-heading-anchor" href="#Building-with-MAKEUP">Building with MAKEUP</a><a id="Building-with-MAKEUP-1"></a><a class="docs-heading-anchor-permalink" href="#Building-with-MAKEUP" title="Permalink"></a></h1><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>Makeup is an alternative mechanism to build the HARMONIE system Instead of using GMKPACK to build the libraries and binaries, standard GNU make (gmake) procedures are used, making build of executables an easier task. Also parallel make comes for free, thus enhanced turn-around time for build process. Furthermore, rebuilds and change of compiler flags – either per project and/or per source files basis – are now trivial to do.</p><h2 id="MAKEUP-very-quickly"><a class="docs-heading-anchor" href="#MAKEUP-very-quickly">MAKEUP very quickly</a><a id="MAKEUP-very-quickly-1"></a><a class="docs-heading-anchor-permalink" href="#MAKEUP-very-quickly" title="Permalink"></a></h2><p>The process of using the MAKEUP system in stand-alone fashion is described next.</p><p>Lets define two helper variables for the presentation purposes:</p><p>The variable <code>$HARMONIE_SRC</code> refers to the directory, where the AROME source code is situated. Another variable <code>$HARMONIE_MAKEUP</code> refers to the directory, where build configuration files and MAKEUP&#39;s scripts are located. </p><pre><code class="language-bash hljs">#!sh
# In ksh/bash
export HARMONIE_SRC=/some/path/harmonie/src
export HARMONIE_MAKEUP=/some/path/harmonie/util/makeup
# In csh/tcsh
setenv HARMONIE_SRC /some/path/harmonie/src
setenv HARMONIE_MAKEUP /some/path/harmonie/util/makeup</code></pre><p>Usually <code>$HARMONIE_MAKEUP</code> is <code>$HARMONIE_SRC/../util/makeup</code> , but it doesn&#39;t have to be (e.g. in FMI&#39;s production system the <code>$HARMONIE_MAKEUP</code> is situated on a separate disk than the source code <code>$HARMONIE_SRC</code>) – and <code>MAKEUP</code> can handle this now.</p><p>The process of building HARMONIE executable contains just a few steps:</p><ol><li><p>Goto directory <code>$HARMONIE_MAKEUP</code> and create/edit your configuration file (<code>config.*</code>). Beware of preferred naming convention:</p><pre><code class="language-bash hljs">config.&lt;MET-INSTITUTE&gt;.&lt;MACHINE-PLATFORM&gt;.&lt;COMPILER-NAME&gt;.&lt;FUNDAMENTAL-OPTIONS&gt;.&lt;OPTIONAL-OPTIONS&gt;</code></pre></li><li><p>Run MAKEUP&#39;s configure script under <code>$HARMONIE_SRC</code> (for example):</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre></li><li><p>If applicable, adjust environment settings before launching of make. e.g., on some platforms, one needs to remember loading adequate modules, such as for DMI Cray XT5,</p><pre><code class="language-bash hljs">module swap PrgEnv-pgi PrgEnv-pathscale  # if pathscale is to be used
module swap xt-mpt xt-mpt/3.5.0
module swap xt-asyncpe/3.8 xt-asyncpe/3.4</code></pre></li><li><p>Goto <code>$HARMONIE_SRC</code> directory and type make (or gmake, if make is non-GNU make). Redirect output to a file &amp; terminal:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
gmake 2&gt;&amp;1 |  tee logfile  # ksh/bash
gmake      |&amp; tee logfile  # csh/tcsh</code></pre></li></ol><h2 id="Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)">Using MAKEUP to build <code>auxlibs</code> (<code>bufr</code>, <code>gribex</code>, <code>rgb</code>)</a><a id="Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)-1"></a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-auxlibs-(bufr,-gribex,-rgb)" title="Permalink"></a></h2><p>You can now build EMOS- and related libraries by using the MAKEUP. All you need to know is what is your <code>sources.&lt;arch&gt;</code> that you would use to build this stuff anyway. Pass that generic name to the MAKEUP&#39;s configure through <code>-E</code> option and you&#39;re in business. An example for FMI&#39;s Cray:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -E sources.crayxt $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><p>This will create extra libs (so called <code>MY_SYSLIBS</code>) <code>libbufr.a</code>, <code>libgribex.a</code> and <code>librgb.a</code> and they will end up being linked into your executables, like <code>MASTERODB</code>.</p><h2 id="Using-MAKEUP-to-build-also-util/gl-tools"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-also-util/gl-tools">Using MAKEUP to build also util/gl -tools</a><a id="Using-MAKEUP-to-build-also-util/gl-tools-1"></a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-also-util/gl-tools" title="Permalink"></a></h2><p>HARMONIE utility package GL as located in util/gl directory can also be built as part of MAKEUP process, if option <code>-G</code> is also given to the configure:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -G $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h2 id="Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools"><a class="docs-heading-anchor" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools">Using MAKEUP to build also Oulan and/or Monitor -tools</a><a id="Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools-1"></a><a class="docs-heading-anchor-permalink" href="#Using-MAKEUP-to-build-also-Oulan-and/or-Monitor-tools" title="Permalink"></a></h2><p>HARMONIE utility package MONITOR and obs-preprocessor OULAN can also be build with MAKEUP. If you add option <code>-B</code> , then you will get Oulan and Monitor executables built, too. Or you can be more selective and oopt only for oulan with <code>-b oulan</code>, or just monitor <code>-b monitor</code> :</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
# Request for building both oulan &amp; monitor, too
$HARMONIE_MAKEUP/configure -B $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# .. or add oulan only :
$HARMONIE_MAKEUP/configure -b oulan $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# .. or add monitor only :
$HARMONIE_MAKEUP/configure -b monitor $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h2 id="Building-objects-away-from-HARMONIE_SRC-directory"><a class="docs-heading-anchor" href="#Building-objects-away-from-HARMONIE_SRC-directory">Building objects away from <code>$HARMONIE_SRC</code>-directory</a><a id="Building-objects-away-from-HARMONIE_SRC-directory-1"></a><a class="docs-heading-anchor-permalink" href="#Building-objects-away-from-HARMONIE_SRC-directory" title="Permalink"></a></h2><p>If you do not want to pollute your source directories with objects and thus making it hard to recognize which files are under version handling system SVN and which ain&#39;t (... although SVN command <code>svn -q st</code> would tell ...), then use -P option. This will redirect compilations away from source code, under <code>$HARMONIE_SRC/../makeup.ZZZ</code>, where <code>ZZZ</code> is the suffix of your config-file, e.g. <code>FMI.cray_xt5m.pathscale.mpi+openmp</code>.</p><p>The operation sequence is as follows:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure [options] -P $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
cd $HARMONIE_SRC/../makeup.FMI.cray_xt5m.pathscale.mpi+openmp/src
gmake</code></pre><p>The drawback with this approach is that whenever there is an update in the master source directories, you need to run lengthy <code>configure</code> in order to rsync the working directory up to date. We may need to introduce a separate command for this to avoid full rerun of <code>configure</code>.</p><p>You can also use lowercase <code>-p</code> option with argument pointing to a directory-root, where to compile:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure [options] -p /working/path $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
cd /working/path/src
gmake</code></pre><p>Now, it is important to understand that this <code>/working/path</code> has no connection to version handling i.e. if you change something  in your master copy (say : issue a <code>svn up</code>-command), then your working directory remains unaltered. To synchronize it, do the following:</p><pre><code class="language-bash hljs">cd /working/path/src
gmake rsync</code></pre><h2 id="More-details"><a class="docs-heading-anchor" href="#More-details">More details</a><a id="More-details-1"></a><a class="docs-heading-anchor-permalink" href="#More-details" title="Permalink"></a></h2><h3 id="Re-running-configure"><a class="docs-heading-anchor" href="#Re-running-configure">Re-running configure</a><a id="Re-running-configure-1"></a><a class="docs-heading-anchor-permalink" href="#Re-running-configure" title="Permalink"></a></h3><p>Afterwards you can rerun configure as many times as you wish.  Please note that the very first time is always slowed (maybe 10 minutes) as interface blocks for arp/ and ald/ projects are generated.</p><p>Usually running configure many times is not necessary – not even when you have changed your config-file (!) – except when interface blocks needs to be updated/re-created (<code>-c</code> or <code>-g</code> options). For example, when subroutine/function call argument list has changed. Then the whole config+build sequence can be run under <code>$HARMONIE_SRC</code> as follows:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
# -c option: Check if *some* interface blocks need regeneration and regenerate
$HARMONIE_MAKEUP/configure -c $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# -g option: Force to regenerate interface blocks 
# $HARMONIE_MAKEUP/configure -g $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
gmake</code></pre><h3 id="Changing-the-number-of-tasks-for-compilation"><a class="docs-heading-anchor" href="#Changing-the-number-of-tasks-for-compilation">Changing the number of tasks for compilation</a><a id="Changing-the-number-of-tasks-for-compilation-1"></a><a class="docs-heading-anchor-permalink" href="#Changing-the-number-of-tasks-for-compilation" title="Permalink"></a></h3><p>The number of tasks used for gmake-compilations is set by default to 8. See NPES parameter in HARMONIE_MAKEUP/defaults.mk To change the default, you can have two choices:</p><ol><li>Add <code>NPES</code> to your config-file, for example set it to 2:<pre><code class="language-bash hljs">NPES=2</code></pre></li><li>Invoke gmake with NPES parameter, e.g. set it to 10:<pre><code class="language-bash hljs">gmake NPES=10</code></pre></li></ol><h3 id="Inserting-DRHOOK-for-Meso-projects"><a class="docs-heading-anchor" href="#Inserting-DRHOOK-for-Meso-projects">Inserting DRHOOK for Meso-projects</a><a id="Inserting-DRHOOK-for-Meso-projects-1"></a><a class="docs-heading-anchor-permalink" href="#Inserting-DRHOOK-for-Meso-projects" title="Permalink"></a></h3><p>To insert <code>DrHook</code> profiling automatically for mpa/ and mse/ projects, reconfigure with <code>-H</code> option:</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -H $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><p>You can also pick and choose either mpa/ or mse/ projects with <code>-h</code> option (can be supplied several times):</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -h mpa $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
$HARMONIE_MAKEUP/configure -h mse $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
# The following are the same as if the option -H was used
$HARMONIE_MAKEUP/configure -h mpa -h mse -h surfex $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp
$HARMONIE_MAKEUP/configure -h mpa:mse:surfex $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre><p>In the future it may not be necessary to insert <code>DrHook</code> automagically, if the insertion has been  done in the <code>svn</code> (version handling) level.</p><h3 id="Speeding-up-compilations-by-use-of-RAM-disk"><a class="docs-heading-anchor" href="#Speeding-up-compilations-by-use-of-RAM-disk">Speeding up compilations by use of RAM-disk</a><a id="Speeding-up-compilations-by-use-of-RAM-disk-1"></a><a class="docs-heading-anchor-permalink" href="#Speeding-up-compilations-by-use-of-RAM-disk" title="Permalink"></a></h3><p>To further speedup compilation and if you have several GBytes of Linux RAM-disk (/dev/shm) available, do the following:</p><ol><li><p>Create your personal RAM-disk subdirectory and check available disk space</p><pre><code class="language-bash hljs">mkdir /dev/shm/$USER
df -kh /dev/shm/$USER</code></pre></li><li><p>Reconfigure with RAM-disk either by defining LIBDISK in your config-file or running</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
$HARMONIE_MAKEUP/configure -L /dev/shm/$USER $HARMONIE_MAKEUP/config.FMI.cray_xt5m.pathscale.mpi+openmp</code></pre></li><li><p>Also define TMPDIR to point to /dev/shm/USER to allow compiler specific temporary files on RAM-disk</p><pre><code class="language-bash hljs"># In ksh/bash-shells:
export TMPDIR=/dev/shm/$USER
gmake 2&gt;&amp;1 |  tee logfile
# In csh/tcsh-shells:
setenv TMPDIR /dev/shm/$USER
gmake      |&amp; tee logfile</code></pre></li></ol><p>Please note that the step-2 creates all libraries AND executablus under the directory pointed by the <code>-L</code> argument. Object files and modules still, however, are placed under corresponding source directories.</p><h3 id="What-if-you-run-out-of-RAM-disk-space-?"><a class="docs-heading-anchor" href="#What-if-you-run-out-of-RAM-disk-space-?">What if you run out of RAM-disk space ?</a><a id="What-if-you-run-out-of-RAM-disk-space-?-1"></a><a class="docs-heading-anchor-permalink" href="#What-if-you-run-out-of-RAM-disk-space-?" title="Permalink"></a></h3><p>Sometimes you may find that the disk space becomes limited in <code>/dev/shm/$USER</code>. Then you have an option to supply <code>LIBDISK</code> parameter directly to gmake-command without need to reconfigure:</p><pre><code class="language-bash hljs">gmake LIBDISK=`pwd`</code></pre><p>This usually increases the throughput time as creation of the AROME executable to disk rather than RAM-disk may be 5-10 times slower. But at least you won&#39;t run out of disk space.</p><h2 id="How-is-ODB-related-stuff-handled-?"><a class="docs-heading-anchor" href="#How-is-ODB-related-stuff-handled-?">How is ODB related stuff handled ?</a><a id="How-is-ODB-related-stuff-handled-?-1"></a><a class="docs-heading-anchor-permalink" href="#How-is-ODB-related-stuff-handled-?" title="Permalink"></a></h2><p>The <code>Observational DataBase</code> (ODB) is a complicated beast for good reasons. Unlike any other project, which produce just one library per project, correct use of ODB in variational data assimilation requires several libraries.</p><p>The trick to manage this with MAKEUP is to create a bunch of symbolic links pointing to <code>$HARMONIE_SRC/odb/</code> -project directory. There will be one (additional) library for each link. And then we choose carefully the correct subdirectories and source codes therein to be compiled for each library.</p><h3 id="Specific-ODB-libraries,-their-meaning-and-the-source-files-included"><a class="docs-heading-anchor" href="#Specific-ODB-libraries,-their-meaning-and-the-source-files-included">Specific ODB-libraries, their meaning &amp; the source files included</a><a id="Specific-ODB-libraries,-their-meaning-and-the-source-files-included-1"></a><a class="docs-heading-anchor-permalink" href="#Specific-ODB-libraries,-their-meaning-and-the-source-files-included" title="Permalink"></a></h3><table><tr><th style="text-align: left"><strong>Library</strong></th><th style="text-align: left"><strong>Description</strong></th><th style="text-align: left"><strong>Source files</strong></th></tr><tr><td style="text-align: left"><code>libodb</code></td><td style="text-align: left">ODB core library</td><td style="text-align: left"><code>lib/</code> &amp; <code>aux/</code> : <code>[a-z]*.F90 [a-z]*.c</code></td></tr><tr><td style="text-align: left"></td><td style="text-align: left"></td><td style="text-align: left"><code>module/</code> &amp; <code>pandor/module : *.F90</code></td></tr><tr><td style="text-align: left"><code>libodbport</code></td><td style="text-align: left">Interface between IFS (ARPEGE/ALADIN/AROME) &amp; ODB</td><td style="text-align: left"><code>cma2odb/</code> &amp; <code>bufr2odb/</code> : <code>*.F90</code></td></tr><tr><td style="text-align: left"></td><td style="text-align: left">– also contains BUFR2ODB routines</td><td style="text-align: left"><code>pandor/extrtovs</code> &amp; <code>pandor/fcq</code> &amp; <code>pandor/mandalay</code> : <code>*.F90</code></td></tr><tr><td style="text-align: left"><code>libodbdummy</code></td><td style="text-align: left">ODB-related dummies</td><td style="text-align: left"><code>lib/</code>   : <code>[A-Z]*.F90</code> <code>[A-Z]*.c</code></td></tr><tr><td style="text-align: left"><code>libodbmain</code></td><td style="text-align: left">ODB tools, main programs (C &amp; Fortran)</td><td style="text-align: left"><code>tools/</code> : <code>[A-Z]*.F90</code> <code>*.c</code> <code>*.F</code></td></tr><tr><td style="text-align: left"><code>libPREODB</code></td><td style="text-align: left">ERA40 database (not needed, but good for debugging)</td><td style="text-align: left"><code>ddl.PREODB/*.sql</code>  , <code>ddl.PREODB/*.ddl</code></td></tr><tr><td style="text-align: left"><code>libCCMA</code></td><td style="text-align: left">Compressed Central Memory Array database (minimization)</td><td style="text-align: left"><code>ddl.CCMA/*.sql</code>    , <code>ddl.CCMA/*.ddl</code></td></tr><tr><td style="text-align: left"><code>libECMA</code></td><td style="text-align: left">Extended Central Memory Array database (obs. screening)</td><td style="text-align: left"><code>ddl.ECMA/*.sql</code>    , <code>ddl.ECMA/*.ddl</code></td></tr><tr><td style="text-align: left"><code>libECMASCR</code></td><td style="text-align: left">Carbon copy of ECMA for obs. load balancing between PEs</td><td style="text-align: left"><code>ddl.ECMASCR/*.sql</code> , <code>ddl.ECMASCR/*.ddl</code></td></tr></table><p>From the file <code>$HARMONIE_MAKEUP/configure</code> you can also find how different files are nearly hand-picked for particular libraries. Search for block</p><pre><code class="language-bash hljs"> if [[ &quot;$d&quot; = @(odb|odbport|odbdummy|odbmain)]] ; then
     case &quot;$d&quot; in
              odb) case &quot;$i&quot; in
                   lib|aux)              files=$(\ls -C1 [a-z]*.F90 [a-z]*.c 2&gt;/dev/null) ;;
                   module|pandor/module) files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   esac ;;
          odbport) case &quot;$i&quot; in
                   cma2odb|bufr2odb)                           files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   pandor/extrtovs|pandor/fcq|pandor/mandalay) files=$(\ls -C1 *.F90 2&gt;/dev/null) ;;
                   esac ;;
         odbdummy) [[ &quot;$i&quot; != &quot;lib&quot;]] || files=$(\ls -C1 [A-Z]*.F90 [A-Z]*.c 2&gt;/dev/null) ;;
          odbmain) [[ &quot;$i&quot; != &quot;tools&quot;]] || files=$(\ls -C1 [A-Z]*.F90 *.c *.F 2&gt;/dev/null) ;;
     esac
 elif [[ &quot;$d&quot; = @($case_odbs)]] ; then
   [[ &quot;$i&quot; != &quot;ddl.$d&quot;]] || {
       files=$(\ls -C1 *.ddl *.sql 2&gt;/dev/null)
       mkdepend=$CMDROOT/sfmakedepend_ODB
   }
 else
  ... </code></pre><h3 id="Handling-SQL-query-and-data-layout-files"><a class="docs-heading-anchor" href="#Handling-SQL-query-and-data-layout-files">Handling SQL-query and data layout files</a><a id="Handling-SQL-query-and-data-layout-files-1"></a><a class="docs-heading-anchor-permalink" href="#Handling-SQL-query-and-data-layout-files" title="Permalink"></a></h3><p>For SQL-query compilations (ODB/SQL queries are translated into C-code for greater performance), <code>odb98.x</code> SQL-compiler executable is also built as a first thing in the MAKEUP process.</p><p>Queries and data definition layouts (DDL-files) are always under <code>&lt;database&gt;/ddl.&lt;database&gt;/</code> directory.</p><h2 id="Miscellaneous-stuff"><a class="docs-heading-anchor" href="#Miscellaneous-stuff">Miscellaneous stuff</a><a id="Miscellaneous-stuff-1"></a><a class="docs-heading-anchor-permalink" href="#Miscellaneous-stuff" title="Permalink"></a></h2><h3 id="Selective-compilation"><a class="docs-heading-anchor" href="#Selective-compilation">Selective compilation</a><a id="Selective-compilation-1"></a><a class="docs-heading-anchor-permalink" href="#Selective-compilation" title="Permalink"></a></h3><p>It is very easy to deviate from the generic compilation options for certain source files or even projects. If you want to change compiler option (say) from <code>-O3</code> to <code>-O2</code> for routine <code>src/arp/pp_obs/pppmer.F90</code>, you can add the following lines at the end of your config-file:</p><pre><code class="language-bash hljs">pppmer.o: FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))</code></pre><p>If you want to apply this to all <code>pppmer*.F90</code>-routines, then you need to enter the following &quot;wildcard&quot;-sequence:</p><pre><code class="language-bash hljs">pppme%.o: FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))</code></pre><p>Note by the way that for some reason we need to use <code>pppme%.o</code> as the more natural (from Unix) <code>pppmer%.o</code> would choose only routines <code>pppmertl.F90</code> and <code>pppmerad.F90</code>, not the routine <code>pppmer.F90</code> at all!</p><p>Applying different compiler flags for project (say) <strong>arp</strong> only, then one can put the following at the end of config-file:</p><pre><code class="language-bash hljs">ifeq ($(PROJ),arp)
%.o:  FCFLAGS := $(subst -O3,-O2,$(FCFLAGS))
endif</code></pre><h3 id="(Re-)building-just-one-project"><a class="docs-heading-anchor" href="#(Re-)building-just-one-project">(Re-)building just one project</a><a id="(Re-)building-just-one-project-1"></a><a class="docs-heading-anchor-permalink" href="#(Re-)building-just-one-project" title="Permalink"></a></h3><p>Sometime you could opt for rebuilding only (say) the <strong>xrd</strong>-project i.e. <strong>libxrd.a</strong>. This can be done as follows:</p><pre><code class="language-bash hljs">gmake PROJ=xrd</code></pre><h3 id="Cleaning-up-files"><a class="docs-heading-anchor" href="#Cleaning-up-files">Cleaning up files</a><a id="Cleaning-up-files-1"></a><a class="docs-heading-anchor-permalink" href="#Cleaning-up-files" title="Permalink"></a></h3><p>You can clean up by</p><pre><code class="language-bash hljs">gmake clean</code></pre><p>... or selectively just the project <strong>arp</strong>:</p><pre><code class="language-bash hljs">gmake PROJ=arp clean</code></pre><p>This clean does <em>not</em> wipe out makefiles i.e. you don&#39;t have to rerun configure after this.</p><h3 id="Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC"><a class="docs-heading-anchor" href="#Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC">Restoring and cleaning up the state of <code>$HARMONIE_SRC</code></a><a id="Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC-1"></a><a class="docs-heading-anchor-permalink" href="#Restoring-and-cleaning-up-the-state-of-HARMONIE_SRC" title="Permalink"></a></h3><p>The following command you can run only once before issuing another configure command. It will remove all related object and executable files as well as generated makefiles, logfiles etc. stuff which was generated by MAKEUP&#39;s configure :</p><pre><code class="language-bash hljs">cd $HARMONIE_SRC
gmake veryclean

# .. or alternatively :
$HARMONIE_MAKEUP/unconfigure</code></pre><h3 id="Ignoring-errors"><a class="docs-heading-anchor" href="#Ignoring-errors">Ignoring errors</a><a id="Ignoring-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Ignoring-errors" title="Permalink"></a></h3><p>Sometimes it is useful to enforce compilations even if one or more routines fail to compile. In such cases recommended syntax is:</p><pre><code class="language-bash hljs">gmake -i

# or not to mess up the output, use just one process for compilations

gmake NPES=1 -i</code></pre><h3 id="Creating-precompiled-installation"><a class="docs-heading-anchor" href="#Creating-precompiled-installation">Creating precompiled installation</a><a id="Creating-precompiled-installation-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-precompiled-installation" title="Permalink"></a></h3><p>If you want to provide precompiled libraries, objects, source code to other users so that they do not have to start compilation from scratch, then make a distribution or precompiled installation as follows:</p><pre><code class="language-bash hljs">gmake PRECOMPILED=/a/precompiled/rootdir precompiled</code></pre><p>After this the stuff you just compiled ends up in directory <code>/a/precompiled/rootdir</code> with two subdirectories : <code>src/</code> and <code>util/</code>. All executables are currently removed.</p><p>You can repeat this call, and it will just <code>rsync</code> the modified bits.</p><h3 id="Update/check-your-interface-blocks-outside-configure"><a class="docs-heading-anchor" href="#Update/check-your-interface-blocks-outside-configure">Update/check your interface blocks outside <code>configure</code></a><a id="Update/check-your-interface-blocks-outside-configure-1"></a><a class="docs-heading-anchor-permalink" href="#Update/check-your-interface-blocks-outside-configure" title="Permalink"></a></h3><p>The <code>configure</code> has options -c or -g to check up or enforce for (re-)creation of interface blocks of projects <code>arp</code> and <code>ald</code>. To avoid full and lengthy <code>configure</code>-run, you can just do the following:</p><pre><code class="language-bash hljs">gmake intfb</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Build_with_cmake/">« CMake</a><a class="docs-footer-nextpage" href="../../System/MFaccess/">MF Access »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 21 April 2023 09:55">Friday 21 April 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
