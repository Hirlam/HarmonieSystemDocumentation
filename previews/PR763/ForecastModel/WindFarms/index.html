<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Wind Farm Parameterisation · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-221448594-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-221448594-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/ForecastModel/WindFarms/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DataAssimilation/DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li><li><a class="tocitem" href="../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../DataAssimilation/MTEN/">MTEN</a></li><li><a class="tocitem" href="../../DataAssimilation/CHKEVO/">CHKEVO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Forecast/">Forecast</a></li><li><a class="tocitem" href="../ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../Outputlist/">Output List</a></li><li><a class="tocitem" href="../HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-4-5" type="checkbox"/><label class="tocitem" for="menuitem-3-4-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li class="is-active"><a class="tocitem" href>Wind Farm Parameterisation</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Implementation-in-CY46"><span>Implementation in CY46</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../EPS/System/">System</a></li><li><a class="tocitem" href="../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../System/UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Forecast Model</a></li><li class="is-active"><a href>Wind Farm Parameterisation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Wind Farm Parameterisation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/ForecastModel/WindFarms.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Documentation-for-wind-farm-parameterisation"><a class="docs-heading-anchor" href="#Documentation-for-wind-farm-parameterisation">Documentation for wind farm parameterisation</a><a id="Documentation-for-wind-farm-parameterisation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-for-wind-farm-parameterisation" title="Permalink"></a></h1><p><em>Natalie Theeuwes &amp; Bert van Ulft</em>&lt;br&gt; <em>contact: Natalie.Theeuwes@knmi.nl</em></p><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>We&#39;ve implemented the Fitch et al. (2012) scheme in HARMONIE-AROME. First implemented in CY40 and evaluated for 1 year, 2016. Results are published in this paper: <a href="#https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2021MS002947">https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2021MS002947</a>. Afterwards it has been moved to CY43 and run for 3 year (2019-2021) and evaluated.</p><h2 id="Implementation-in-CY46"><a class="docs-heading-anchor" href="#Implementation-in-CY46">Implementation in CY46</a><a id="Implementation-in-CY46-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-in-CY46" title="Permalink"></a></h2><h3 id="Switching-on-parameterisation"><a class="docs-heading-anchor" href="#Switching-on-parameterisation">Switching on parameterisation</a><a id="Switching-on-parameterisation-1"></a><a class="docs-heading-anchor-permalink" href="#Switching-on-parameterisation" title="Permalink"></a></h3><p>To switch the parameterisation on go to <code>ecf/config_exp.h</code> and set <code>WINDFARM=&quot;yes&quot;</code>. This will make the necessary switch to the namelist using the <code>scr/forecast_model_settings.sh</code></p><pre><code class="language-bash hljs"># Fitch et al. (2012) wind turbine parametrization
export LWINDFARM=.FALSE.
if [ &quot;$WINDFARM&quot; = yes ]; then
    LWINDFARM=.TRUE.
    ...
fi</code></pre><p>In <code>nam/harmonie_namelists.pm</code> in the namelist in the <code>%arome=( NAMPHY=&gt;{</code> the switch for the wind farm paremeterisation should be located: <code>&#39;LWINDFARM&#39; =&gt; $ENV{LWINDFARM},</code></p><p>Once this switch in <code>ecf/config_exp.h</code> the code will look for a directory called <code>WFP_input_files</code> in the directory of the experiment. This should include input text files for the wind farm parameterisation.</p><h3 id="Code"><a class="docs-heading-anchor" href="#Code">Code</a><a id="Code-1"></a><a class="docs-heading-anchor-permalink" href="#Code" title="Permalink"></a></h3><p>The input files are read in in <code>src/arpifs/setup/su0yomb.F90</code> which calls the setup of the wind farm parameterisation <code>src/arpifs/setup/suwindfarm.F90</code>:</p><pre><code class="language-fortran hljs">!*    Initialize wind farm scheme
IF (LWINDFARM) THEN
    WRITE(NULOUT,*) &#39;---- Set up wind farms --&#39;,CLINE
    CALL SUWINDFARM(YDGEOMETRY)
ENDIF</code></pre><p>The setup routine allocates the turbines on each BLK and it&#39;s properties (i.e., radius, hub height, location, type), plus it allocates the power and thrust curves for each turbine type. <code>src/arpifs/setup/suwindfarm.F90</code> uses:</p><ul><li><p><code>src/arpifs/setup/suwindfarm_rc.F90</code> - to read the coordinate file,</p></li><li><p><code>src/arpifs/setup/suwindfarm_rt.F90</code> - to read the turbine type files, and</p></li><li><p><code>src/arpifs/utility/skip_comments.F90</code> - used to skip comments in the .tab files.</p></li></ul><p>The wind farm parameterisation is called in <code>src/arpifs/phys_dmn/apl_arome.F90</code> :</p><pre><code class="language-fortran hljs">!    ------------------------------------------------------------------
!     13 - CALL WIND FARM (DRAG/TKE-prod) PARAMETERISATON
!    ------------------------------------------------------------------

IF (LWINDFARM) THEN
    CALL WINDFARM(YDGEOMETRY%YREGEO,KBL,KLON,KLEV,&amp;
                &amp; PAPHIM,PAPHIFM,POROG,PUM,PVM,PDT,&amp;
                &amp; PCWFP,PWFPA,PTENDU,PTENDV,PTENDTKE)
ENDIF</code></pre><p>The wind farm parameterisation subroutine is located in <code>src/arpifs/phys_dmn/windfarm.F90</code>. The parameterisation loops over each turbine in <code>KBL</code> and adjust the tendencies and power production.</p><p>The U, V and TKE tendencies are changed in by this call. In addition, we output two new variables:</p><ol><li><p><code>PCWFP</code> - accumulated wind farm power production</p></li><li><p><code>PWFPA</code> - instantaneous wind farm power production</p></li></ol><p>These are passed through the <code>CFU</code> (accumulated) and <code>XFU</code> (instantaneous) thingy&#39;s to the FA file output.</p><h3 id="Input-files"><a class="docs-heading-anchor" href="#Input-files">Input files</a><a id="Input-files-1"></a><a class="docs-heading-anchor-permalink" href="#Input-files" title="Permalink"></a></h3><p>There are two types of input files:</p><ol><li><code>wind_turbine_coordinates.tab</code> there should be only one file  with the location of all individual turbines, the coordinates given  in WG84, turbine type, radius, and hub height. This file can look  like:</li></ol><pre><code class="nohighlight hljs">#     lon          lat          type          r            z      
        6.2031     53.4072         999            8           25
        5.2345     52.7387         999            8           31
        5.9171     53.3762         999            8           25
        5.5033     53.1913         999            8           25
        5.9415     52.9295         999            8           31
        5.2454     52.7327         999            8           31
        6.3057     53.0353         999            8           31
        4.3082     51.5722         999            8           31
        5.7044     53.2521         999            8           31
        5.7689     53.1922         999            8           31
        6.0345     53.3543         999            8           25
        5.7798     53.3212         999            8           25
        5.6054     52.7066         999            8           31
        5.5258     53.2502         999            8           25
        5.5189     53.2468         999            8           31
        5.6110     52.7242         999            9           31
        4.6530     52.7281         999            8           25
        5.7255     53.1632         999            9           31
        4.6861     52.7434         999            8           25
        5.3789     52.3055         999            9           25
        5.4726     53.1554         999            8           31
        6.5278     53.2488         999            8           31
        6.3006     53.3322         999            8           31
        5.8826     53.3058         999            8           31</code></pre><ol><li><code>wind_turbine_XXX.tab</code> Each turbine type should have their own  individual file, including the thrust and power curves, with  additional info e.g. the name of the type hub height and radius.  Note:: Only <span>$C_T$</span> and <span>$C_P$</span> are read in, the remainder of the info  is for reference only. Hub height and radius are read in from the  <code>wind_turbine_coordinates.tab</code> file. The <code>XXX</code> is the turbine  type number under the column <code>type</code> in  <code>wind_turbine_coordinates.tab</code>. A <code>wind_turbine_XXX.tab</code> file  can look like:</li></ol><pre><code class="nohighlight hljs"># SWT-3.6-120 (z=82 m, D=120 m)
#    r (m)        z (m)      cT_low (-)  cT_high (-) 
    60.0000     82.0000       0.0480      0.0480
#   U (m/s)       cP (-)       cT (-)   
     3.0000      0.0000       0.0000
     4.0000      0.3630       0.8580
     5.0000      0.4050       0.8580
     6.0000      0.4240       0.8580
     7.0000      0.4320       0.8570
     8.0000      0.4350       0.8580
     9.0000      0.4360       0.8570
    10.0000      0.4200       0.8040
    11.0000      0.3690       0.6070
    12.0000      0.2980       0.4180
    13.0000      0.2360       0.3160
    14.0000      0.1890       0.2480
    15.0000      0.1540       0.2010
    16.0000      0.1270       0.1650
    17.0000      0.1060       0.1380
    18.0000      0.0890       0.1170
    19.0000      0.0760       0.1000
    20.0000      0.0650       0.0870
    21.0000      0.0560       0.0760
    22.0000      0.0490       0.0670
    23.0000      0.0430       0.0600
    24.0000      0.0380       0.0530
    25.0000      0.0330       0.0480</code></pre><pre><code class="nohighlight hljs">The `cT_low (-)  cT_high (-)` indicate the thrust coefficient used
when the turbine is switched off, in either low or very high wind
speed conditions.</code></pre><p>At the moment the directory with input files is set in <code>Env_system</code>: </p><pre><code class="language-bash hljs">    export WINDFARM_DATA_PATH=...</code></pre><p>The coordinate file is set in <code>ecf/config_exp.h</code> as:</p><pre><code class="language-bash hljs">    # File with coordinates and properties of wind turbines
    WINDFARM_COORDS_FILE=$WINDFARM_DATA_PATH/wind_turbine_coordinates_${DOMAIN}_@YYYY@.tab</code></pre><p>The forecast<em>model</em>settings.sh script creates links to the input files in the working directory. In research running mode the script will abort if the input files are not found. If <code>RUNNING_MODE==operational</code>, if the coordinate file for that DTG is not found (e.g. to avoid crashes in operations at New Year&#39;s eve), the script searches back up to 1 year for an alternative, previous file and uses that one instead. If no suitable file is found the wind farm parameterisation will be switched off (<code>WINDFARM=no</code>; <code>LWINDFARM=.FALSE.</code>). In both cases this will be logged in the severe_warnings.txt file.</p><p>Some python code to create the coordinate files from a pandas dataframe:</p><pre><code class="language-python hljs"># Write coordinates/types to input file HARMONIE
f = open(&#39;wind_turbine_coordinates_2022.tab&#39;, &#39;w&#39;)
f.write(&#39;# {0:^12s} {1:^12s} {2:^12s} {3:^12s} {4:^12s}\n&#39;.format(&#39;lon&#39;,&#39;lat&#39;,&#39;type&#39;,&#39;r&#39;,&#39;z&#39;))
for i in range(len(df.index)):
    f.write(&#39;{0:11.4f} {1:11.4f} {2:11d} {3:12d} {4:12d}\n&#39;.format(df.lon.iloc[i], 
            df.lat.iloc[i], df.type.iloc[i], int(df.r.iloc[i]), int(df.z.iloc[i])))</code></pre><p>NOTE!: When creating the <code>wind_turbine_coordinates.tab</code> files all turbines must be within the domain. This is not done in the code. All turbines outside the domain will accumulate in the edge cells of the domain. Easiest way to do this is in the preprocessing. Like using (with turbines in a pandas dataframe):</p><pre><code class="language-python hljs">grid = xr.open_dataset(&#39;../common_data/Harmonie_grid.nc&#39;)
hm_lon  = grid[&#39;lon&#39;].values
hm_lat  = grid[&#39;lat&#39;].values
maxlat = hm_lat.shape[0]-1
maxlon = hm_lat.shape[1]-1
# remove turbines beyond the boundaries of the HARMONIE domain
for n in np.arange(len(df.index)):
    j,i = np.unravel_index(np.sqrt((hm_lon-df.Longitude.iloc[n])**2 
            + (hm_lat-df.Latitude.iloc[n])**2).argmin(), hm_lon.shape)
    if ( (j == 0) | (j &gt;= maxlat) ):
        # set longitude to NaN&#39;s
        df.Longitude.iloc[n] = np.nan
    elif ( (i == 0) | (i&gt;=maxlon) ):
        # set longitude to NaN&#39;s
        df.Longitude.iloc[n] = np.nan
df.dropna(subset=[&#39;Longitude&#39;], how=&#39;all&#39;, inplace=True)</code></pre><p>For the creation of the turbine type files <code>wind_turbine_XXX.tab</code>, the following python function can be used:</p><pre><code class="language-python hljs">def write_harmonie_turbine_input(tid, name, zhub, D, u, cp, ct):
    &quot;&quot;&quot;
    Write the turbine specifications in the correct input format for HARMONIE
    &quot;&quot;&quot;
    
    print(&#39;Writing turbine input file for {0} - ID = {1:2d} (zhub = {2:.0f} m,
            D = {3:.0f} m)&#39;.format(name, tid, zhub, D))

    f = open(&#39;wind_turbine_{0:03d}.tab&#39;.format(tid), &#39;w&#39;)
    f.write(&#39;# {0} (z={1:.0f} m, D={2:.0f} m)\n&#39;.format(name, zhub, D))
    f.write(&#39;# {0:^12s} {1:^12s} {2:^12s} {3:^12s}\n&#39;.format(&#39;r (m)&#39;,&#39;z (m)&#39;,
                &#39;cT_low (-)&#39;,&#39;cT_high (-)&#39;))
    f.write(&#39;{0:11.4f} {1:11.4f}  {2:11.4f} {3:11.4f}\n&#39;.format(D/2., zhub, 
                ct[-1], ct[-1]))
    f.write(&#39;# {0:^12s} {1:^12s} {2:^12s}\n&#39;.format(&#39;U (m/s)&#39;,&#39;cP (-)&#39;,&#39;cT (-)&#39;))
    for i in range(u.size):
        f.write(&#39;{0:11.4f} {1:11.4f}  {2:11.4f}\n&#39;.format(u[i], cp[i], ct[i]))
    f.close()</code></pre><h3 id="Output"><a class="docs-heading-anchor" href="#Output">Output</a><a id="Output-1"></a><a class="docs-heading-anchor-permalink" href="#Output" title="Permalink"></a></h3><p>For the conversion to GRIB1 of the two new variables, we use:</p><pre><code class="nohighlight hljs">#Wind power production, accumulated
&#39;253211&#39; = {
        table2Version = 253 ;
        indicatorOfParameter = 211 ;
        timeRangeIndicator = 4 ;
        }
#Wind power production, instantaneous
&#39;253211&#39; = {
        table2Version = 253 ;
        indicatorOfParameter = 211 ;
        timeRangeIndicator = 0 ;
        }</code></pre><p>And for the conversion to GRIB2, we use:</p><pre><code class="nohighlight hljs">#Wind power production, accumulated
&#39;253211&#39; = {
        discipline = 0 ;
        parameterCategory = 2 ;
        parameterNumber = 39 ;
        typeOfStatisticalProcessing = 1 ;
        centre = 94 ;
        editionNumber = 2 ;
        interpretationOfNumberOfPoints = 0 ;
        subCentre = 255 ;
        }
#Wind power production, instantaneous
&#39;253211&#39; = {
        discipline = 0 ;
        parameterCategory = 2 ;
        parameterNumber = 39 ;
        centre = 94 ;
        editionNumber = 2 ;
        interpretationOfNumberOfPoints = 0 ;
        subCentre = 255 ;
        }</code></pre><p>For both GRIB 1 and GRIB 2:</p><ol><li><p>Wind power production, accumulated:</p><ul><li>name: <code>&#39;Wind power production, accumulated&#39;</code></li><li>paramId: <code>&#39;253211&#39;</code></li><li>shortName: <code>&#39;wfpower_acc&#39;</code></li><li>units: <code>&#39;MJ&#39;</code></li></ul></li><li><p>Wind power production, accumulated:</p><ul><li>name: <code>&#39;Wind power production, instantaneous&#39;</code></li><li>paramId: <code>&#39;253211&#39;</code></li><li>shortName: <code>&#39;wfpower_ins&#39;</code></li><li>units: <code>&#39;MW&#39;</code></li></ul></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../SingleColumnModel/MUSC_vars/">« MUSC vars</a><a class="docs-footer-nextpage" href="../../ClimateGeneration/ClimateGeneration/">Climate Generation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 4 May 2023 13:24">Thursday 4 May 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
