<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running on Atos · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-221448594-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-221448594-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/System/ECMWF/RunningHarmonieOnAtos/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../../Overview/da_graph/">Graphical Overview</a></li><li class="is-active"><a class="tocitem" href>Running on Atos</a><ul class="internal"><li><a class="tocitem" href="#Before-you-start"><span>Before you start</span></a></li><li><a class="tocitem" href="#Configure-your-experiment"><span>Configure your experiment</span></a></li><li class="toplevel"><a class="tocitem" href="#e.g.,-./Harmonie-start-DTG2012122400-DTGEND2012122406"><span>e.g., ./Harmonie start DTG=2012122400 DTGEND=2012122406</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../../Observations/ObservationData/">ObservationData</a></li><li><a class="tocitem" href="../../../Observations/Conrad/">Conrad</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI/">CANARI</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li><a class="tocitem" href="../../../DataAssimilation/Surface/SurfaceAnalysis/">Surface Analysis</a></li></ul></li><li><a class="tocitem" href="../../../DataAssimilation/Screening/">Screening</a></li><li><a class="tocitem" href="../../../DataAssimilation/StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../../DataAssimilation/DataAssimilation4DVAR/">4DVAR</a></li><li><a class="tocitem" href="../../../DataAssimilation/DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../../DataAssimilation/ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../../DataAssimilation/SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../../DataAssimilation/LSMIXandJk/">LSMIX and Jk</a></li><li><a class="tocitem" href="../../../DataAssimilation/DFS/">DFS</a></li><li><a class="tocitem" href="../../../DataAssimilation/MTEN/">MTEN</a></li><li><a class="tocitem" href="../../../DataAssimilation/CHKEVO/">CHKEVO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-4-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4-4"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../../EPS/System/">System</a></li><li><a class="tocitem" href="../../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Build/General/">Software requirements</a></li><li><a class="tocitem" href="../../../Build/Build_with_makeup/">Makeup</a></li><li><a class="tocitem" href="../../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../../Build/gmkpack/">Gmkpack</a></li><li><a class="tocitem" href="../../../Build/Gmkpack_vs_Make/">Gmkpack vs Make</a></li><li><a class="tocitem" href="../../../Build/CompileHarmonie/">Compile Harmonie</a></li><li><a class="tocitem" href="../../../Build/Installation/">Installation</a></li><li><a class="tocitem" href="../../../Build/Redhat7Install/">Redhat7 Install</a></li><li><a class="tocitem" href="../../../Build/Centos6Install/">Centos6 Install</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href>Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../Fast_start_on_cca/">Fast start on cca</a></li><li><a class="tocitem" href="../../Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../DrHook/">DrHook</a></li><li><a class="tocitem" href="../../StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../UpdateNamelists/">Update Namelist</a></li><li><a class="tocitem" href="../../Scalability_and_Refactoring/">Scalability and refactoring</a></li><li><a class="tocitem" href="../../HarmonieBenchMark/">Benchmark</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href>Running on Atos</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running on Atos</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/System/ECMWF/RunningHarmonieOnAtos.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-Harmonie-on-Atos"><a class="docs-heading-anchor" href="#Running-Harmonie-on-Atos">Running Harmonie on Atos</a><a id="Running-Harmonie-on-Atos-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Harmonie-on-Atos" title="Permalink"></a></h1><h2 id="Before-you-start"><a class="docs-heading-anchor" href="#Before-you-start">Before you start</a><a id="Before-you-start-1"></a><a class="docs-heading-anchor-permalink" href="#Before-you-start" title="Permalink"></a></h2><p>New Harmonie users will require membership of the hirald user group at ECMWF. Please contact the HIRLAM System Manager, Daniel Santos, to make this request on your behalf. Futhermore ECMWF will have to setup a virtual machine for you to run the ecFlow server on (see <a href="../../../SuiteManagement/ECFLOW/">here</a>).</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To share your experiments with the members of the hirald group do: </p><pre><code class="nohighlight hljs">chmod 755 $HOME $SCRATCH $PERM $HPCPERM
chgrp -R hirald $HOME/hm_home $SCRATCH/hm_home $PERM/HARMONIE $HPCPERM/hm_home
chmod g+s $HOME/hm_home $SCRATCH/hm_home $PERM/HARMONIE $HPCPERM/hm_home</code></pre><p>The <code>chmod g+s</code> sets the <a href="https://linuxhandbook.com/suid-sgid-sticky-bit/">SGID</a> bit which will ensure that new experiments created in <code>hm_home</code> will automatically be in the <code>hirald</code> group</p></div></div><h2 id="Configure-your-experiment"><a class="docs-heading-anchor" href="#Configure-your-experiment">Configure your experiment</a><a id="Configure-your-experiment-1"></a><a class="docs-heading-anchor-permalink" href="#Configure-your-experiment" title="Permalink"></a></h2><ul><li>Create an experiment directory under <code>$HOME/hm_home</code> and use the master script Harmonie to set up a minimum environment for your experiment. E.g for harmonie-43h2.2<pre><code class="nohighlight hljs">mkdir -p $HOME/hm_home/my_exp
cd $HOME/hm_home/my_exp
ln -sf ~hlam/harmonie_release/git/tags/harmonie-43h2.2/config-sh/Harmonie
./Harmonie setup -r ~hlam/harmonie_release/git/tags/harmonie-43h2.2 -h aa</code></pre>where<ul><li>-r tells which version to use.  Check the directories under <code>~hlam/harmonie_release/git</code> to see the available versions. </li><li>-h tells which configuration files to use. At ECMWF <code>config.aa</code> is the default one for releases &lt;= harmonie-43h2.2, and <code>config.ECMWF.atos</code> above.</li></ul></li></ul><p>Since harmonie-43h2.2.1 the default host on ECMWF&#39;s Atos is ECMWF.atos. So the last two lines will be, e.g. with develop-branch dev-CY46h1</p><pre><code class="nohighlight hljs">  ln -sf ~hlam/harmonie_release/git/branches/dev-CY46h1/config-sh/Harmonie
  ./Harmonie setup -r ~hlam/harmonie_release/git/branches/dev-CY46h1 -h ECMWF.atos
  ```
* This would give you the default setup which currently is `AROME` physics with `CANARI+OI_MAIN` surface assimilation and 3DVAR upper air assimilations with 3h cycling on a domain covering Denmark using 2.5km horizontal resolution and 65 levels in the vertical.
* Now you can edit the basic configuration file `ecf/config_exp.h` to configure your experiment scenarios. Modify specifications for domain, data locations, settings for dynamics, physics, coupling host model etc. Read more about the options [here](../../ExperimentConfiguration/ConfigureYourExperiment.md). You can also use some of the predefined configurations by calling Harmonie with the `-c` option:
  ```
  ./Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST -c CONFIG -d DOMAIN
  ```
  where `CONFIG` is one of the setups defined in `scr/Harmonie_configurations.pm`. If you give `-c` without an argument or a non existing configuration a list of configurations will be printed.
* In some cases you might have to edit the general system configuration file, `config-sh/config.aa` or `config-sh/config.ECMWF.atos`. See [here](../../ExperimentConfiguration/PlatformConfiguration.md) for further information. 
* The rules for how to submit jobs on Atos are defined in  `config-sh/submit.aa` or `config-sh/submit.ECMWF.atos`. See [here](../../ExperimentConfiguration/PlatformConfiguration.md) for further information
* If you experiment in data assimilation you might also want to change settings in `scr/include.ass`.

## Start your experiment 

Launch the experiment by giving start time, `DTG`, end time, `DTGEND`
</code></pre><p>./Harmonie start DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH</p><h1 id="e.g.,-./Harmonie-start-DTG2012122400-DTGEND2012122406"><a class="docs-heading-anchor" href="#e.g.,-./Harmonie-start-DTG2012122400-DTGEND2012122406">e.g., ./Harmonie start DTG=2012122400 DTGEND=2012122406</a><a id="e.g.,-./Harmonie-start-DTG2012122400-DTGEND2012122406-1"></a><a class="docs-heading-anchor-permalink" href="#e.g.,-./Harmonie-start-DTG2012122400-DTGEND2012122406" title="Permalink"></a></h1><pre><code class="nohighlight hljs">
If successful, Harmonie will identify your experiment name and start building your binaries and run your forecast. If not, you need to examine the ECFLOW log file `$HM_DATA/ECF.log`. `$HM_DATA` is defined in your `Env_system` file. At ECMWF `$HM_DATA=$SCRATCH/hm_home/$EXP` where `$EXP` is your experiment name. Read more about where things happen further down.

## Continue your experiment 

If your experiment have successfully completed and you would like to continue for another period you should write</code></pre><p>./Harmonie prod DTGEND=YYYYMMDDHH</p><pre><code class="nohighlight hljs">By using `prod` you tell the system that you are continuing the experiment and using the first guess from the previous cycle. The start date is take from a file `progress.log` created in your `$HOME/hm_home/my_exp` directory. If you would have used `start` the initial data would have been interpolated from the boundaries, a cold start in other words.

## Start/Restart of `ecflow_ui` 

To start the graphical window for ECFLOW
</code></pre><p>./Harmonie mon</p><pre><code class="nohighlight hljs">
The graphical window runs independently of the experiment and can be closed and restarted again with the same command. With the graphical interface you can control and view logfiles of each task. 

## Making local changes 

Very soon you will find that you need to do changes in a script or in the source code. Once you have identified which file to edit you put it into the current `$HOME/hm_home/my_exp` directory, with exactly the same subdirectory structure as in the reference. e.g, if you want to modify a namelist setting 
</code></pre><p>./Harmonie co nam/harmonie<em>namelists.pm   # retrieve default namelist harmonie</em>namelists.pm vi nam/harmonie_namelists.pm              # modify the namelist</p><pre><code class="nohighlight hljs">
Next time you run your experiment the changed file will be used. You can also make changes in a running experiment. Make the change you wish and rerun the `InitRun` task from the viewer. The `InitRun` task copies all files from your local experiment directory to your working directory `$HM_DATA`. Once your `InitRun` task is complete your can rerun the task you are interested in. If you wish to recompile something you will also have to rerun the `Build` tasks.

## Directory structure 


### `$SCRATCH`

In `$SCRATCH/hm_home/$EXP` you will find 

Directory     | Content 
:---          | :---
`bin`         | Binaries
`lib`         | Source code synced from $HM_LIB and compiled code
`lib/src`     | Object files and source code (if you build with makeup, set by MAKEUP_BUILD_DIR)
`lib/util`    | Utilities such as `makeup`, `gl_grib_api` or `oulan`
`climate`     | Climate files
`YYYYMMDD_HH` | Working directory for the current cycle. If an experiment fails it is useful to check the IFS log file, `NODE.001_01`, in the working directory of the current cycle. The failed job will be in a directory called something like `Failed_this_job`.
`archive`     | Archived files. A `YYYY/MM/DD/HH` structure for per cycle data. `ICMSHHARM+NNNN` and `ICMSHHARM+NNNN.sfx` are atmospheric and surfex forecast output files
`extract`     | Verification input data. This is also stored on the permanent disk `$HPCPERM/HARMONIE/archive/$EXP/parchive/archive/extract`
`ECF.log`     | Log of job submission

### ECFS

* Since `$SCRATCH` is cleaned regularly we need to store data permanently on ECFS, the EC file system, as well. There are two options for ECFS, `ectmp` and `ec`. The latter is a permanent storage and first one is cleaned after 90 days. Which one you use is defined by the``ECFSLOC` variable. To view your data type e.g.

  ```
  els ectmp:/$USER/harmonie/my_exp
  ```
* The level of archiving depends on `ARSTRATEGY` in `ecf/config_exp.h`. The default setting will give you one `YYYY/MM/DD/HH` structure per cycle data containing:
  * Surface analysis, `ICMSHANAL+0000[.sfx]`
  * Atmospheric analysis result `MXMIN1999+0000`
  * Blending between surface/atmospheric analysis and cloud variable from the first guess `LSMIXBCout`
  * `ICMSHHARM+NNNN` and `ICMSHHARM+NNNN.sfx` are atmospheric and surfex forecast model state files
  * `PFHARM*` files produced by the inline postprocessing
  * `ICMSHSELE+NNNN.sfx` are surfex files with selected output
  * GRIB files for fullpos and surfex select files
  * Logfiles in a tar file `logfiles.tar`
  * Observation database and feedback information in `odb_stuff.tar`.
  * Extracted files for obsmon in `sqlite.tar`
* Climate files are stored in the `climate` directory
* One directory each for `vfld` and `vobs` data respectively for verification data

### `$PERM`


Directory         | Content 
:---              | :---
`HARMONIE/$EXP`   | ecflow log and job files
`hm_lib/$EXP/lib` | Scipts, config files, ecf and suite, source code (not compiled, set by $HM_LIB). Reference with experiment&#39;s changes on top


### `$HPCPERM`

In `$HPCPERM/hm_home/$EXP`

Directory                   | Content 
:---                        | :---
`parchive/archive/extract/` | Verification input data. 


### `$HOME` on ecflow-gen-${user}-001

Directory                   | Content 
:---                        | :---
`ecflow_server/`            | ecFlow checkpoint and log files
 
## Cleanup of old experiments 

!!! danger 
    These commands may not work properly in all versions. Do not run the removal before you&#39;re sure it&#39;s OK

Once you have complete your experiment you may wish to remove code, scripts and data from the disks. Harmonie provides some simple tools to do this. First check the content of the different disks by
</code></pre><p>Harmonie CleanUp -ALL</p><pre><code class="nohighlight hljs">
Once you have convinced yourself that this is OK you can proceed with the removal.
</code></pre><p>Harmonie CleanUp -ALL -go </p><pre><code class="nohighlight hljs">
If you would like to exclude the data stored on e.g ECFS ( at ECMWF ) or in more general terms stored under `HM_EXP` ( as defined in `Env_system` ) you run 
</code></pre><p>Harmonie CleanUp -d</p><pre><code class="nohighlight hljs">
to list the directories intended for cleaning. Again, convince yourself that this is OK and proceed with the cleaning by
</code></pre><p>Harmonie CleanUp -d -go</p><pre><code class="nohighlight hljs">

You can always remove the data from ECFS directly by running e.g.
</code></pre><p>erm -R ec:/YOUR<em>USER/harmonie/EXPERIMENT</em>NAME </p><pre><code class="nohighlight hljs">or</code></pre><p>erm -R ectmp:/YOUR<em>USER/harmonie/EXPERIMENT</em>NAME  ```</p><ul><li>For more information about cleaning with Harmonie read <a href="../../TheHarmonieScript/">here</a></li><li>For more information about the ECFS commands read <a href="https://confluence.ecmwf.int/display/UDOC/ecfs.1">here</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Overview/da_graph/">« Graphical Overview</a><a class="docs-footer-nextpage" href="../../../Overview/Content/">Content »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 4 September 2022 19:41">Sunday 4 September 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
