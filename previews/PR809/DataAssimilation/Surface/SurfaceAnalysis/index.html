<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Surface Analysis · Harmonie wiki</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ1BCP3LPJ"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HQ1BCP3LPJ', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://hirlam.github.io/HarmonieSystemDocumentation/dev/DataAssimilation/Surface/SurfaceAnalysis/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Harmonie wiki logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Harmonie wiki</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../../System/GitDeveloperDocumentation/">GitHub workflow</a></li><li><a class="tocitem" href="../../../Overview/da_graph/">Graphical Overview</a></li><li><a class="tocitem" href="../../../System/ECMWF/RunningHarmonieOnAtos/">Running on Atos</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Overview</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Overview/Content/">Content</a></li><li><a class="tocitem" href="../../../Overview/Binaries/">Binaries</a></li><li><a class="tocitem" href="../../../Overview/FileFormats/">File Formats</a></li><li><a class="tocitem" href="../../../Overview/Source/">Source</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Experiment Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ExperimentConfiguration/ConfigureYourExperiment/">Experiment</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/Namelists/">Namelist</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/UseofObservation/">Observations</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/PlatformConfiguration/">Platform</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/How_to_use_hires_topography/">HiRes Topography</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/ModelDomain/">Domain</a></li><li><a class="tocitem" href="../../../ExperimentConfiguration/VerticalGrid/">Vertical Grid</a></li></ul></li></ul></li><li><span class="tocitem">NWP Components</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Observations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Preprocessing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/ObservationPreprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../../../Observations/Oulan/">Oulan</a></li><li><a class="tocitem" href="../../../Observations/Bator/">Bator</a></li><li><a class="tocitem" href="../../../Observations/Cope/">Cope</a></li><li><a class="tocitem" href="../../../Observations/ObservationData/">ObservationData</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Observations/SYNOP/">SYNOP</a></li><li><a class="tocitem" href="../../../Observations/Amv/">AMV</a></li><li><a class="tocitem" href="../../../Observations/Atovs/">ATOVS</a></li><li><a class="tocitem" href="../../../Observations/Iasi/">IASI</a></li><li><a class="tocitem" href="../../../Observations/Seviri/">SEVIRI</a></li><li><a class="tocitem" href="../../../Observations/Scatt/">Scatt</a></li><li><a class="tocitem" href="../../../Observations/Ascat/">AScat</a></li><li><a class="tocitem" href="../../../Observations/GNSS/">GNSS</a></li><li><a class="tocitem" href="../../../Observations/Modes/">Modes</a></li><li><a class="tocitem" href="../../../Observations/RadarData/">Radar</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Data Assimilation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Surface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../CANARI/">CANARI</a></li><li><a class="tocitem" href="../CANARI_OI_MAIN/">CANARI OI MAIN</a></li><li><a class="tocitem" href="../CANARI_EKF_SURFEX/">CANARI EKF SURFEX</a></li><li class="is-active"><a class="tocitem" href>Surface Analysis</a><ul class="internal"><li><a class="tocitem" href="#Surface-related-variables-in-ecf/config_exp.h-:"><span>Surface related variables in ecf/config_exp.h :</span></a></li><li><a class="tocitem" href="#Some-details"><span>Some details</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../Screening/">Screening</a></li><li><a class="tocitem" href="../../StructureFunctions/">Structure functions</a></li><li><a class="tocitem" href="../../DaAlgorithms/">Algorithms</a></li><li><a class="tocitem" href="../../DigitalFilterInitialization/">Digital Filter Initialization</a></li><li><a class="tocitem" href="../../ObservationOperators/">HOP_DRIVER</a></li><li><a class="tocitem" href="../../SingleObs/">Single Obs</a></li><li><a class="tocitem" href="../../LSMIXandJk/">LSMIX and Jk</a></li><li><a class="tocitem" href="../../DFS/">DFS</a></li><li><a class="tocitem" href="../../MTEN/">MTEN</a></li><li><a class="tocitem" href="../../CHKEVO/">CHKEVO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Boundaries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Boundaries/BoundaryFilePreparation/">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Forecast Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/Forecast/">Forecast</a></li><li><a class="tocitem" href="../../../ForecastModel/ForecastSettings/">Settings</a></li><li><a class="tocitem" href="../../../ForecastModel/Outputlist/">Output List</a></li><li><a class="tocitem" href="../../../ForecastModel/HR/">High Res</a></li><li><input class="collapse-toggle" id="menuitem-3-4-5" type="checkbox"/><label class="tocitem" for="menuitem-3-4-5"><span class="docs-label">Single Column Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC/">MUSC</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/Forcing/">Forcing</a></li><li><a class="tocitem" href="../../../ForecastModel/SingleColumnModel/MUSC_vars/">MUSC vars</a></li></ul></li><li><a class="tocitem" href="../../../ForecastModel/WindFarms/">Wind Farm Parameterisation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Climate Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../ClimateGeneration/ClimateGeneration/">Climate Generation</a></li><li><a class="tocitem" href="../../../ClimateGeneration/DownloadInputData/">Input Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">EPS</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../EPS/Howto/">Howto</a></li><li><a class="tocitem" href="../../../EPS/System/">System</a></li><li><a class="tocitem" href="../../../EPS/BDSTRATEGY/">BDSTRATEGY</a></li><li><a class="tocitem" href="../../../EPS/SLAF/">SLAF</a></li><li><a class="tocitem" href="../../../EPS/SPP/">SPP</a></li><li><a class="tocitem" href="../../../EPS/SPPT/">SPPT</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Post Processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../PostProcessing/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../../PostProcessing/FileConversions/">FileConversions</a></li><li><a class="tocitem" href="../../../PostProcessing/Fullpos/">FullPos</a></li><li><a class="tocitem" href="../../../PostProcessing/gl/">GL</a></li><li><a class="tocitem" href="../../../PostProcessing/xtool/">xtool</a></li><li><a class="tocitem" href="../../../PostProcessing/PostPP/">PostPP</a></li><li><a class="tocitem" href="../../../PostProcessing/Interpolation/">Interpolation GL</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">Verification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Verification/Extract4verification/">Extract4verification</a></li><li><a class="tocitem" href="../../../Verification/Verification/">Verification</a></li><li><a class="tocitem" href="../../../Verification/HARP/">HARP</a></li><li><a class="tocitem" href="../../../Verification/Obsmon/">Obsmon</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-9" type="checkbox"/><label class="tocitem" for="menuitem-3-9"><span class="docs-label">Visualization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Visualization/EPyGrAM/">EpyGram</a></li></ul></li></ul></li><li><span class="tocitem">System</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Build/Build_with_cmake/">CMake</a></li><li><a class="tocitem" href="../../../Build/Build_with_makeup/">Makeup</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phasing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../System/MFaccess/">MF Access</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Suite Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../SuiteManagement/ECFLOW/">ECFLOW</a></li></ul></li><li><a class="tocitem" href="../../../System/TheHarmonieScript/">The Harmonie script</a></li><li><a class="tocitem" href="../../../System/ECMWF/RunningHarmonieOnAtos/">Running on ECMWF&#39;s Atos</a></li><li><a class="tocitem" href="../../../System/ReleaseProcess/">Harmonie release process</a></li><li><a class="tocitem" href="../../../System/Local/QuickStartLocal/">Local</a></li><li><a class="tocitem" href="../../../System/HarmonieTestbed/">Testbed</a></li><li><a class="tocitem" href="../../../System/ECMWF/ECMWF_teleport/">Teleport</a></li><li><a class="tocitem" href="../../../System/Build_local_docs/">Local Documentation</a></li><li><a class="tocitem" href="../../../System/DrHook/">DrHook</a></li><li><a class="tocitem" href="../../../System/StandaloneOdb/">Stand alone ODB</a></li><li><a class="tocitem" href="../../../System/UpdateNamelists/">Update Namelist</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">NWP Components</a></li><li><a class="is-disabled">Data Assimilation</a></li><li><a class="is-disabled">Surface</a></li><li class="is-active"><a href>Surface Analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Surface Analysis</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Hirlam/Harmonie/blob/dev-CY46h1/docs/src/DataAssimilation/Surface/SurfaceAnalysis.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Surface-Data-Assimilation-in-HARMONIE"><a class="docs-heading-anchor" href="#Surface-Data-Assimilation-in-HARMONIE">Surface Data Assimilation in HARMONIE</a><a id="Surface-Data-Assimilation-in-HARMONIE-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-Data-Assimilation-in-HARMONIE" title="Permalink"></a></h1><h2 id="Surface-related-variables-in-ecf/config_exp.h-:"><a class="docs-heading-anchor" href="#Surface-related-variables-in-ecf/config_exp.h-:">Surface related variables in ecf/config_exp.h :</a><a id="Surface-related-variables-in-ecf/config_exp.h-:-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-related-variables-in-ecf/config_exp.h-:" title="Permalink"></a></h2><p>Surface model: <code>SURFACE = surfex</code> / <code>old_surface</code></p><ul><li><code>surfex</code>: SURFEX is used as surface model (default and used in all Harmonie configurations) The surface fields are in a separat AROMOUT_.LLLL.lfi file in LFI format. </li><li><code>old_surface</code>: surface physics modelled by routines integrated in code The surface fields are a part of the atmospheric file (<code>ICMSHXXXX+LLLL</code>) in FA format.</li></ul><p>Surface analysis method: <code>ANASURF = &quot;CANARI_OI_MAIN&quot;</code> / <code>&quot;CANARI_EKF_SURFEX&quot;</code></p><ul><li>the horizontal interpolation of screen level parameters is performed by <a href="../CANARI/">CANARI</a> in both cases</li><li><a href="../CANARI_OI_MAIN/">CANARI<em>OI</em>MAIN</a> updates soil temperature, water and ice based on 2m analysis increments using coefficients that are derived empirically for ISBA2/3-layers scheme</li><li><a href="../CANARI_EKF_SURFEX/">CANARI<em>EKF</em>SURFEX</a> (experimental) updates soil parameters using the Extended Kalman Filter method.</li></ul><p><code>ANASURF_MODE = &quot;before&quot;</code> / <code>&quot;after&quot;</code>/ <code>&quot;both&quot;</code> - surface analysis performed before/after/both before and after 3DVAR</p><p><code>ANASURF_INLINE = &quot;yes&quot;</code> /<code>&quot;no&quot;</code></p><ul><li><code>yes</code>: call SODA for updating soil parameters inside CANARI (default and experimental)</li><li><code>no</code>: soil parameters are updated after CANARI</li></ul><h2 id="Some-details"><a class="docs-heading-anchor" href="#Some-details">Some details</a><a id="Some-details-1"></a><a class="docs-heading-anchor-permalink" href="#Some-details" title="Permalink"></a></h2><p>The default surface model is SURFEX and the default surface assimilation scheme is <code>CANARI_OI_MAIN</code>. <code>CANARI_EKF_SURFEX</code> was first implemented in cy37 and will be undergoing tests in experimental and research mode before it can be used in operational setups.</p><p>CANARI is used for Optimum Interpolation horizontally to find analysis increments in each grid point based on observations minus first guess. The SURFEX assimilation schemes use two different techniques to propagate this information into the ground. The two ways CANARI is used is separated by two namelist settings needed when running with SURFEX:</p><ul><li><code>LAEICS=.FALSE</code>.</li></ul><p>No initialization of ground variables are done as they are in the SURFEX file</p><ul><li><code>LDIRCLSMOD=.TRUE.</code></li></ul><p>2 metre variables taken directly from input file because they without surfex are diagnosed from 0 metre and lowest model height with the model specific routine achmt.</p><p>CANARI was designed before SURFEX was introduced and some of the climate variables that normally exist in the input file for CANARI, do not exist when using SURFEX. This means the task Addsurf is run before CANARI, adding the needed fields from the FA climate file (mMM).</p><p>The screen level analyisis (eg. T2m) used in blending/3DVAR/4DVAR is the same as for CANARI in the old_surface case.</p><h3 id="Variables-updated-in-CANARI-for-old_surface-and-SURFEX"><a class="docs-heading-anchor" href="#Variables-updated-in-CANARI-for-old_surface-and-SURFEX">Variables updated in CANARI for <code>old_surface</code> and SURFEX</a><a id="Variables-updated-in-CANARI-for-old_surface-and-SURFEX-1"></a><a class="docs-heading-anchor-permalink" href="#Variables-updated-in-CANARI-for-old_surface-and-SURFEX" title="Permalink"></a></h3><p><code>src/arpifs/module/qactex.F90</code></p><p>HARMONIE namelist settings:</p><pre><code class="language-bash hljs">!  * LAET2M  : .T. 2 meter temperature analysis
!  * LAEH2M  : .T. 2 meter humidity analysis
!  * LAESNM  : .T. snow analysis
!  * LAESST  : .F. SST analysis
!  * LECSST  : .T. use ECMWF SST
!  * LAEPDS  : .F. surface pressure analysis
!  * LAEUVT  : .F. wind and temperature analysis
!  * LAEHUM  : .F. humidity analysis
!  * LAEV1M  : .F. 10 meter wind analysis</code></pre><h3 id="Blacklisting-of-surface-observation"><a class="docs-heading-anchor" href="#Blacklisting-of-surface-observation">Blacklisting of surface observation</a><a id="Blacklisting-of-surface-observation-1"></a><a class="docs-heading-anchor-permalink" href="#Blacklisting-of-surface-observation" title="Permalink"></a></h3><p>It is possible, in HARMONIE data assimilation, to blacklist data from specific sites. Following example illustrate blacklisting of one automatic (type 24) <strong>ship</strong> measurement with code name <strong>DBKR</strong> starting from a certain date <strong>March 6, 2012</strong>,</p><pre><code class="language-bash hljs">   cd ~/hm_home/$exp
   Harmonie co LISTE_NOIRE_DIAP  # check out blacklist from the repository, e.g., source:Harmonie/nam/LISTE_NOIRE_DIAP
   (edit then nam/LISTE_NOIRE_DIAP to insert, e.g. at the last line, following

    1 SHIP        24  11 DBKR     03062012
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../CANARI_EKF_SURFEX/">« CANARI EKF SURFEX</a><a class="docs-footer-nextpage" href="../../Screening/">Screening »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 12 May 2023 08:22">Friday 12 May 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
