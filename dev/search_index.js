var documenterSearchIndex = {"docs":
[{"location":"Overview/Content/#Harmonie-Content-1","page":"Content","title":"Harmonie Content","text":"","category":"section"},{"location":"Overview/Content/#Overview-1","page":"Content","title":"Overview","text":"","category":"section"},{"location":"Overview/Content/#","page":"Content","title":"Content","text":"Harmonie is HIRLAM's adaptation of the LAM version of the IFS/ARPEGE project. The common code shared with the ALADIN program, Meteo France and ECMWF only contains the source code. Harmonie adds the build environment, scripts, support for a scheduler, and a number of diagnostics tools for file conversion and postprocessing. In summary a git clone of harmonie from github contains the following main directories","category":"page"},{"location":"Overview/Content/#","page":"Content","title":"Content","text":"config-sh : Configuration and job submission files for different platforms.\nconst : A selected number of constant files for bias correction, assimilation and different internal schemes. A large number of data for climate generation and the RTTOV software is kept outside of the repository. See [wiki:HarmonieSystemDocumentation#Downloaddata].\necf : Directory for the main configuration file config_exp.h and the containers for the scheduler ECFLOW.\nsuites Scripts and suit definition files for ECFLOW, the scheduler for HARMONIE. \nnam : Namelists for different configurations.\nscr : Scripts to run the different tasks.\nsrc : The IFS/ARPEGE source code.\nutil : A number of utilities and support libraries.","category":"page"},{"location":"Overview/Content/#util-1","page":"Content","title":"util","text":"","category":"section"},{"location":"Overview/Content/#","page":"Content","title":"Content","text":"The util directory contains the following main directories","category":"page"},{"location":"Overview/Content/#","page":"Content","title":"Content","text":"auxlibs : Contains gribex, bufr, rgb and some dummy routines\nbinutils : https://www.gnu.org/software/binutils/\nchecknorms : Script for code norm checking\ngl_grib_api : Boundary file generator and file converter\nmakeup : HIRLAM style compilation tool\nmusc : MUSC scripts\nobsmon : Code to produce obsmon sqlite files\noffline : SURFEX offline code\noulan : Converts conventional BUFR data to OBSOUL format read by bator.\nRadarDAbyFA : Field alignment code","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Experiment-configuration-1","page":"Experiment","title":"Experiment configuration","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Introduction-1","page":"Experiment","title":"Introduction","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"There are several levels on configuration available in HARMONIE. The highest level of configuration is done in ecf/config_exp.h. It includes the environment variables, which are used to control the experimentation. In the following we describe the meaning of the different variables and are described in the order they appear in ecf/config_exp.h.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Host specific paths and environment variables for your system are defined in Env_system. Read more here.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Build-options-1","page":"Experiment","title":"Build options","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Build and bin paths ****\n# Definitions about Build, should fit with hm_rev\nBUILD=${BUILD-yes}                     # Turn on or off the compilation and binary build (yes|no)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"BUILD is a switch for compiling HARMONIE code (yes|no).","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"BINDIR=${BINDIR-$HM_DATA/bin}                 # Binary directory","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"BINDIR is the location of where your HARMONIE binaries will be installed. You can use this to point to binaries outside of your experiment. A few other options for non default configurations exists as well:","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"COMPILE_ENKF=${COMPILE_ENKF-\"no\"}             # Compile LETKF code (yes|no)\nCOMPILE_DABYFA=${COMPILE_DABYFA-\"no\"}         # Compile FA/VC code (yes|no)\nSURFEX_OFFLINE_BINARIES=\"no\"                  # Switch to compile and use offline SURFEX binaries","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#General-settings-1","page":"Experiment","title":"General settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Misc, defined first because it's used later ****\n\nCNMEXP=HARM                             # Four character experiment identifier\nWRK=$HM_DATA/$CYCLEDIR                  # Work directory","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"CNMEXP: experiment identifier used by MASTERODB\nWRK is the work directory. The suggested path on cca is $SCRATCH/hm_home/${EXP}/$CYCLEDIR","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Archive-settings-(ECMWF)-1","page":"Experiment","title":"Archive settings (ECMWF)","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Since $SCRATCH is cleaned regularly on cca and ecgb some files are transferred to ECFS for a more permanent storage by the scripts scr/Archive_host1 and scr/Archive_ecgb. ","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Paths to archive ****\n# We need to define ARCHIVE early since it might be used further down\n\nARCHIVE_ROOT=$HM_DATA/archive           # Archive root directory\nECFSLOC=ectmp                           # Archiving site at ECMWF-ECFS: \"ec\" or ECFS-TMP \"ectmp\"\nECFSGROUP=hirald                        # Group in which to chgrp the ECMWF archive, \"default\" or \"hirald\"\nEXTRARCH=$ARCHIVE_ROOT/extract          # Archive for fld/obs-extractions","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"ARCHIVE_ROOT is the path to forecast file archive. Note that at ECMWF this directory is not a permanent storage\nEXTRARCH is the path to field extraction archive. Note that at ECMWF this directory is not a permanent storage\nECFSLOC Archiving site at ECMWF-ECFS  (ectmp|ec) Note that files archived on ectmp will be lost after 90 days. If you wish your files to stay longer you should set ECFSLOC=ec. \nECFSGROUP Group in which to chgrp the ECMWF archive, (hirald|default)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Running-Mode-1","page":"Experiment","title":"Running Mode","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Running mode ****\nRUNNING_MODE=research                   # Research or operational mode (research|operational)\n                                        # operational implies that the suite will continue even if e.g.\n                                        # observations are missing or assimilation fails\n\nSIMULATION_TYPE=nwp                     # Type of simulation (nwp|climate)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"RUNNING_MODE can be research or operational. Operational is more forgiving in the error handling and e.g. the assimilation will be skipped if Bator doesn't find any observations. Exceptions handled by the operational mode are written to $HM_DATA/severe_warnings.txt\nSIMULATION_TYPE Switch between nwp and climate type of simulation. The climate simulations are still in an experimental stage. ","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Model-domain-settings-1","page":"Experiment","title":"Model domain settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Horizontal domain settings. Further information is available here","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"\n# **** Model geometry ****\nDOMAIN=DKCOEXP                          # See definitions in scr/Harmonie_domains.pm\nTOPO_SOURCE=gmted2010                   # Input source for orography. Available are (gmted2010|gtopo30)\nGRID_TYPE=LINEAR                        # Type of grid (LINEAR|QUADRATIC|CUBIC)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"DOMAIN defines your domain according to the settings in scr/Harmonie_domains.pm (DKCOEXP). The spectral truncation for your domain is determined from NLON and NLAT by scr/Harmonie_domains.pm. Further information on model domains are available here\nTOPO_SOURCE: Defines input source for model orography (gmted2010|gtopo30). Further information available here: hi-res topography\nGRID_TYPE: This variable is used to define the spectral truncation used (LINEAR|QUADRATIC|CUBIC). GRID_TYPE is used in scr/Climate and scr/Forecast","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Vertical-levels-1","page":"Experiment","title":"Vertical levels","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Set the number vertical levels to use. Further information is available here","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"VLEV=65                                 # Vertical level definition name\n                                        # HIRLAM_60, MF_60,HIRLAM_40, or\n                                        # BOUNDARIES = same number of levs as on boundary file.\n                                        # See the other choices from scr/Vertical_levels.pl","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"VLEV is the name of the vertical levels defined in scr/Vertical_levels.pl (65). Further information is available here. If you intend to run upper air assimilation you must select the same domain and level definition for which you have derived structure functions. Read more Structure Functions","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Forecast-model-1","page":"Experiment","title":"Forecast model","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Higher level forecast model settings.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** High level forecast options ****\nNAMELIST_BASE=\"harmonie\"                # Input for namelist generation (harmonie|alaro1)\n                                        #   harmonie : The default HARMONIE namelist base nam/harmonie_namelists.pm\n                                        #   alaro1   : For ALARO-1 baseline with only a few configurations available\n                                        #              nam/alaro1_namelists.pm\nDYNAMICS=\"nh\"                           # Hydrostatic or non-hydrostatic dynamics (h|nh)\nVERT_DISC=vfd                           # Discretization in the vertical (vfd,vfe)\n                                        # Note that vfe does not yet work in non-hydrostatic mode\nPHYSICS=\"arome\"                         # Main model physics flag (arome|alaro)\nSURFACE=\"surfex\"                        # Surface flag (old_surface|surfex)\nDFI=\"none\"                              # Digital filter initialization (idfi|fdfi|none)\n                                        # idfi : Incremental dfi\n                                        # fdfi : Full dfi\n                                        # none : No initialization (AROME case)\nLSPBDC=no                               # Spectral boundary contions option off(no) | on(yes)\nLGRADSP=yes                             # Apply Wedi/Hortal vorticity dealiasing\nLUNBC=yes                               # Apply upper nested boundary condition","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"NAMELIST_BASE: Two different namelist sets are available (harmonie|alaro).\nDYNAMICS: Hydrostatic or non-hydrostatic dynamics (h|nh)\nVERT_DISC: Vertical discretization (vfd,vfe)\nPHYSICS: HARMONIE uses either AROME or ALARO for its forecast model physics (arome|alaro)\nSURFACE: Surface physics flag to use either the SURFEX or the ALADIN surface scheme(surfex|old_surface)\nDFI: Digital filter initialization switch (idfi|fdfi|none). idfi - incremental dfi, fdfi - full dfi, none - no initialization. See Digital filter for more information\nLSPBDC: Specify whether the boundary conditions are spectral or not (yes|no)\nLGRADSP: Switch to apply vorticity dealiasing (yes|no)\nLUNBC: Switch to apply upper boundary conditions (yes|no)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Physics-1","page":"Experiment","title":"Physics","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Physics options.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# Highlighted physics switches\nCISBA=\"3-L\"                             # Type of ISBA scheme in SURFEX. Options: \"3-L\" and \"2-L\".\nCROUGH=\"NONE\"                           # SSO scheme used in SURFEX \"NONE\"|\"'Z01D'\"|\"'BE04'\"\nSURFEX_SEA_ICE=\"none\"                   # Treatment of sea ice in surfex (none|sice)\nMASS_FLUX_SCHEME=edmfm                  # Version of EDMF scheme (edkf|edmfm)\n                                        # Only applicable if PHYSICS=arome\n                                        # edkf is the AROME-MF version\n                                        # edmfm is the KNMI implementation of Eddy Diffusivity Mass Flux scheme for Meso-scale\nHARATU=\"yes\"                            # Switch for HARATU turbulence scheme (no|yes)\nALARO_VERSION=0                         # Alaro version (1|0)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"CISBA: If SURFACE is set to surfex this selects the type of ISBA scheme to use in SURFEX. (3-L|2-L). See src/surfex_namelists.pm  Namelists\nCROUGH: If SURFACE is set to surfex this selects the sub-grid scale orography scheme used in SURFEX. (NONE|Z01D|BE04). See src/surfex_namelists.pm  Namelist\nSURFEX_SEA_ICE: Treatment of sea ice in surfex (none|sice). See nam/surfex_namelists.pm\nMASS_FLUX_SCHEME: If PHYSICS is set to arome choose the mass flux scheme to be used by AROME; edkf to use the AROME-MF scheme or edmfm to use the KNMI developed scheme\nHARATU: Switch to use the HARATU turbulence scheme\nALARO_VERSION: If PHYSICS is set to alaro select version of ALARO to use (0|1)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Assimilation-1","page":"Experiment","title":"Assimilation","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Data assimilation settings. More assimilation related settings, in particular what observations to assimilate, can be found in src/include.ass","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Assimilation ****\nANAATMO=3DVAR                           # Atmospheric analysis (3DVAR|4DVAR|blending|none)\nANASURF=CANARI_OI_MAIN                  # Surface analysis (CANARI|CANARI_OI_MAIN|CANARI_EKF_SURFEX|none)\n                                        # CANARI            : Old style CANARI\n                                        # CANARI_OI_MAIN    : CANARI + SURFEX OI\n                                        # CANARI_EKF_SURFEX : CANARI + SURFEX EKF ( experimental )\n                                        # none              : No surface assimilation\nANASURF_MODE=\"before\"                   # When ANASURF should be done\n                                        # before            : Before ANAATMO\n                                        # after             : After ANAATMO\n                                        # both              : Before and after ANAATMO (Only for ANAATMO=4DVAR)\nINCV=\"1,1,1,1\"                          # Active EKF control variables. 1=WG2 2=WG1 3=TG2 4=TG1\nINCO=\"1,1,0\"                            # Active EKF observation types (Element 1=T2m, element 2=RH2m and element 3=Soil moisture) \n\nMAKEODB2=no                             # Conversion of ODB-1 to ODB-2 using odb_migrator\n\nSST=BOUNDARY                            # Which SST fields to be used in surface analysis\n                                        # BOUNDARY          : SST interpolated from the boundary file. ECMWF boundaries utilize a special method.\n                                        #                     HIRLAM and HARMONIE boundaries applies T0M which should be SST over sea.\nLSMIXBC=no                              # Spectral mixing of LBC0 file before assimilation\n[ \"$ANAATMO\" = 3DVAR] && LSMIXBC=yes\nJB_INTERPOL=no                          # Interpolation of structure functions from a pre-defined domain to your domain\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"ANAATMO: Atmospheric analysis (3DVAR|4DVAR|blending|none)\nANASURF: Surface analysis (CANARI|CANARIOIMAIN|CANARIEKFSURFEX|none). See nam/surfex_namelists.pm\nANASURF_MODE:When the surface should be called (before|after|both)\nINCV: Active EKF control variables. 1=WG2 2=WG1 3=TG2 4=TG1 (0|1)\nINCO: Active EKF observation types (Element 1=T2m, element 2=RH2m and element 3=Soil moisture) (0|1)\nMAKEODB2: Option to convert ODB-1 databases to ODB-2 files for DA monitoring\nSST: which sea surface temperature field to use in the surface analysis\nLSMIXBC Spectral mixing of LBC0 file before assimilation (no|yes)\nJB_INTERPOL Interpolation of structure functions from a pre-defined domain to your domain (no|yes). Note that this has to be used with some caution.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Observations-1","page":"Experiment","title":"Observations","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Observations ****\nOBDIR=$HM_DATA/observations             # Observation file directory\nRADARDIR=$HM_DATA/radardata             # Radar observation file directory\nSINGLEOBS=no                            # Run single obs experiment with observation created by scr/Create_single_obs (no|yes)\n\nUSE_MSG=no                              # Use MSG data for adjustment of inital profiles, EXPERIMENTAL! (no|yes)\nMSG_PATH=$SCRATCH/CLOUDS/               # Location of input MSG FA file, expected name is MSGcloudYYYYMMDDHH","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"OBDIR: Defines the directory that your (BUFR) observation files (obYYYYMMDDHH) are to read from\nRADARDIR: Defines the directory that your (OPERA HDF5) radar observation files are to be read from. BALTRAD OPERA HDF5, MF BUFR and LOCAL files are treated in scr/Prepradar\nSINGLEOBS Run single obs experiment with synthetic observation created by scr/Create_single_obs scr/Create_single_obs (no|yes)\nUSE_MSG: Use MSG data for adjustment of inital profiles, EXPERIMENTAL! (no|yes)\nMSG_PATH:  Location of input MSG FA file, expected name is MSGcloudYYYYMMDDHH. Note that the pre-processing software to generate input files is not yet included in HARMONIE","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#DVAR-settings-1","page":"Experiment","title":"4DVAR settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"4DVAR settings (experimental)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** 4DVAR ****\nNOUTERLOOP=1                            # 4DVAR outer loops, need to be 1 at present\nILRES=2,2                               # Resolution (in parts of full) of outer loops\nTSTEP4D=360,360                         # Timestep length (seconds) of outer loops TL+AD\nTL_TEST=yes                             # Only active for playfile tlad_tests\nAD_TEST=yes                             # Only active for playfile tlad_tests","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"NOUTERLOOP: Number of outer loops, need to be 1 at present\nILRES:  Resolution (in parts of full) of outer loops\nTSTEP4D: Timestep length (seconds) of outer loops TL+AD\nTL_TEST: Only active for playfile tlad_tests (yes|no)\nAD_TEST: Only active for playfile tlad_tests (yes|no)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Digital-filter-settings-1","page":"Experiment","title":"Digital filter settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Digital filter initialization settings if DFI is not equal to \"none\"","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** DFI setting ****\nTAUS=5400                               # cut-off frequency in second\nTSPAN=5400                              # 7200s or 5400s","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"TAUS cut-off frequency in seconds \nTSPAN length of DFI run in seconds","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Boundaries-and-initial-conditions-1","page":"Experiment","title":"Boundaries and initial conditions","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Settings for generation of lateral boundaries conditions for HARMONIE. Further information is available here","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Lateral boundary conditions ****\nHOST_MODEL=\"ifs\"                        # Host model (ifs|hir|ald|ala|aro)\n                                        # ifs : ecmwf data\n                                        # hir : hirlam data\n                                        # ald : Output from aladin physics\n                                        # ala : Output from alaro physics\n                                        # aro : Output from arome physics\n\nHOST_SURFEX=\"no\"                        # yes if the host model is run with SURFEX\nSURFEX_INPUT_FORMAT=lfi                 # Input format for host model run with surfex (lfi|fa)\n\nNBDMAX=12                               # Number of parallel interpolation tasks\nBDLIB=ECMWF                             # Boundary experiment, set:\n                                        # ECMWF to use MARS data\n                                        # RCRa  to use RCRa data from ECFS\n                                        # Other HARMONIE/HIRLAM experiment\n\nBDDIR=$HM_DATA/${BDLIB}/archive/@YYYY@/@MM@/@DD@/@HH@   # Boundary file directory,\n                                                        # For more information, read in scr/Boundary_strategy.pl\nINT_BDFILE=$WRK/ELSCF${CNMEXP}ALBC@NNN@                 # Interpolated boundary file name and location\n\nBDSTRATEGY=simulate_operational # Which boundary strategy to follow\n                                # as defined in scr/Boundary_strategy.pl\n                                #\n                                # available            : Search for available files in BDDIR, try to keep forecast consistency\n                                #                        This is ment to be used operationally\n                                # simulate_operational : Mimic the behaviour of the operational runs using ECMWF LBC,\n                                #                        i.e. 6 hour old boundaries\n                                # same_forecast        : Use all boundaries from the same forecast, start from analysis\n                                # analysis_only        : Use only analysises as boundaries\n                                # era                  : As for analysis_only but using ERA interim data\n                                # latest               : Use the latest possible boundary with the shortest forecast length\n                                # RCR_operational      : Mimic the behaviour of the RCR runs, ie\n                                #                        12h old boundaries at 00 and 12 and\n                                #                        06h old boundaries at 06 and 18\n                                # enda                 : use ECMWF ENDA data for running ensemble data assimilation\n                                #                        or generation of background statistic.\n                                #                        Note that only LL up to 9h is supported\n                                #                        with this you should set your ENSMSEL members\n                                # eps_ec               : ECMWF EPS members (on reduced gaussian grid)\n                                #                      : Only meaningful with ENSMSEL non-empty, i.e., ENSSIZE > 0\n\nBDINT=1                         # Boundary interval in hours\n\nSURFEX_PREP=\"yes\"                # Use offline surfex prep facility (Alt. gl + Fullpos + prep )","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"HOST_MODEL defines the host model that provides the lateral boundaries conditions for your experiment\nhir for HIRLAM.\nald for ALADIN \nala for ALARO\naro for AROME\nifs for ECMWF-IFS. \nHOST_SURFEX Set to yes if host model runs with SURFEX. (no|yes)\nSURFEX_INPUT_FORMAT Input format for host model run with surfex (lfi|fa)\nBDLIB is the experiment to be used as boundaries. Possible values, ECMWF for IFS from MARS (default), RCRa for HIRLAM-RCR from ECFS or other HARMONIE experiment. \nBDDIR is the boundary file directory. The possible date information in the path must be given by using UPPER CASE letters (@YYYY@=year,@MM@=month,@DD@=day,@HH@=hour,@FFF@=forecast length).  \nBDSTRATEGY Which boundary strategy to follow i.e. How to find the right boundaries with the right age and location. Read more\nBDINT is boundary interval in hours.\nBDCLIM is the path to climate files corresponding the boundary files, when nesting HARMONIE to HARMONIE.\nINT_BDFILE is the name and location of the interpolated boundary files. These files are removed every cycle, but if you wish to save them you can specify a more permanent location here. By setting INT_BDFILE=ARCHIVE the interpolated files will be stored in your archive directory.\nNBDMAX Number of parallel boundary interpolation tasks in mSMS. The current default value is 12.\nSURFEX_PREP Use SURFEX tool PREP instead of gl+FULLPOS to prepare SURFEX initial conditions. This is now the default. The gl+FULLPOS version is still working but will not be maintained in the future (no|yes)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Read more about the boundary file preparation here.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Ensemble-mode-settings-1","page":"Experiment","title":"Ensemble mode settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# *** Ensemble mode general settings. ***\n# *** For member specific settings use msms/harmonie.pm ***\nENSMSEL=                                # Ensemble member selection, comma separated list, and/or range(s):\n                                        # m1,m2,m3-m4,m5-m6:step    mb-me == mb-me:1 == mb,mb+1,mb+2,...,me\n                                        # 0=control. ENSMFIRST, ENSMLAST, ENSSIZE derived automatically from ENSMSEL.\nENSINIPERT=                             # Ensemble perturbation method (bnd). Not yet implemented: etkf, hmsv.\nENSCTL=                                 # Which member is my control member? Needed for ENSINIPERT=bnd. See harmonie.pm.\nENSBDMBR=                               # Which host member is used for my boundaries? Use harmonie.pm to set.\nENSMFAIL=0                              # Failure tolerance for all members.\nENSMDAFAIL=0                            # Failure tolerance for members doing own DA. Not implemented.\nSLAFK=1.0                               # best set in harmonie.pm\nSLAFLAG=0                               # --- \" ---\nSLAFDIFF=0                              # --- \" ---\n\n# *** This part is for EDA with observations perturbation\nPERTATMO=none                           # ECMAIN  : In-line observation perturbation using the default IFS way.\n                            \t\t\t# CCMA    : Perturbation of the active observations only (CCMA content)\n\t                            \t\t#           before the Minimization, using the PERTCMA executable.\n                            \t\t\t# none    : no perturbation of upper-air observations\n\nPERTSURF=none                           # ECMA    : perturb also the surface observation before Canari (recommended\n                            \t\t\t#         : for EDA to have full perturbation of the initial state).\n                                        # model   : perturb surface fields in grid-point space (recursive filter)\n\t\t\t                            # none    : no perturbation for surface observations.\n\nFESTAT=no                               # Extract differences and do Jb calculations (no|yes)\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"ENSMSEL  Ensemble member selection, comma separated list, and/or range(s):\n # m1,m2,m3-m4,m5-m6:step    mb-me == mb-me:1 == mb,mb+1,mb+2,...,me\n  # 0=control. ENSMFIRST, ENSMLAST, ENSSIZE derived automatically from ENSMSEL.\nENSINIPERT Ensemble perturbation method (bnd). Not yet implemented: etkf, hmsv, slaf.\nENSMFAIL Failure tolerance for all members. Not yet implemented.\nENSMDAFAIL Failure tolerance for members doing own DA. Not yet implemented.\nENSCTL Which member is my control member? Needed for ENSINIPERT=bnd. See harmonie.pm.\nENSBDMBR Which host member is used for my boundaries? Use harmonie.pm to set.\nSLAFK Perturbation coefficients for SLAF, experimental\nSLAFLAG Time lag for boundaries in SLAG, experimental","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"For member dependent settings see msms/harmonie.pm.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"PERTATMO Observation perturbation with three options \nECMA : In-line observation perturbation using the default IFS way.\nCCMA : Perturbation of the active observations only (CCMA content) before the Minimization, using the PERTCMA executable.\nnone : no perturbation of upper-air observations\nPERTSURF Perturbation of surface observations before Canari (recommended for EDA to have full perturbation of the initial state) (no|yes).","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"FESTAT Extract differences and do Jb calculations (no|yes). Read more about the procedure here.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Climate-file-settings-1","page":"Experiment","title":"Climate file settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Climate file generation settings. Further information is available here","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Climate files ****\nCREATE_CLIMATE=${CREATE_CLIMATE-yes}    # Run climate generation (yes|no)\nCLIMDIR=$HM_DATA/climate                # Climate files directory\nBDCLIM=$HM_DATA/${BDLIB}/climate        # Boundary climate files (ald2ald,ald2aro)\n                                        # This should point to intermediate aladin \n                                        # climate file in case of hir2aro,ifs2aro processes.\n\n# Physiography input for SURFEX\nECOCLIMAP_VERSION=2.2                   # Version of ECOCLIMAP for surfex (1,2)\n                                        # Available versions are 1.1-1.5,2.0-2.2\nSOIL_TEXTURE_VERSION=FAO                # Soil texture input data FAO|HWSD_v2","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"CREATE_CLIMATE: Run climate generation (yes|no). If you already have a full set of climate files generated in CLIMDIR you can set this flag to no for a faster run.\nCLIMDIR: path to the generated climate files for your specific domain. The input data for the climate generation is defined by HM_CLDATA defined in Env_system -> config-sh/config.YOURHOST\nBDCLIM: path to intermediate climate files\nECOCLIMAP_VERSION is the version of ECOCLIMAP to be used with SURFEX. Available versions are 1.1-1.5,2.0,2.1,2.2. See surfex_namelists.pm Namelist\nSOIL_TEXTURE_VERSION Soil texture input data (FAO|HWSD_v2). See surfex_namelists.pm more info.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Archiving-settings-1","page":"Experiment","title":"Archiving settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Archiving settings ****\nARCHIVE_ECMWF=yes                       # Archive to $ECFSLOC at ECMWF (yes|no)\n# Archiving selection syntax, settings done below\n#\n# [fc|an|pp]_[fa|gr|nc] : Output from\n#  an : All steps from upper air and surface analysis\n#  fc : Forecast model state files from upper air and surfex\n#  pp : Output from FULLPOS and SURFEX_LSELECT=yes (ICMSHSELE+NNNN.sfx)\n# in any of the formats if applicable\n#  fa : FA files\n#  gr : GRIB[1|2] files\n#  nc : NetCDF files\n# sqlite|odb|VARBC|bdstrategy : odb and sqlite files stored in odb_stuff.tar\n# fldver|ddh|vobs|vfld : fldver/ddh/vobs/vfld files\n# climate : Climate files from PGD and E923\n# Some macros\n# odb_stuff=odb:VARBC:bdstrategy:sqlite\n# verif=vobs:vfld\n# fg : Required files to run the next cycle","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Forecast-output-1","page":"Experiment","title":"Forecast output","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Cycles to run, and their forecast length ****\n\nTFLAG=\"h\"                               # Time flag for model output. (h|min)\n                                        # h   = hour based output\n                                        # min = minute based output\n\n\n# The unit of HWRITUPTIMES, FULLFATIMES, ..., SFXFWFTIMES should be:\n#   - hours   if TFLAG=\"h\"\n#   - minutes if TFLAG=\"min\"\n\n# Writeup times of # history,surfex and fullpos files\n# Comma separated list, and/or range(s) like:\n# t1,t2,t3-t4,t5-t6:step    tb-te == tb-te:1 == tb,tb+1,tb+2,...,te\n\nif [ -z \"$ENSMSEL\"] ; then\n  # Standard deterministic run\n  HH_LIST=\"00-21:3\"                       # Which cycles to run, replaces FCINT\n  LL_LIST=\"12,3\"                          # Forecast lengths for the cycles [h], replaces LL, LLMAIN\n                                          # The LL_LIST list is wrapped around if necessary, to fit HH_LIST\n  HWRITUPTIMES=\"00-21:3,24-60:6\"          # History file output times\n  FULLFAFTIMES=$HWRITUPTIMES              # History FA file IO server gather times\n  PWRITUPTIMES=\"00-60:3\"                  # Postprocessing times\n  PFFULLWFTIMES=-1                        # Postprocessing FA file IO server gathering times\n  VERITIMES=\"00-60:1\"                     # Verification output times, may change PWRITUPTIMES\n  SFXSELTIMES=$HWRITUPTIMES               # Surfex select file output times\n                                          # Only meaningful if SURFEX_LSELECT=yes\n  SFXSWFTIMES=-1                          # SURFEX select FA file IO server gathering times\n  SWRITUPTIMES=\"00-06:3\"                  # Surfex model state output times\n  SFXWFTIMES=$SWRITUPTIMES                # SURFEX history FA file IO server gathering times\n  if [ \"$SIMULATION_TYPE\" == climate]; then  #Specific settings for climate simulations\n    HWRITUPTIMES=\"00-760:6\"                 # History file output times\n    FULLFAFTIMES=\"00-760:24\"                # History FA file IO server gather times\n    PWRITUPTIMES=$HWRITUPTIMES              # Postprocessing times\n    VERITIMES=$HWRITUPTIMES                 # Verification output times, may change PWRITUPTIMES\n    SFXSELTIMES=$HWRITUPTIMES               # Surfex select file output times - Only meaningful if SURFEX_LSELECT=yes\n    SWRITUPTIMES=\"00-760:12\"                # Surfex model state output times\n    SFXWFTIMES=$SWRITUPTIMES                # SURFEX history FA file IO server gathering times\n  fi\n\n  ARSTRATEGY=\"climate:fg:verif:odb_stuff: \\\n              [an|fc]_fa:pp_grb\"          # Files to archive on ECFS, see above for syntax\n\nelse\n  # EPS settings\n  HH_LIST=\"00-21:3\"                       # Which cycles to run, replaces FCINT\n  LL_LIST=\"36,3,3,3\"                      # Forecast lengths for the cycles [h], replaces LL, LLMAIN\n  HWRITUPTIMES=\"00-06:3\"                  # History file output times\n  FULLFAFTIMES=$HWRITUPTIMES              # History FA file IO server gather times\n  PWRITUPTIMES=\"00-48:1\"                  # Postprocessing times\n  PFFULLWFTIMES=-1                        # Postprocessing FA file IO server gathering times\n  VERITIMES=\"00-60:3\"                     # Verification output times, may change PWRITUPTIMES\n  SFXSELTIMES=$HWRITUPTIMES               # Surfex select file output times\n                                          # Only meaningful if SURFEX_LSELECT=yes\n  SFXSWFTIMES=-1                          # SURFEX select FA file IO server gathering times\n  SWRITUPTIMES=\"00-06:3\"                  # Surfex model state output times\n  SFXWFTIMES=$SWRITUPTIMES                # SURFEX history FA file IO server gathering times\n\n  ARSTRATEGY=\"climate:fg:verif:odb_stuff: \\\n              an_fa:pp_grb\"               # Files to archive on ECFS, see above for syntax\n\nfi\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"The writeup times of model output can be defined as a space separated list or as a fixed frequency for model history files, surfex files and postprocessed files respectively. The unit of the steps of WRITUPTIMES, SWRITUPTIMES, PWRITUPTIMES and OUTINT should be in hours or minutes depending on the TFLAG Regular output interval can be switched on by setting OUTINT>0. Consequently, OUTINT will override the WRITUPTIMES lists!","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"TFLAG: Time flag for model output. Hourly or minute-based output (h|min)\nHWRITUPTIMES:  Output list for history files. Default is 00-21:3,24-60:6 which will output files every 3 hours for 00-21 and every 6 hours for 24-60.\nVERITIMES:  Output list for verification files. Default is 00-60:1 which will produce file every 1 hour for 00-60\nSWRITUPTIMES  Output list for surfex files. Default is 00-06:3 which output a  SURFEX file every 3 hours for 00-06.\nPWRITUPTIMES  Output list for fullpos (post-processed) files. Default is 00-21:3,24-60:6 which will output files every 3 hours for 00-21 and every 6 hours for 24-60.","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"SURFEX_LSELECT=\"yes\"                    # Only write selected fields in surfex outpute files. (yes|no)\n                                        # Check nam/surfex_selected_output.pm for details.\n                                        # Not tested with lfi files.\nINT_SINI_FILE=$WRK/SURFXINI.fa          # Surfex initial file name and location\n\n# **** Postprocessing/output ****\nIO_SERVER=yes                           # Use IO server (yes|no). Set the number of cores to be used\n                                        # in your Env_submit\nIO_SERVER_BD=yes                        # Use IO server for reading of boundary data\nPOSTP=\"inline\"                          # Postprocessing by Fullpos (inline|offline|none).\n                                        # See Setup_postp.pl for selection of fields.\n                                        # inline: this is run inside of the forecast\n                                        # offline: this is run in parallel to the forecast in a separate task\n\nFREQ_RESET_TEMP=3                       # Reset frequency of max/min temperature values in hours, controls NRAZTS\nFREQ_RESET_GUST=1                       # Reset frequency of max/min gust values in hours, controls NXGSTPERIOD\n                                        # Set to -1 to get the same frequency _AND_ reset behaviour as for min/max temperature\n                                        # See yomxfu.F90 for further information.\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"SURFEX_LSELECT: Switch to write a selection of fields in SURFEX output files (yes|no). See surfex_selected_output.pm for more info. Namelist\nINT_SINI_FILE: name and location of the initial SURFEX file\nARCHIVE_ECMWF: archive files to ECFSLOC at ECMWF (yes|no)\nIO_SERVER: Use IO server (yes|no). If set to \"yes\" changes may be required in Env_submit -> config-sh/submit.YOURHOUST\nPOSTP: Postprocessing by Fullpos (inline|offline|none).\nFREQ_RESET_[TEMP|GUST]: Reset frequency of max/min values in hours, controls NRAZTS. Default is every 3/1 hours","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** GRIB ****\nCONVERTFA=yes                           # Conversion of FA file to GRIB/nc (yes|no)\nARCHIVE_FORMAT=GRIB1                    # Format of archive files (GRIB1|GRIB2|nc). nc format yet only available in climate mode\nNCNAMES=nwp                             # Nameing of NetCDF files follows (climate|nwp) convention.\nRCR_POSTP=no                            # Produce a subset of fields from the history file for RCR monitoring\n                                        # Only applicable if ARCHIVE_FORMAT=GRIB\nMAKEGRIB_LISTENERS=1                    # Number of parallel listeners for Makegrib\n                                        # Only applicable if ARCHIVE_FORMAT=GRIB\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"More options on fullpos postprocessing can be found in scr/Select_posp.pl","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"CONVERTFA: Conversion of FA files to GRIB or NetCDF (yes|no)\nARCHIVE_FORMAT: Format of archive files (GRIB1|nc). NetCDF format yet only available in climate mode\nRCR_POSTP: Produce a subset of fields from the history file for RCR monitoring (yes|no). This is only applicable if ARCHIVE_FORMAT=GRIB1|GRIB2\nMAKEGRIB_LISTENERS: Number of parallel listeners for Makegrib. Only applicable if ARCHIVE_FORMAT=GRIB1|GRIB2","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"More options on file conversion can be found in scr/Makegrib","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Verification-and-monitoring-1","page":"Experiment","title":"Verification and monitoring","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# **** Verification extraction ****\nOBSEXTR=yes                             # Extract observations from BUFR (yes|no)\nFLDEXTR=yes                             # Extract model data for verification from model files (yes|no)\nFLDEXTR_TASKS=1                         # Number of parallel tasks for field extraction\nVFLDEXP=$EXP                            # Experiment name on vfld files","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"OBSEXTR: Extract observations for verification from BUFR (yes|no)\nFLDEXTR: Extract model data for verification from model files (yes|no)\n*FLDEXTR_TASKS: Number of parallel tasks for field extraction\nVFLDEXP:","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Read more about the verification package here","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Field-verification-1","page":"Experiment","title":"Field verification","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# *** Field verification ***\nFLDVER=no                               # Main switch for field verification (yes|no)\nFLDVER_HOURS=\"06 12 18 24 30 36 42 48\"  # Hours for field verification\n","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"FLDVER Main switch for field verification (yes|no). The field verification extracts some selected variables for calculation of bias, rmse, stdv and averages on the model grid.\nFLDVER_HOURS Hours for field verification","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"More options on field verification can be found in scr/Fldver and scr/AccuFldver","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Observation-monitoring-and-general-diagnostics-1","page":"Experiment","title":"Observation monitoring and general diagnostics","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"# *** Observation monitoring ***\nOBSMONITOR=obstat                       # Create Observation statistics plots\n                                        # Format: OBSMONITOR=Option1:Option2:...:OptionN\n                                        # obstat: Daily usage maps and departures\n                                        # no: Nothing at all\n                                        #\n                                        # obstat is # only active if ANAATMO != none\nOBSMON_SYNC=no                          # Sync obsmn sqlite tables to ecgate (yes|no)","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"OBSMONITOR Selection for observation statistics plots","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"obstat Observations usage. Read more here.\nno No monitoring","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Note that this is only active if ANAATMO != none","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#Field-monitoring-(-experimental-)-1","page":"Experiment","title":"Field monitoring ( experimental )","text":"","category":"section"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"Make various charts for daily monitoring","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"#  *** Monitoring maps for hirlam.org. ***\n#      Note that at ECMWF this is run on ecgb (grads is only there)\n#      In  this version You must check out manually contrib/mapbin to the \n#      directory referred as MAPBIN \nFIELDMONITOR=no\nMAPBIN=$HM_DATA/lib/util/mapbin","category":"page"},{"location":"ExperimentConfiguration/ConfigureYourExperiment/#","page":"Experiment","title":"Experiment","text":"FIELDMONITOR Main switch (no|yes)\nMAPBIN Path to plotting settings. Read more in scr/Monitoring_maps","category":"page"},{"location":"DataAssimilation/MTEN/#Moist-Total-Energy-Norm-(MTEN)-diagnostic-1","page":"MTEN","title":"Moist Total Energy Norm (MTEN) diagnostic","text":"","category":"section"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"MTEN shows the sensitivity of the forecast model to different observations withdrawn from the full analysis system.  There are two ways of computing the MTEN diagnostic: A special branch was created in CY40 (see below) where the MTEN diagnostic can be requested. This approach uses Harmonie ensemble system to perform series of observation denial independent runs. This means that the following settings are used in msms/harmonie.pm","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"    'ENSBDMBR' => [ 0 ],\n    'ENSCTL'   => [ '000',  '001',  '002',  '003', '004', '005', '006', '007' ],\n    'AIRCRAFT_OBS' => [ 0, 1, 1, 1, 1, 1, 1, 1],\n    'BUOY_OBS'     => [ 1, 0, 1, 1, 1, 1, 1, 1],\n    'AMSUA_OBS'    => [ 1, 1, 0, 1, 1, 1, 1, 1],\n    'AMSUB_OBS'    => [ 1, 1, 1, 0, 1, 1, 1, 1],\n    'POL_OBS'      => [ 1, 1, 1, 1, 0, 1, 1, 1],\n    'HRW_OBS'      => [ 1, 1, 1, 1, 1, 0, 1, 1],\n    'TEMP_OBS'     => [ 1, 1, 1, 1, 1, 1, 0, 1],\n    'IASI_OBS'     => [ 1, 1, 1, 1, 1, 1, 1, 0],","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"In this particular example, we are interested in the impact of aircraft, Buoy, amsu-a, amsu-b/mhs, polar winds, high-resolution geowinds, radiosonde, and iasi observations. This setting is activated in config.exp with the following choice:","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"export  REFEXP DOMTEN\nexport SYNOP_OBS=1             # All synop\nexport AIRCRAFT_OBS=1          # AMDAR, AIREP, ACARS\nexport BUOY_OBS=1              # Buoy\nexport POL_OBS=1               # Satob polar winds\nexport GEO_OBS=0               # Satob geo winds\nexport HRW_OBS=1               # Satob HRWind\nexport TEMP_OBS=1              # TEMP, TEMPSHIP\nexport PILOT_OBS=1             # Pilot, Europrofiler\nexport SEVIRI_OBS=0            # Seviri radiances\nexport AMSUA_OBS=1             # AMSU-A\nexport AMSUB_OBS=1             # AMSU-B, MHS\nexport IASI_OBS=1              # IASI\nexport PAOB_OBS=0              # PAOB not defined everywhere\nexport SCATT_OBS=0             # Scatterometer data not defined everywhere\nexport LIMB_OBS=0              # LIMB observations, GPS Radio Occultations\nexport RADAR_OBS=0             # Radar\nexport GNSS_OBS=0              # GNSS","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"Where REFEXP is the reference experiment (see below), and DOMTEN (yes,no) is activate the MTEN choice when fetching the First-guess and the VarBC files for the MTEN computation, as follows: in /scr/Fetch_assim_data:","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"if [ ${DOMTEN} = \"yes\" ]; then\n  HM_REFEXP=/sbt/harmonie/$REFEXP\n  adir=${ECFSLOC}:${HM_REFEXP}/$YY/$MM/$DD/$HH\nelse\n  adir=$( ArchDir $HM_EXP $YY $MM $DD $HH )\nfi","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"in scr/FirstGuess (be careful this happens twice in the script)","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"if [ ${DOMTEN} = \"yes\" ]; then\n  HM_REFEXP=/sbt/harmonie/$REFEXP\n  adir=${ECFSLOC}:${HM_REFEXP}/$FGYY/$FGMM/$FGDD/$FGHH\nelse\n  adir=$( ArchDir $HM_EXP $FGYY $FGMM $FGDD $FGHH )\nfi","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"The MTEN can be also computed using a deterministic system. In this case, you need to take care of the First-guess and the VarBC files, which should come from the reference experiment. You need to carefully set the choice of the observations to be tested in scr/include.ass. In this case, you need to adapt the above Fetch_assim_data and FirstGuess scripts accordingly.","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"The MTEN diagnostic, similarly to DFS, is case sensitive, so it's better to male the computation with times and dates enough distant (by 5 days or more).","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"The MTEN can be computed the example below:","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"  for EXP in EXP1 EXP2;\n    for RANGE in 06 12 18 24 30 36 42 48;\n    do\n\n       YY=`echo $DTG | cut -c 1-4`\n       mm=`echo $DTG | cut -c 5-6`\n       dd=`echo $DTG | cut -c 7-8`\n       hh=`echo $DTG | cut -c 9-10`\n       # -- Get the FA files\n       # ===================\n       ecp ec:/$USER/harmonie/$REFEXP/$YY/$mm/$dd/$hh/ICMSHHARM+00$RANGE ./FAREF$RANGE\n       ecp ec:/$USER/harmonie/${EXP}/$YY/$mm/$dd/$hh/ICMSHHARM+00$RANGE ./${EXP}$RANGE\n       $MTEN_BIN/MTEN ./FAREF$RANGE ./${EXP}$RANGE\n\n    done\n  done\n","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"See Storto & Randriamampianina, 2010 for more details.","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"The harmonie-40h1_DA branch can be used to calculate MTEN values for selected (40h1.2/trunk) forecasts by using the ensemble functionality to carry multiple observation withdrawal experiments. Follow these instructions:","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"Check out the DA branch:\nmkdir -p $SCRATCH/harmonie_releases/branches\ncd $SCRATCH/harmonie_releases/branches\nsvn co https://svn.hirlam.org/branches/harmonie-40h1_DA\nSet up your (MTEN) experiment:\nmkdir -p $HOME/hm_home/mtenEXP\ncd $HOME/hm_home/mtenEXP\n$SCRATCH/harmonie_releases/branches/harmonie-40h1_DA/config-sh/Harmonie setup -r $SCRATCH/harmonie_releases/branches/harmonie-40h1_DA\nYou will need to edit the ecf/config_exp.h  file and msms/harmonie.pm file to produce the required observation withdrawal experiments.","category":"page"},{"location":"DataAssimilation/MTEN/#","page":"MTEN","title":"MTEN","text":"... More to follow ...","category":"page"},{"location":"PostProcessing/gl/#GL-1","page":"GL","title":"GL","text":"","category":"section"},{"location":"PostProcessing/gl/#xtool-1","page":"GL","title":"xtool","text":"","category":"section"},{"location":"System/MFaccess/#Using-Météo-France-Servers-1","page":"MF Access","title":"Using Météo-France Servers","text":"","category":"section"},{"location":"System/MFaccess/#Introduction-1","page":"MF Access","title":"Introduction","text":"","category":"section"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"The procedure to get access to MF servers and their read-only git repository is outlined here","category":"page"},{"location":"System/MFaccess/#First-steps-1","page":"MF Access","title":"First steps","text":"","category":"section"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"Discuss your requirements for access to MF servers with the HIRLAM System project leader, Daniel Santos (dsantosm@aemet.es).\nDownload two forms \"Undertaking for the use of Météo-France computer resources\" and \"Demande d'authorisation de conexion au résau de Météo Franc\" from http://www.cnrm.meteo.fr/aladin/spip.php?article157. \nThe \"Undertaking for the use of Météo-France computer resources\" form  is to be signed by you only\nThe \"Demande d'authorisation de conexion au résau de Météo France\" must be signed by you and your department head. It must also include an institute stamp. You should enter details in Contacts, Compte d'accesés aux machines du Centre de Cacul and at the bottom with authorization from you institute manager with institute stamp.   - A scan of both forms with a brief introductory note should be sent to Eric Escaliere (eric.escaliere@meteo.fr) and cc'ed to Daniel Santos (dsantosm@aemet.es) and Claude Fischer (claude.fischer@meteo.fr).\nBe careful with the \"Machine du client\". I had to specify the name and IP address of my institute's Firewall server as this is what the outside world sees when I access external servers from my PC.\nMétéo-France will send (by post) your username (Identificateur) and password (Mot de passe) for log in.\nThe authentication process itself remains in two steps (first “parme”, then target), as before. \nA few specific examples follow (see MF's instructions for full details):\nbeaufix:","category":"page"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"ewhelan@realin23:gcc-8.3.1:.../~> which beaufix\nalias beaufix='telnet beaufix.meteo.fr'\n\t/usr/bin/telnet\newhelan@realin23:gcc-8.3.1:.../~> beaufix \nTrying 137.129.240.110...\nConnected to beaufix.meteo.fr.\nEscape character is '^]'.\nCheck Point FireWall-1 authenticated Telnet server running on mascarpone\nUser: whelane\npassword: your_parme_password\nUser whelane authenticated by FireWall-1 authentication\n\nConnected to 137.129.240.110\nRed Hat Enterprise Linux Server release 6.9 (Santiago)\nKernel 2.6.32-696.6.3.el6.x86_64 on an x86_64\nbeaufixlogin0 login: whelane\nPassword: your_ldap_password\nLast login: Tue Oct 13 10:15:53 from gw2.met.ie\n _                           __  _       \n| |                         / _|(_)      \n| |__    ___   __ _  _   _ | |_  _ __  __\n| '_ \\  / _ \\ / _` || | | ||  _|| |\\ \\/ /\n| |_) ||  __/| (_| || |_| || |  | | >  < \n|_.__/  \\___| \\__,_| \\__,_||_|  |_|/_/\\_\\ \n\n[whelane@beaufixlogin0 ~]$ ","category":"page"},{"location":"System/MFaccess/#What-next?-**TO-BE-CONFIRMED**-1","page":"MF Access","title":"What next? TO BE CONFIRMED","text":"","category":"section"},{"location":"System/MFaccess/#Access-to-MF-servers-via-parme-1","page":"MF Access","title":"Access to MF servers via parme","text":"","category":"section"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"Once you are happy that you can access PARME from your PC you should once again contact Eric Escaliere (eric.escaliere@meteo.fr) and request login details for merou (Eric will send you a temporary password) and LDAP login details to front-id to enable access to COUGAR, YUKI, BEAUFIX and ID-FRONT\nAn automatic e-mail will be sent from expl-identites@meteo.fr with you LDAP repository password.\nfront-id requires certain criteria for your password. These are detailed in French below. When you have received LDAP login details for front-id:\newhelan@eddy:~> telnet parme.meteo.fr\nTrying 137.129.20.1...\nConnected to parme.meteo.fr.\nEscape character is '^]'.\nCheck Point FireWall-1 authenticated Telnet server running on parmesan\nUser: whelane\npassword: ********\nUser whelane authenticated by FireWall-1 authentication\nHost: front-id\n\nConnected to id-front\nRed Hat Enterprise Linux AS release 4 (Nahant Update 5)\nKernel 2.6.9-55.ELsmp on an x86_64\nlogin: whelane\nPassword: \nLast login: Mon Nov  4 05:14:22 from gw2.met.ie\nBienvenue EOIN WHELAN\nVous pouvez changer votre mot de passe\n-------------------------------------------------------------------------\n- Controle de validite sur les mots de passe avant de poster la demande -\n- Le OLD doit etre fourni. -\n- Au moins 8 car, au plus 20 car. -\n- Au moins 2 car. alpha et 2 car. non-alpha. -\n- Ne pas ressembler a UID NAME et OLD sur une syllabe de + de 2 car. -\n-------------------------------------------------------------------------\n-------------------------------------------------------------------------\nHello EOIN WHELAN\nYou may change your password\n-------------------------------------------------------------------------\n- Validity control before demand acceptation -\n- You must enter the old password first -\n- The new password must contain: -\n- At least 8 characters, 20 characters maximum -\n- At least 2 alphanumeric characters and 2 non-alphanumeric characters -\n- The passwd must contain a part of UID NAME -\n-------------------------------------------------------------------------\nChanging password for user 'whelane(56064)'.\nEnter login(LDAP) password: \nNew password: \nRe-enter new password: \nVotre mot de passe a ete change\nWhen you have received login details for merou from Eric:\newhelan@eddy:~> telnet parme.meteo.fr\nTrying 137.129.20.1...\nConnected to parme.meteo.fr.\nEscape character is '^]'.\nCheck Point FireWall-1 authenticated Telnet server running on parmesan\nUser: whelane\npassword: ********\nUser whelane authenticated by FireWall-1 authentication\nHost: merou\n\nConnected to merou\nRed Hat Enterprise Linux Server release 5.6 (Tikanga)\nKernel 2.6.18-238.el5 on an x86_64\nlogin: whelane\nPassword: \nLast login: Tue Nov  5 10:06:35 from gw2.met.ie\n[whelane@merou ~]$ passwd\nChanging password for user whelane.\nChanging password for whelane\n(current) UNIX password: \nNew UNIX password: \nRetype new UNIX password: \npasswd: all authentication tokens updated successfully.\n[whelane@merou ~]$ ","category":"page"},{"location":"System/MFaccess/#Access-to-(read-only)-MF-git-arpifs-git-repository-1","page":"MF Access","title":"Access to (read-only) MF git arpifs git repository","text":"","category":"section"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"MF use ssh keys to allow access to their read-only git repository. If approved by the HIRLAM System PL you should request access to the repository by sending a request e-mail to Eric Escaliere and cc'ed to Daniel Santos and Claude Fischer your ssh public key attached.","category":"page"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"Once you have been given access you can create a local clone by issuing the following commands:","category":"page"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"cd $HOME\nmkdir arpifs_releases\ncd arpifs_releases\ngit clone ssh://reader054@git.cnrm-game-meteo.fr/git/arpifs.git","category":"page"},{"location":"System/MFaccess/#","page":"MF Access","title":"MF Access","text":"Happy gitting!","category":"page"},{"location":"DataAssimilation/ObservationOperators/#Observation-operators-1","page":"HOP_DRIVER","title":"Observation operators","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"This documentation summarises the observation operator in HARMONIE and the use of the HOP_DRIVER tool. The test harness, HOP_DRIVER, calls the observation operator and generates FG departures without calling any model code or initialising any model modules. Firstly, the IFS is used to dump a single-observation gom_plus to file from the 1st trajectory of an experiment. Dumping multiple observations would require a more complex and full-featured dump (good file format, multi-process parallel). For code refactoring HOP_DRIVER can be used to test changes to the observation operator of a particular observation type.","category":"page"},{"location":"DataAssimilation/ObservationOperators/#HARMONIE-and-HOP_DRIVER-1","page":"HOP_DRIVER","title":"HARMONIE and HOP_DRIVER","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"The HOP_DRIVER program was first added to CY42R2 code. The tool was initially implemented to test refactoring of the IFS observation operator code src/arpifs/op_obs/hop.F90. At the moment the refactor branch (branches/refactor/harmonie) is the only HARMONIE code set that includes HOP_DRIVER. Instructions on how to prepare the code and run HOP_DRIVER using HARMONIE are outlined below.  Presentation made at [wiki:HirlamMeetings/ModelMeetings/ObOpWorkshop OOPS Observation Operator Workshop] may provide some useful background information.","category":"page"},{"location":"DataAssimilation/ObservationOperators/#Comments-on-the-branch-1","page":"HOP_DRIVER","title":"Comments on the branch","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"Code changes were required in order to compile cy42r2bf.04 + mods (provided by MF/ECMWF) in the HARMONIE system: [14312], [14325], [14326], [14330], [14331], [14332], [14333], [14334].\nChanges were made to makeup in order to compile HOP_DRIVER correctly: [14310], [14327], [14328], [14329], [14335], [14362], [14382], [14392].\nIncluded in [14362] is a change to ODBSQLFLAGS which is set to \"ODBSQLFLAGS=-O3 -C -UCANARI -DECMWF ODBEXTRAFLAGS\" in order to use ECMWF flavoured ODB used by HOP_DRIVER\nOn cca GNU compilers 4.9 are not fully supported, ie I had to build GRIB-API and NetCDF locally using gcc/gfortran 4.9 on cca\nAn environment variable, HOPDIR, is used to define the location of necessary input data for HOP_DRIVER\nAn environment variable, HOPCOMPILER, is used by the HOP_driver script to define the compiler used. This is used to compare results.","category":"page"},{"location":"DataAssimilation/ObservationOperators/#Running-on-ecgb/cca-1","page":"HOP_DRIVER","title":"Running on ecgb/cca","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"cd $SCRATCH\nmkdir -p harmonie_releases/branches/refactor\ncd harmonie_releases/branches/refactor\nsvn co https://svn.hirlam.org/branches/refactor/harmonie-42R2\ncd $HOME\nmkdir -p hm_home/rfexp\ncd hm_home/rfexp\n$SCRATCH/harmonie_releases/branches/refactor/harmonie-42R2/config-sh/Harmonie setup -r $SCRATCH/harmonie_releases/branches/refactor/harmonie-42R2\n$SCRATCH/harmonie_releases/branches/refactor/harmonie-42R2/config-sh/Harmonie hop_driver","category":"page"},{"location":"DataAssimilation/ObservationOperators/#Running-on-local-platforms-1","page":"HOP_DRIVER","title":"Running on local platforms","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"So far, only METIE.LinuxRH7gnu, which uses gfortran 4.9 and openmpi, has been tested. Input data for the amsua test case is available on ECFS at ECMWF: ec:/dui/hopdata.tar.gz","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"cd $HOME\nmkdir -p harmonie_releases/branches/refactor\ncd harmonie_releases/branches/refactor\nsvn co https://svn.hirlam.org/branches/refactor/harmonie-42R2\ncd $HOME\nmkdir -p hm_home/rfexp\ncd hm_home/rfexp\n$HOME/harmonie_releases/branches/refactor/harmonie-42R2/config-sh/Harmonie setup -h METIE.LinuxRH7gnu -r $HOME/harmonie_releases/branches/refactor/harmonie-42R2\n$HOME/harmonie_releases/branches/refactor/harmonie-42R2/config-sh/Harmonie hop_driver","category":"page"},{"location":"DataAssimilation/ObservationOperators/#HOPOBS:-amsua-1","page":"HOP_DRIVER","title":"HOPOBS: amsua","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"Currently there is only one observation type, AMSU-A (HOPOBS=amsua), available for testing with HOP_DRIVER. Alan Geer (ECMWF) has already carried out the refactoring of the HOP code related to AMSU-A observations. A single observation is provided in the ECMA and is used to test the refactoring of the HOP code. To carry out the testing of the amsua refactoring HOPOBS should be set to amsua in ecf/config_exp.h.","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"reportype@hdr obstype@hdr sensor@hdr statid@hdr stalt@hdr date@hdr time@hdr degrees(lat) degrees(lon) report_status@hdr datum_status@body obsvalue@body varno@body vertco_type@body\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 12 173.28 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 12 158.86 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 3 227.40 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 3 260.82 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 256.90 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 239.60 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 12 NULL 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 3 217.69 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 209.39 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 214.05 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 223.02 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 234.42 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 245.14 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 1 257.18 119 3\n1007 7 3 '        4' 832800 !20140131 215914 -29.5906 0.3113 1 12 227.91 119 3","category":"page"},{"location":"DataAssimilation/ObservationOperators/#HOP_DRIVER-1","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#Using-HOP_DRIVER-1","page":"HOP_DRIVER","title":"Using HOP_DRIVER","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"With LHOP_RESULTS=.TRUE. HOP_DRIVER will write results to a file called hop_results${MYPROC} for comparison between online and offline results. (The results file is opened by src/arpifs/var/taskob.F90. HOP_DRIVER results are written to hop_results${MYPROC} in src/arpifs/op_obs/hop.F90:","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":" :\n :\nIF(LHOP_RESULTS) THEN\n!$OMP CRITICAL\n  ! Output for comparison between online and offline results:\n  WRITE(CFILENAME,'(\"hop_results\",I4.4)') MYPROC\n  OPEN(NEWUNIT=IU,FILE=CFILENAME,POSITION='APPEND',ACTION='WRITE',FORM='FORMATTED')\n  DO JOBS = 1,KDLEN\n    DO JBODY=1,IMXBDY\n      IF (JBODY>ICMBDY(JOBS)) CYCLE\n      IBODY = ROBODY%MLNKH2B(JOBS)+(JBODY-1)\n      WRITE(IU,'(6I8,2F30.14)') MYPROC, KSET, JOBS, NINT(ROBHDR%DATA(JOBS,ROBHDR%SEQNO_AT_HDR)),&\n        & NINT(ROBODY%DATA(IBODY,ROBODY%VERTCO_REFERENCE_1_AT_BODY)), &\n        & NINT(ROBODY%DATA(IBODY,ROBODY%VARNO_AT_BODY)), ZHOFX(JOBS,JBODY), ZXPPB(JOBS,JBODY)\n\n    ENDDO\n  ENDDO\n  CLOSE(IU)\n!$OMP END CRITICAL\nENDIF\n :\n :","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"The HOPdriver script (based a script provided by MF) sorts the contents of the `hopresults0001` file for comparison with some results made available by ECMWF/MF:","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":" :\n :\n#\n# Check HOP_DRIVER results (available for gfotran and intel)\n#\nln -s $HOPDIR/${HOPOBS}/results.$HOPCOMPILER .\ncat hop_results* | sort -k1,1n -k2,2n -k3,3n -k5,5n -k6,6n > results.driver\necho\ncmp -s results.$HOPCOMPILER results.driver\nif [ $? -eq 0] ; then\n  echo \"RESULTS ARE STRICTLY IDENTICAL TO THE REFERENCE FOR HOPCOMPILER=$HOPCOMPILER :-)\"\nelse\n  echo Compare exactly against the results dumped from hop:\n  echo \"xxdiff results.$HOPCOMPILER results.driver &\"\n  diff results.$HOPCOMPILER results.driver\n  exit 1\nfi\n :\n :","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"On cca you will find useful output from HOPDRIVER in cca:TEMP/hmhome/rfexp/archive/HOPDRIVEROUT:","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"fort.4\nNODE.001_01\nhop_results0001\nresults.gfortran\nresults.driver","category":"page"},{"location":"DataAssimilation/ObservationOperators/#The-code-1","page":"HOP_DRIVER","title":"The code","text":"","category":"section"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"HOP_DRIVER is a short program written by Deborah Salmond (ECMWF) to test code changes made to the observation operator. The program src/arpifs/programs/hop_driver.F90 is summarised here.","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"The program sets up the model geometry and observations:","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":" :\n :\nCALL GEOMETRY_SET(YRGEOMETRY)\nCALL MODEL_SET(YRMODEL)\n\nCALL IFS_INIT('gc7a')\n\nCALL SUINTDYN\n\nCALL SUGEOMETRY(YRGEOMETRY)        !From GEOMETRY_SETUP\n\nCALL SURIP(YRGEOMETRY%YRDIM)             !From MODEL_CREATE\n\n! Set up Observations, Sets\nCALL SUDIMO(YRGEOMETRY,NULOUT)     !From SU0YOMB\nCALL SUOAF              !From SU0YOMB\nCALL SUALOBS            !From SU0YOMB\nCALL SURINC             !From SU0YOMB\nCALL SETUP_TESTVAR      !From SU0YOMB\nCALL SUOBS(YRGEOMETRY)              !From CNT1\nCALL ECSET(-1,NOBTOT,0) !From OBSV\nCALL SUPHEC(YRGEOMETRY,NULOUT)\n\n! Setup varbc (from cnt1.F90) and read VARBC.cycle\nCALL YVARBC%SETUP_TRAJ\n :\n :","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":"HOP_DRIVER then loops over the number of observation sets (NSETOT) and reads a GOM PLUS for each observation set. HRETR and HOP are then called:","category":"page"},{"location":"DataAssimilation/ObservationOperators/#","page":"HOP_DRIVER","title":"HOP_DRIVER","text":" :\n :\nDO ISET=1,NSETOT\n  IDLEN   = MLNSET(ISET)\n  IMXBDY = MAX(MMXBDY(ISET),1)\n\n  ALLOCATE(ZHOFX(IDLEN,IMXBDY))\n  ZHOFX=RMDI\n\n  ! READ GOM_PLUS FROM DUMP\n  CALL GOM_PLUS_READ_DUMP(YGP5,ISET)\n\n  IF(IDLEN /= YGP5%NDLEN) THEN\n    CALL ABOR1('Sets are incompatible')\n  ENDIF\n\n  :\n  :\n  :\n\n  CALL HRETR(YRGEOMETRY%YRDIMV,IDLEN,IMXBDY,ISET,1,YGP5,YVARBC)\n\n  CALL HOP(YRGEOMETRY%YRDIMV,YGP5,YVARBC,IDLEN,IMXBDY,ISET,1,LDOOPS=.TRUE.,PHOFX=ZHOFX)\n\n  !write(0,*)'ZHOFX',ZHOFX\n  DEALLOCATE(ZHOFX)\n\n  CALL GOM_PLUS_DESTROY(YGP5)\n\nENDDO\n\n :\n :","category":"page"},{"location":"QuickStart/ECMWF/TheHarmonieScript/#The-Harmonie-Script-1","page":"The Harmonie Script","title":"The Harmonie Script","text":"","category":"section"},{"location":"DataAssimilation/DFS/#DFS-1","page":"DFS","title":"DFS","text":"","category":"section"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"The DFS calculation software is still in under development. It is however possible to run the software already now even though it is not fully automated. Start by downloading the tar-file dfscalc.tar","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"The following instructions is also available in the README file.","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"To run the DFS calculations and plot the results do the following","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"Edit the include.paths script to set dates and paths to your experiment and dfs directory\nRun prep_dfs in batch mode. This script generates two sets of ccma files, one with perturbed observations and one original unperturbed. \nBefore running the minimisation for the disturbed observations the namelist of your experiment must be copied to a file called \"namelminim\" in the dfs script dir. In one of your HMDate-files search for \"Start of log: fort.4\" and copy everything between the hash lines \"#############################\" into namel_minim.\nRun RunMinim in batch mode. This will generate new an-fg statistics for the perturbed observations.\nBefore running extract you need to create a compiled MANDALAY. This is easiest done by doing the following:","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"Set up a new experiment Check out src/obd/ddl/mandalay.sql Replace this file by the mandalay.sql in dfs_scr (included in this tar-file) Start your experiment and let it run until the compilation is complete Copy the created MANDALAY to dfs_scr/bin (or point to it in extract_dfs)","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"It is also necessary to compile dfscomp.F90 and dfstot.F90 e.g:","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"gfortran -o bin/dfscomp.x dfscomp.F90\ngfortran -o bin/dfstot.x dfstot.F90","category":"page"},{"location":"DataAssimilation/DFS/#","page":"DFS","title":"DFS","text":"Now run extract_dfs in batch mode. This generates the file $STARTDIR/OUTPUT/dsf.tot (STARTDIR in specified in include.paths) that contains the DFS statistics for the period. This can be plotted e.g. with the included R-script.\nPlot the resuts with dfs_plot.R. Place dfs.tot and dfs_plot.R in the same directory and type: Rscript dfs_plot.R This generates the file dfs_tot.eps in the same directory.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#Configure-for-faster-setup-on-cca-1","page":"Fast start on cca","title":"Configure for faster setup on cca","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#Background-1","page":"Fast start on cca","title":"Background","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"Since ECMWF switched from the IBM based c2a to the new Cray XC30 cca setting up and start a new HARMONIE experiment has been a very slow process. With the current settings it may take several hours from the moment you say Harmonie start until the code is fully compiled and the real run starts. In the following we describe how to configure your experiment to get started in about half an hour.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#What's-special-with-cca?-1","page":"Fast start on cca","title":"What's special with cca?","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The main cause for the slow synchronization and compilation time on cca is the Lustre file system. Such a file system is optimized for large files but is less efficient for large numbers of small files. As a comparison it takes ~2 minutes to copy the full harmonie system from ecgb:$HOME to $PERM whereas it takes about 1 hour or more to make the same copy to cca:$SCRATCH. It's not the transfer to cca that takes time but the IO on the $SCRATCH file system.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#How-to-set-it-all-up-1","page":"Fast start on cca","title":"How to set it all up","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The changes required can be viewed in [13814] and in below we go through what you have to do as a user. At the bottom of the page you'll find the versions adapted so far.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#Using-the-:PERM-disk-1","page":"Fast start on cca","title":"Using the PERM disk","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"Normally HARMONIE is setup to use $SCRATCH as the main disk for both ecgb and cca. Two changes are required in Env_system to use the $PERM disk on cca.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"Set HM_LIB=/hpc$PERM/build_harmonie/$EXP/lib for the ecgb part of Env_system\nSet HM_LIB=$PERM/build_harmonie/$EXP/lib for the cca part of Env_system","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"This means that ecgb:$HM_LIB == cca:$HM_LIB so the synchronization between ecgb and cca is for free. Your working directories and results will still be found under $SCRATCH/hm_home/$EXP.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#Compiling-with-gmkpack-1","page":"Fast start on cca","title":"Compiling with gmkpack","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"Harmonie comes with two way of compiling the code, Makeup and Gmkpack. Both methods have their benefits but in this particular case Gmkpack gives us the fastest throughput for two reasons.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"We only compile the source you have changed for the rest we reuse the already built libraries. This is partly true for Makeup as well but in the search for what to actually compile takes longer time.\nLess disk space and number of inodes is required compared to Makeup. We only copy the code to be compiled.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The above mentioned is only true if you make small changes for larger number of changes that requires recompilation of big parts of the code it may not necessary be true any longer. To compile with gmkpack set","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"MAKEUP=no in Env_system\nMake sure BUILD_ROOTPACK=no in ecf/config_exp.h. The already compiled libraries are listed below. If you have to compile the full code Makeup is faster.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The reproducibility between compilation with Makeup and gmkpack has not been checked yet although great care has been taken to use the same compilation options. To avoid unpleasant surprises you are not recommended to change compilation method between to experiments that you expect to compare.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#Things-to-keep-an-eye-on-1","page":"Fast start on cca","title":"Things to keep an eye on","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The disk space on cca:$PERM is limited not only for the disk space in GB but also for the number of files, the inodes. A typical experiment takes 2.5GB and uses 10000 inodes. Thus the number of experiments you can setup this ways is limited. To check your quota on cca:$PERM type","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"quota -v","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"on cca.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#What-about-existing-experiments?-1","page":"Fast start on cca","title":"What about existing experiments?","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"There is not a great need to change your setup if you have a running experiment. The costly part is the initial setup and compilation. If you still feel you would like to do it you are advised to remove everything from cca:$SCRATCH/hm_home/$EXP and ecgb:$SCRATCH/hm_home/$EXP after you have checked that the necessary restart files are available on ecfs. The other alternative is to start a new experiment with the same changes and make sure you start with initial conditions from your old experiment.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#Updated-HARMONIE-configurations-1","page":"Fast start on cca","title":"Updated HARMONIE configurations","text":"","category":"section"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"The changes will progressively be implemented in the used configurations as listed below. If you miss any configuration please contact us. Note that the default settings will not be changed for the tagged versions. Note that for the trunk or for branches a new ROOTPACK is required for every update in the src directory and that the new ROOTPACK may not always be available.","category":"page"},{"location":"QuickStart/Fast_start_on_cca/#","page":"Fast start on cca","title":"Fast start on cca","text":"\n  harmonie-38h1\n\n   tags:\n\n   ~hlam/harmonie_release/tags/harmonie-38h1.1 ROOTPACK=/project/hirlam/harmonie/pack/38h1_main.01.gnu.x\n   ~hlam/harmonie_release/tags/harmonie-38h1.2 ROOTPACK=/project/hirlam/harmonie/pack/38h1_main.02.gnu.x\n\n   branches:\n\n   ~hlam/harmonie_release/branches/harmonie-38h1 ROOTPACK=/scratch/ms/spsehlam/hlam/common_rootpack/38h1_branch_harmonie_38h1_13749.01.gnu.x\n   ~hlam/harmonie_release/branches/harmonEPS-38h1.1 ROOTPACK=/project/harmonie/pack/38h1_harmonEPS_13706.01.gnu.x\n                                                    ROOTPACK=/project/harmonie/pack/38h1_harmonEPS_13827.01.gnu.x\n\n  harmonie-40h1\n\n   tags:\n   ~hlam/harmonie_release/tags/harmonie-40h1.1.beta.1 ROOTPACK=/project/hirlam/harmonie/pack/40h1_beta_1.01.gnu.x\n\n   branches:\n\n   ~hlam/harmonie_release/trunk ROOTPACK=/scratch/ms/spsehlam/hlam/common_rootpack/40h1_trunk_NNNNN.01.gnu.x\n\n","category":"page"},{"location":"QuickStart/TheHarmonieScript/#The-Harmonie-main-script-1","page":"The Harmonie script","title":"The Harmonie main script","text":"","category":"section"},{"location":"QuickStart/TheHarmonieScript/#","page":"The Harmonie script","title":"The Harmonie script","text":"The Harmonie script is the main user interface to the harmonie system. It is used to setup, start, check and control your experiment and environment. Below follows the most useful commands. There are other commands inherited from the HIRLAM environment that may or may not work. For a full list check scr/Start, scr/Actions, scr/Actions.pl.","category":"page"},{"location":"QuickStart/TheHarmonieScript/#","page":"The Harmonie script","title":"The Harmonie script","text":"Harmonie setup [ -r REVISION] [ -h HOST] [ -d DOMAIN] [ -c CONFIGURATION] [ -l LEVELS] where:\nREVISION is the path to the version of harmonie you are working with.\nHOST is the name of the host you are working on. There should exist corresponding config-sh/config.HOST. \nCONFIGURATION is one of the predefined configurations in scr/Harmonie_testbed.pl. It a fast way to setup your favourite configuration.\nDOMAIN is one of the predefined domains in ecf/config_exp.h \nLEVELS is one of the predefined level definitions in scr/Vertical_levels.pl\nHarmonie start DTG=YYYYMMDDHH [ DTGEND=YYYYMMDDHH] [ optional environment variables] launches a cold start run.\nDTG is the initial time of your experiment\nSeveral other optional variables can be given like\nPLAYFILE=FILENAME use a different ecflow suite definition file. Default is harmonie.tdf\nBUILD=yes|no to turn on and off compilation\nCREATE_CLIMATE=yes|no to turn on and off generation of climate files\nAny environment variable that you would like to send to the system.\nHarmonie prod will continue from the DTG given in your progress.log file. The rest of the arguments is as for Harmonie start. This should be used to continue and experiment. It is assumed that a first guess file is available and the run will fail if this is not found.    \nHarmonie mon will restart your ecflow_ui window and try to connect to an existing ecflow server.\nHarmonie co [FILE|PATH/FILE] will copy the request file from the version chosen in your setup ( as pointed out in the config-sh/hm_rev file ) to your local directory. If the PATH is not given a search will be done. If the name matches several files you will be given a list to choose from.\nHarmonie install will build your libraries and binaries but not start any experiment\nHarmonie testbed will launch the Harmonie testbed\nHarmonie diff [--xxdiff] will look for differences between the revision in config-sh/hm_rev and HM_LIB.\nHarmonie CleanUp -ALL -go will clean the following directories: HM_DATA, HM_LIB, HM_EXP. Instructions from src/Actions.pl:","category":"page"},{"location":"QuickStart/TheHarmonieScript/#","page":"The Harmonie script","title":"The Harmonie script","text":"# args: if -go: remove, (default is to list but not remove the matching files)\n#       if -k*: do not do the long term archive HM_EXP - so keep it\n#       if -d*: combination of -k and -ALL (-d* means: disks)\n#       if -ALL: treat all files and also (if -go) remove the directories\n#       a pattern is usually a string without meta-characters. To this\n#       a * is appended (so e.g. ob will affect all files ob*); this can\n#       be inhibited by appending ~ (so ob~! translates to ob).\n#       Also, files in all subdirectories P*_* will be affected\n#       where P is the pattern [0-9][0-9], This resembles\n#       a `CYCLEDIR'. So ob will result in 'ob* P*_*/ob*'.\n#       The pattern P*_* will be prepended to every / in the pattern,\n#       unless the / is preceded by ~ (which will be removed).\n#       Hence, to remove e.g. all analyses from 1995, use 1995/an,\n#       which translates to 1995[0-9][0-9]*_*/an*\n#       (to be precise: use: CleanUp(\"REMOVE:1995/an\", \"-go\");","category":"page"},{"location":"#Harmonie-System-Documentation-1","page":"Home","title":"Harmonie System Documentation","text":"","category":"section"},{"location":"#","page":"Home","title":"Home","text":"This is a draft version of the Harmonie System Documentation. Not all pages have been converted from trac/wiki to markdown yet. Suggestions for improvements are very welcome. ","category":"page"},{"location":"#","page":"Home","title":"Home","text":"We are optimistic that our Harmonie documentation will be nominated for the Nobel Prize in Literature in 2022 but winning requires a bit more work. ","category":"page"},{"location":"#","page":"Home","title":"Home","text":"If you spot small typos that don't require review, click the \"Edit on Github\" button at the top right of the page. You can then edit the markdown file on github.com and commit directly to the pre-CY46h1 branch.\nFor larger edits that could benefit from review or to add new pages it is recommend to use the fork-and-branch workflow. ","category":"page"},{"location":"#How-to-add-a-new-page-1","page":"Home","title":"How to add a new page","text":"","category":"section"},{"location":"#","page":"Home","title":"Home","text":"If you want to add a new page to the documentation:","category":"page"},{"location":"#","page":"Home","title":"Home","text":"Clone your fork and create a new branch from the pre-CY46h1 branch\nPut the markdown file in one of the subdirectories in docs/src/ (or create a new subdirectory). \nDecide where in the navigation bar your page should appear and edit docs/pages.jl accordingly. \ncd docs and run \njulia --project make.jl\nThis will check that, e.g. url's are valid and ensures that when we merge the pull request our github action won't fail. Note that the pages won't be deployed to the HarmonieSystemDocumentation repository when running locally. Julia can be downloaded here. The first time run cd docs\njulia --project -e 'using Pkg; Pkg.instantiate()'\nto install the Documenter dependency. \nThe html files will be put in docs/build/. Open docs/build/index.html and check everything looks fine. \nCommit your changes and push them to your fork on github\nCreate a pull request using the pre-CY46h1 branch as merge base and add Roel Stappers (and/or others) as a reviewer.\nWait for the email from the Nobel committee","category":"page"},{"location":"QuickStart/ECMWF/ECMWF_teleport/#Teleport-1","page":"Teleport","title":"Teleport","text":"","category":"section"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"EditURL=\"https://hirlam.org/trac//wiki//Screening?action=edit\"","category":"page"},{"location":"DataAssimilation/Screening/#Screening-1","page":"Screening","title":"Screening","text":"","category":"section"},{"location":"DataAssimilation/Screening/#Introduction-1","page":"Screening","title":"Introduction","text":"","category":"section"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"Screening (configuration 002 of ARPEGE/IFS model) carries out quality control of observations. ","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"A useful presentation (Martin Ridal) from the \"Hirlam-B Training Week on HARMONIE system\" training course is available here: MR_screenandminim.pdf. Most of the information on this page is based on his presentation.","category":"page"},{"location":"DataAssimilation/Screening/#Inputs-1","page":"Screening","title":"Inputs","text":"","category":"section"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"First guess (the same file with 5  different names):\nICMSHMIN1INIT\nICMSHMIN1IMIN\nICMRFMIN10000\nELSCFMIN1ALBC000\nELSCFMIN1ALBC\nInput/output ODB directory structure\n${d_DB}/ECMA\n${d_DB}/ECMA.${base1}\nConstants and statistics (MAY NEED TO BE UPDATED)\ncorrel.dat\nsigmab.dat\nrszcoef_fmt\nerrgrib\nrt_coef_atovs_newpred_ieee.dat\nbcor_noaa.dat\nchanspec_noaa.dat\nrmtberr_noaa.dat\ncstlim_noaa.dat\nNamelist: See %screening in nam/harmonie_namelists.pm","category":"page"},{"location":"DataAssimilation/Screening/#Screening-tasks-1","page":"Screening","title":"Screening tasks","text":"","category":"section"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"(Based on Martin Ridal's presentation).","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"Preliminary check of observations\nCheck of completeness of the reports\nCheck if station altitude is present\nCheck of the reporting practice for SYNOP & TEMP mass observations \nBlacklisting: A blacklist is applied to discard observations of known poor quality and/or that cannot be properly handled by the data assimilation. A selection of variables for assimilation is done using the data selection part of the blacklist file and the information hard-coded in Arpege/Aladin (orographic rejection limit, land-sea rejection...). Decisions based on the blacklist are feedback to the CMA. Blacklisting is defined in src/bla/mf_blacklist.b \nBackground quality control: flags are assigned to observations – 1 =>  probably correct, 2 => probably incorrect, 3 => incorrect.\nVertical consistency of multilevel report:\nThe duplicated levels, in multi-level reports, are removed from the reports\nIf 4 consecutive layers are found to be of suspicious quality then these layers are rejected\nRemoval of duplicated reports\nIn case of co-located airep reports of the same observation types (time, position), some or all of the content of one of the reports is rejected\nRedundancy check\nperformed for active reports that are co-located and originate from the same station\nLAND SYNOP: the report closest to the centre of the screening time window with most active data is retained\nSHIP SYNOP: redundant if the moving platforms are within a circle of 1^o^ radius src/arpifs/obs_preproc/sufglim.F90 RSHIDIS = 111000._JPRB\nTEMP and PILOT: same stations are considered at the same time in the redundancy check\nA SYNOP mass observation is redundant if there are any TEMP geopotential height observations (made in the same time and the same station) that are no more than 50hPa above the SYNOP mass observation\nThinning: High resolution data needs to be reduced to reduce correlated errors and reduce the amount of data","category":"page"},{"location":"DataAssimilation/Screening/#Output-1","page":"Screening","title":"Output","text":"","category":"section"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"The quality control information will be put into the input ECMA ODB(s) and a newly created CCMA to used by the 3DVAR minimization.","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"A valuable summary about screening decisions can be found in HM_Date_YYYYMMDDHH.html:","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"Look for “SCREENING STATISTICS” to get:\nSTATUS summary\nEVENT summary\nNumber of variables, departures and missing departures\nDiagnostic JO-table\nCCMA ODB and updated ECMA ODB","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":"Screening Events listed under \"EVENT SUMMARY OF REPORTS:\"","category":"page"},{"location":"DataAssimilation/Screening/#","page":"Screening","title":"Screening","text":" Description\n1 NO DATA IN THE REPORT\n2 ALL DATA REJECTED\n3 BAD REPORTING PRACTICE\n4 REJECTED DUE TO RDB FLAG\n5 ACTIVATED DUE TO RDB FLAG\n6 ACTIVATED BY WHITELIST\n7 HORIZONTAL POSITION OUT OF RANGE\n8 VERTICAL POSITION OUT OF RANGE\n9 TIME OUT OF RANGE\n10 REDUNDANT REPORT\n11 REPORT OVER LAND\n12 REPORT OVER SEA\n13 MISSING STATION ALTITUDE\n14 MODEL SUR. TOO FAR FROM STAT. ALT.\n15 REPORT REJECTED THROUGH THE NAMELIST\n16 FAILED QUALITY CONTROL","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#HARMONIE-Vertical-Model-Level-Definitions-1","page":"Vertical Grid","title":"HARMONIE Vertical Model Level Definitions","text":"","category":"section"},{"location":"ExperimentConfiguration/VerticalGrid/#HARMONIE-vertical-coordinate-1","page":"Vertical Grid","title":"HARMONIE vertical coordinate","text":"","category":"section"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"HARMONIE model, similar to that of HIRLAM, is constructed for a general pressure based and terrain following vertical coordinate eta(pp_s), where","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"eta(0P_s) = 0","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"and ","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"eta(p_sp_s) = 1","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"The formulation corresponds to the ECMWF hybrid system. The model is formulated for a spherical coordinate system (lambda, theta), but in the code two metric coefficients (h_xh_y) have been introduced. This is done to prepare the model for any orthogonal coordinate system or map projection with axes (x,y). ","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"To represent the vertical variation of the dependent variables (U, V, T and Q), the atmosphere is divided into \"nlev\" layers. These layers are defined by the pressures at the interfaces between them (the `half-levels'). From the general expression","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"p_k+12 = A_k+12 (n) + B_k+12(n) * p_s(xy)","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"for  k=01nlev","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"the vertical surfaces for half-levels are defined. Pure pressure surfaces are obtained for B=0 and pure sigma surfaces for A=0. `full-level' pressure associated with each model level (middle of two half layers) is then determined accordingly.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#Definition-of-model-levels-in-HARMONIE-1","page":"Vertical Grid","title":"Definition of model levels in HARMONIE","text":"","category":"section"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"The script src/Vertical_levels.pl contains definition of vertical levels that have been used in the HIRLAM community for research and/or operational purposes. Currently the default model setup defines 65-level structure as derived by Per Unden, SMHI. Model level definitions for commonly used vertical structures in HARMONIE are listed below.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"FourtyLevel: HIRLAM_40 model levels (same as Hirlam 6.2.1, Nov 2003 - HIRLAM 7.0, 2006 )\nSixtyLevel: HIRLAM-60 model levels (same as Hirlam 7.1, March 2007 - 2012 )\n[wiki:MFSixtyLevel MF_60]: MF-60 model levels (same as Meteo France AROME since 2010 )\nSixtyfiveLevel: 65 model levels (same as Hirlam 7.4, March 2012 - )\nother levels: Prague87, MF70, 40 (ALADIN-40), ECMWF_60.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"Note that VLEV is the name of the set of A/B coefficients defining your levels set in ecf/config_exp.h. There are e.g. more than one definition for 60 levels. To print the levels just run  scr/Vertical_levels.pl","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"Usage: scr/Vertical_levels.pl [VLEV PRINT_OPTION] where:","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"VLEV: name of your level definition\nPRINT_OPTION=AHALF: print A coefficients for VLEV\nPRINT_OPTION=BHALF: print B coefficients for VLEV\nPRINT_OPTION=NLEV: print number of levels for VLEV\nPRINT_OPTION=NRFP3S: print NRFP3S namelist values for VLEV","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"For reference, we provide links detailing structure of the ECMWF 62 level (ensemble and seasonal forecast),  91 level (deterministic forecast) and the 137-level deterministic forecast (starting June 25 2013, 38r2)]","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"When performing HARMONIE experiment, users can select vertical levels by changing VLEV in ecf/config_exp.h. If a non-standard level number is to be chosen, the script scr/Vertical_levels.pl needs to be edited to add layer definition.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#Define-new-eta-levels-1","page":"Vertical Grid","title":"Define new eta levels","text":"","category":"section"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"A brief description and some code on how to create new eta levels can be found in New_eta.tar.gz on hirlam.org.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"There is also an interactive tool that can help you in creating a new set of levels.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"The method is based on a program by Pierre Bénard, Meteo France, that is described in this gmapdoc article.","category":"page"},{"location":"ExperimentConfiguration/VerticalGrid/#Relevant-corresponding-data-set-for-different-vertical-structure-1","page":"Vertical Grid","title":"Relevant corresponding data set for different vertical structure","text":"","category":"section"},{"location":"ExperimentConfiguration/VerticalGrid/#","page":"Vertical Grid","title":"Vertical Grid","text":"HARMONIE 3D-VAR and 4DVAR upper air data assimilation needs background error structure function for each given vertical layer structure. It is noted that the structure function data included in the reference HARMONIE repository const/jb_data is only useful for reference configuration. Users that runs 3DVAR/4DVAR are strongly recommended to derive proper structure function data following instructions in the Harmonie wiki using own data archive to avoid improper use of structure function.","category":"page"},{"location":"Overview/Binaries/#HARMONIE-binaries-1","page":"Binaries","title":"HARMONIE binaries","text":"","category":"section"},{"location":"Overview/Binaries/#","page":"Binaries","title":"Binaries","text":"An installation of HARMONIE produces the following binaries:","category":"page"},{"location":"Overview/Binaries/#","page":"Binaries","title":"Binaries","text":"ACADFA1D : Tool to generate initial and boundary data for MUSC\nADDPERT : Create initial perturbations\nADDSURF : Allows you to mix different files and add different fields\nALTO : Also known as PINUTS. Contains several diagnostic tools.\nBATOR : Generate ODB from observations in various formats\nbl95.x : Blacklist compiler, help program to generate object files from the blacklist\nBLEND : Mixes to files\nBLENDSUR : Mixes to files\ncluster : Cluster ensemble members\nCONVERT_ECOCLIMAP_PARAM : Generate binary files from ECOCLIMAP ascii files\ndcagen : ODB handling tool\ndomain_prop : Helper program to return various model domain properties\nFESTAT : Background error covariance calculations.\nfldextr : Extracts data for verification from model history files. Reads FA from HARMONIE and GRIB from ECMWF/HIRLAM.\ngl : Converts/interpolates between different file formats and projections. Used for boundary interpolation.\nIOASSIGN/ioassign : ODB IO setup\nLSMIX : Scale dependent mixing of two model states.\njbconv : Interpolates/extrapolates background error statistics files. For technical experimentation\nlfitools : FA/LFI file manipulation tool\nMASTERODB : The main binary for the forecast model, surface assimilation, climate generation, 3DVAR, fullpos and much more.\nMTEN : Computation of moist tendencies\nobsextr : Extract data for verification from BUFR files. \nobsmon : Extract data for observation monitoring\nodb98.x : ODB manipulation program\nOFFLINE : The SURFEX offline model. Also called SURFEX\noulan : Converts observations in BUFR to OBSOUL format used by BATOR\nPERTCMA : Perturbation of observations in ODB\nPERTSFC : Surface perturbation scheme\nPGD : Generates physiography files for SURFEX.\nPREGPSSOL : Processing of GNSS data\nPREP : Generate SURFEX initial files. Interpolates/translates between two SURFEX domains.\nSFXTOOLS : Converts SURFEX output between FA and LFI format.\nshuffle : Manipulation of ODB. Also called ODBTOOLS\nShuffleBufr : Split bufr data according to observation type, used in the observation preprocessing.\nSODA : Surfex offline data assimilation\nSPG : Stochastic pattern generator, https://github.com/gayfulin/SPG\nSURFEX : The SURFEX offline model. Also called OFFLINE\ntot_energy : Calculates the total energy of a model state. Is used for boundary perturbation scaling.\nxtool : Compares two FA/LFI/GRIB files.","category":"page"},{"location":"SuiteManagement/ECFLOW/#Running-Harmonie-under-ecFlow-1","page":"ECFLOW","title":"Running Harmonie under ecFlow","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#Introduction-1","page":"ECFLOW","title":"Introduction","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"This document describes how to run Harmonie under ecFlow scheduler at ECMWF. ecFlow is the ECMWF workflow manager and it has been written using python to improve maintainability, allow easier modification and introduce object orientated features as compared to the old scheduler SMS. ecFlow can be used in any HARMONIE version in and above harmonie-40h1.1.beta.1.","category":"page"},{"location":"SuiteManagement/ECFLOW/#Start-your-experiment-supervised-by-ecFlow-1","page":"ECFLOW","title":"Start your experiment supervised by ecFlow","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Launch the experiment in the usual manner by giving start time, DTG, end time, DTGEND and other optional arguments","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"      ~hlam/Harmonie start DTG=YYYYMMDDHH","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"If successful, ecFlow will identify your experiment name and start building your binaries and run your forecast. If not, you need to examine the ecFlow log file $HM_DATA/ECF.log. $HM_DATA is defined in your Env_system file. At ECMWF $HM_DATA=$SCRATCH/hm_home/$EXP where $EXP is your experiment name.","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"The ecflow viewer stars automatically. To view any suite for your server or other servers, the server must be added to ecflowview Edit/Preferences/Servers and selected in Servers. See below on how to find the port and server name.","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"More than one experiment is not allowed with the same name monitored in the same server so Harmonie will start the server and delete previous non-active suite for you.\nFor deleting a suite manually using ecflow_client --port XXXX --host XXXX --delete force yes /suite or using the GUI Collector node+CTRL+click1 selecting ###ecflow_client --delete force yes <full_name>\nIf other manual intervention in server or client is needed you can use ecflow commands. See here.","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"At ECMWF there are two server options ECF_HOST=ecgate or ECF_HOST=ecgb-vecf where the latter available since release-43h2.beta.5. Set ECF_HOST in Env_system to choose between the servers.","category":"page"},{"location":"SuiteManagement/ECFLOW/#ecFlow-control-1","page":"ECFLOW","title":"ecFlow control","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#Finding-the-port-and-host-of-the-ecFlow-server-1","page":"ECFLOW","title":"Finding the port and host of the ecFlow server","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Information about server variables can be found by running","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"      ecflow_server status ","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"At ECMWF you can also find ECF_PORT/ECF_HOST by checking the files under /hpc/perm/ms/$GROUP/$USER/HARMONIE, like ","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"hlam@ecgb11:~/hm_home/43_aug> ls -rlt /hpc/perm/ms/spsehlam/hlam/HARMONIE/*.ecf.*\n-rw-r-----. 1 hlam hirald     10443 Aug  8 13:11 /hpc/perm/ms/spsehlam/hlam/HARMONIE/ecgb-vecf.4531.ecf.log\n-rw-r-----. 1 hlam hirald      8804 Aug  8 13:12 /hpc/perm/ms/spsehlam/hlam/HARMONIE/ecgate.4531.ecf.log","category":"page"},{"location":"SuiteManagement/ECFLOW/#Check-the-status-of-your-server-1","page":"ECFLOW","title":"Check the status of your server","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"To check the status of your server you can use","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"ecflow_client --stats  --port ECF_POST  --host ECF_HOST","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"or","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"ecflow_client --port ECF_PORT  --host ECF_HOST  --ping","category":"page"},{"location":"SuiteManagement/ECFLOW/#Open-the-viewer-of-a-running-ecFlow-server-1","page":"ECFLOW","title":"Open the viewer of a running ecFlow server","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"If you know that your ecFlow server is running but you have no viewer attached to it you can restart the viewer:","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"ecflow_ui &","category":"page"},{"location":"SuiteManagement/ECFLOW/#Stop-your-ecFlow-server-1","page":"ECFLOW","title":"Stop your ecFlow server","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"If you are sure you're running the server on the login node of your machine you can simply run","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"ecflow_stop.sh","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"A more complete and robust way is","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"export ECF_PORT=<your port>\nexport ECF_HOST=<your server name>\necflow_client  --halt=yes\necflow_client  --check_pt\necflow_client  --terminate=yes","category":"page"},{"location":"SuiteManagement/ECFLOW/#Restart-your-ecFlow-server-1","page":"ECFLOW","title":"Restart your ecFlow server","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"If the server is not running you can start again using the script","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":" ecflow_start.sh -d /hpc/perm/ms/$GROUP/$USER/HARMONIE/","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Again, if ecFlow is running on a different machine you have to login and start it on that machine. For the virtual server ecgb-vecf you would do","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":" ssh ecgb-vecf\n module load ecflow\n ecflow_start.sh -d /hpc/perm/ms/$GROUP/$USER/HARMONIE/","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"As an alternative you can let Harmonie start the server for you when starting your next experiment.","category":"page"},{"location":"SuiteManagement/ECFLOW/#Keep-your-ecFlow-server-alive-1","page":"ECFLOW","title":"Keep your ecFlow server alive","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"The ecFlow server running on ecgate will eventually die causing an unexpected disruption in you experiments. To prevent this you can add a cron job restarting the server e.g. every fifth minute.","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"> crontab -l\n*/5 * * * * /home/ms/$GROUP/$USER/bin/cronrun.sh ecflow_start.sh -d /hpc/perm/ms/$GROUP/$USER/HARMONIE > ~/ecflow_start.out 2>&1","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"where to small script cronrun.sh make sure you get the right environment","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"#!/bin/bash\nsource ~/.bash_profile\nmodule unload ecflow\nmodule load ecflow/4.12.0\n$@","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"The ecFlow server version may change over time.","category":"page"},{"location":"SuiteManagement/ECFLOW/#Add-another-user-to-your-ecflowviewer-1","page":"ECFLOW","title":"Add another user to your ecflowviewer","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Sometimes it's handy to be able to follow, and control, your colleagues experiments. To be able to do this do the following steps:","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Find the port number of your colleague as described above.\nIn the ecflowviewer choose edit->preferences->servers and fill in the appropriate host and port and give it a useful name. Click on add to save it.\nIf you click on Servers in the viewer the name should appear and you can make it visible by clicking on it.","category":"page"},{"location":"SuiteManagement/ECFLOW/#Changing-the-port-1","page":"ECFLOW","title":"Changing the port","text":"","category":"section"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"By default, the port is set by ","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"export ECF_PORT=$((1500+usernumber))","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"in mSMS.job (40h1.1), or Start_ecFlow.sh (trunk). ","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"If you want to change this number (for example, if that port is in use already), you will also need to add a -p flag when calling ecflow_start.sh as follows:","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"ecflow_start.sh -p $ECF_PORT -d $JOBOUTDIR","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Otherwise, ecflow_start.sh tries to open the default port. ","category":"page"},{"location":"SuiteManagement/ECFLOW/#","page":"ECFLOW","title":"ECFLOW","text":"Note: if you already have an ecFlow server running at your new port number before launching an experiment, this won't be an issue. ","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Platform-Configuration-1","page":"Platform","title":"Platform Configuration","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Overview-1","page":"Platform","title":"Overview","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"This wiki page outlines the configuration files required by HARMONIE for successful compilation and running of the system.","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Basic-requirements-1","page":"Platform","title":"Basic requirements","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"All experiments require a valid host to \"setup\" an experiment using the Harmonie script. Recall from the quick start instructions that in order to setup a new experiment on your platform, called YOURHOST, using HARMONIE downloaded to PATH_TO_HARMONIE one must issue the following command:","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"cd hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"hm_home/my_exp contains:","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"Env_submit -> config-sh/submit.YOURHOST           ## YOURHOST platform specific settings\nEnv_system -> config-sh/config.YOURHOST           ## YOURHOST task submission settings\n./config-sh/hm_rev                                ## contains PATH_TO_HARMONIE\n./config-sh/Main                                  ## The script used to run HARMONIE\n./config-sh/submit.YOURHOST                       ## YOURHOST platform specific settings\n./config-sh/config.YOURHOST                       ## YOURHOST task submission settings\n./suites/harmonie.pm                              ## perl module to define ensemble settings\n./ecf/config_exp.h                                ## your experiment definition (scientific type options)\n./scr/include.ass                                 ## assimilation specific settings","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"But, what if your host configuration is not available in the HARMONIE system? Host specific configuration files in PATH_TO_HARMONIE/config-sh must be available for your host and configuration files for the compilation of the code must be available. This documentation attempts to describe what is required.","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Host-config-files-1","page":"Platform","title":"Host config files","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Env_system-config-sh/config.YOURHOST-1","page":"Platform","title":"Env_system -> config-sh/config.YOURHOST","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"The config.YOURHOST file defines host specific variables such as some input directory locations. If your YOURHOST is not already included in HARMONIE it may be work looking at config.* files in config-sh/ to see what other people have done. The table below outlines variables set in config-sh/config-sh.YOURHOST and what the variables do:","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"Variable name Description\nCOMPCENTRE controls special ECMWF solutions (such as MARS) where required. Set to LOCAL if you are unsure\nHARMONIE_CONFIG defines the config file used by Makeup compilation\nMAKEUP_BUILD_DIR location of where Makeup compiles the HARMONIE code\nMAKE_OWN_PRECOMPILED yes=>install pre-compiled code in $PRECOMPILED\nPRECOMPILED location of (optional) pre-compiled HARMONIE code\nE923_DATA_PATH location of input data for E923, climate generation\nPGD_DATA_PATH location of input data for PGD, surfex climate generation\nECOSG_DATA_PATH location of input data for ECOCLIMAP2G\nGMTED2010_DATA_PATH location of HRES DEM\nSOILGRID_DATA_PATH location of SOILGRID data\nHM_SAT_CONST location of constants for satellite assimilation\nRTTOV_COEFDIR location of RTTOV coefficients\nHM_DATA location of top working directory for the experiment\nHM_LIB location of src/scripts and compiled code\nTASK_LIMIT Maximum number of jobs submitted by ECFLOW\nRSYNC_EXCLUDE used to exclude .git* sub-directories from copy of source code for compilation\nDR_HOOK_IGNORE_SIGNALS environment variable used by Dr Hook to ignore certain \"signals\"\nHOST0 define primary host name\nHOSTN define other host name(s)\nHOST_INSTALL 0=> install on HOST0, 0:...:N => install on HOST0,...,HOSTN\nMAKE make command may need to be explicity defined. Set to make for most platforms\nMKDIR mkdir command (default: mkdir -p)\nJOBOUTDIR where ECFLOW writes its log files\nECCODES_DEFINITION_PATH location of local ecCodes definition files\nBUFR_TABLES location of local BUFR tables","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Env_submit-config-sh/submit.YOURHOST-1","page":"Platform","title":"Env_submit -> config-sh/submit.YOURHOST","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"The Env_submit file uses perl to tell the HARMONIE scheduler how to execute programs - which programs should be run on multiple processors and define batch submissions if required.","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"perl description\n%backg_job defines variables for jobs run in the background on HOST0\n%scalar_job defines variables for single processor batch jobs\n%par_job defines variables for multi-processor batch jobs\n@backg_list list of tasks to be submitted as a background job\n@scalar_list list of tasks to be submitted as a scalar job\n@par_list list of tasks to be submitted as parallel job\ndefault \"wildcard\" task name to defined default type of job for unlisted tasks","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Host-summary-1","page":"Platform","title":"Host summary","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"YOURHOST Host type batch Contact\nKNMI-Altix KNMI SGI HPC none \nLinuxPC General Linux PC no MPI none \nLinuxPC-MPI General Linux PC with MPI none \nLinuxPC-MPI-ubuntu Ubuntu Linux PC with MPI none \nMETIE.LinuxPC METIE CentOS 6 PC with MPI none Eoin Whelan\nMETIE.LinuxRH7gnu METIE Redhat 7 server with MPI none Eoin Whelan\nMETIE.fionn METIE SGI HPC PBS Eoin Whelan\nSMHI.Linda4 SMHI ???  \nSMHI.LinuxPC SMHI PC  \nbi   \ncrayx1   \ncrayxt5m   \necgb   \necgb-cca ECMWF HPC with MPI dual host slurm/PBS \nfmisms   \njumbo   \nxt5intel   \nxtpathscale   ","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Compilation-config-files-1","page":"Platform","title":"Compilation config files","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Makeup-1","page":"Platform","title":"Makeup","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"config files required for compilation of code using Makeup ...","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"More information on Makeup is available here: Build with Makeup","category":"page"},{"location":"ExperimentConfiguration/PlatformConfiguration/#Obsmon-1","page":"Platform","title":"Obsmon","text":"","category":"section"},{"location":"ExperimentConfiguration/PlatformConfiguration/#","page":"Platform","title":"Platform","text":"For config files required for compilation of obsmon check util/obsmon/config","category":"page"},{"location":"Overview/FileFormats/#File-formats-in-HARMONIE-1","page":"File Formats","title":"File formats in HARMONIE","text":"","category":"section"},{"location":"Overview/FileFormats/#Introduction-1","page":"File Formats","title":"Introduction","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"The HARMONIE system reads and writes a number of different formats. ","category":"page"},{"location":"Overview/FileFormats/#FA-files-1","page":"File Formats","title":"FA files","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"Default internal format input/output for HARMONIE for gridpoint, spectral and SURFEX data. GRIB is used as a way to pack data, but the grib record cannot be used as such.","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"The header contains information about model domain, projection, spectral truncation, extension zone, boundary zone, vertical levels. \nOnly one date/time per file.\nFA routines are found under ifsaux/fa\nList or convert a file with gl\nOther listing tool PINUTS","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"Read more","category":"page"},{"location":"Overview/FileFormats/#GRIB/GRIB2-1","page":"File Formats","title":"GRIB/GRIB2","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"All FA files may be converted to GRIB after the forecast run. For the conversion between FA names and GRIB parameters check this table.","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"List or convert a GRIB file with gl","category":"page"},{"location":"Overview/FileFormats/#NETCDF-1","page":"File Formats","title":"NETCDF","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"In climate mode all FA files may converted to NETCDF after the forecast run. For the conversion between FA names and NETCDF parameters check util/gl/inc/nc_tab.h.","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"For the manipulation and listing of NETCDF files we refer to standard NETCDF tools.\nNETCDF is also used as output data from some SURFEX tools.","category":"page"},{"location":"Overview/FileFormats/#BUFR-and-ODB-1","page":"File Formats","title":"BUFR and ODB","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"BUFR is the archiving/exchange format for observations. Observation Database is used for efficient handling of observations on IFS. ODB used for both input data and feedback information.","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"Read more about observations in HARMONIE here.","category":"page"},{"location":"Overview/FileFormats/#DDH-(LFA-files-)-1","page":"File Formats","title":"DDH (LFA files )","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"Diagnostics by Horizontal Domains allows you to accumulate fluxes from different packages over different areas/points. ","category":"page"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"LFA files ( Autodocumented File Software )\ngmapdoc\nunder util/ddh","category":"page"},{"location":"Overview/FileFormats/#Misc-1","page":"File Formats","title":"Misc","text":"","category":"section"},{"location":"Overview/FileFormats/#","page":"File Formats","title":"File Formats","text":"vfld/vobs files in a simple ASCII format used by the verification.\nObsmon files are stored in sqlite format.","category":"page"},{"location":"DataAssimilation/SingleObs/#Single-observation-impact-experiment-1","page":"Single Obs","title":"Single observation impact experiment","text":"","category":"section"},{"location":"DataAssimilation/SingleObs/#General-1","page":"Single Obs","title":"General","text":"","category":"section"},{"location":"DataAssimilation/SingleObs/#","page":"Single Obs","title":"Single Obs","text":"The results of single observation impact experiment provide useful information of the observation operator and error statistics. Among others, it is a useful tool for diagnosing background error statistics. The procedure described below is the recommended one and it has been tested on HARMONIE harmonie-43h21, with some modifications. The example below with the new system is for a AROME domain covering Denmark (DOMAIN=DKCOEXP). Three TEMP observation types have been implemented in scr/Create_singe_obs as deviations to the background:","category":"page"},{"location":"DataAssimilation/SingleObs/#","page":"Single Obs","title":"Single Obs","text":"A temperature increase of 1K\nA wind speed increase of 1 m/s\nA specific humidity reduction to 90% of the background.","category":"page"},{"location":"DataAssimilation/SingleObs/#Illustrative-example-of-single-observation-impact-experiment-on-ecgb/cca-1","page":"Single Obs","title":"Illustrative example of single observation impact experiment on ecgb/cca","text":"","category":"section"},{"location":"DataAssimilation/SingleObs/#","page":"Single Obs","title":"Single Obs","text":"create hm_home/sinob directory. Then cd hm_home/sinob.\ncreate experiment by typing ~hlam/Harmonie setup -r ~hlam/harmonie_release/tags/harmonie-43h2.1.\nEdit ecf/config_exp.h  as follows:\nset ANASURF=none,\nset SINGLEOBS=yes,\nset LSMIXBC=no,\nEdit scr/include.ass  as follows:\nset USEOBSOUL=1,\nCopy a correction of the file Createsingleobs by typing \ncp ~hlam/harmone_release/git/develop/scr/Create_single_obs scr/Create_single_obs\nCopy a correction for gl\nmkdir -p util/gl/mod/ ; cp ~hlam/harmone_release/git/develop/util/gl/mod/module_rotations.f90 util/gl/mod\nLaunch the single observation impact experiment by standing in hm_home/sinob typing:\n~hlam/Harmonie start DTG=2012061003 DTGEND=2012061006\nThe resulting analysis file be found as cca:$SCRATCH/hm_home/sinob/archive/2012/06/10/06/MXMIN1999+0000. You can now diagnose the 3D-VAR analysis increments of the sinob-experiment taking the difference between the analysis  MXMIN1999+0000 (analysis) and the first guess, cca:$SCRATCH/hm_home/sinob/archive/2012/06/10/03/ICMSHHARM+0003. Plot horizontal and vertical cross-sections of temperature and other variables using your favorite software (EpyGram for example). ","category":"page"},{"location":"DataAssimilation/SingleObs/#","page":"Single Obs","title":"Single Obs","text":"Note that you can change position of observation, observation error, variable to be observed etc. Investigate these options by taking a closer look at the script Createsingleobs.","category":"page"},{"location":"DataAssimilation/SingleObs/#","page":"Single Obs","title":"Single Obs","text":"Read more about radiance single observation experiments here. In ec:/smx/sinob_wiki_ml you will also find OBSOUL_amsua7, a file for generating a satellati radiance amsu a channel 7 single observation impact experiment.","category":"page"},{"location":"DataAssimilation/CHKEVO/#ECHKEVO-1","page":"CHKEVO","title":"ECHKEVO","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#Introduction-1","page":"CHKEVO","title":"Introduction","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"This page describes how to activate CHKEVO for diagnosing forecast model spin-up of pressure. This diagnostic is available in trunk from r16488. Yann Michel (MF) kindly suggested some of the changes required. The diagnostics are generated as part of a forecast model run up to 3 h or 6 h. A known problem is that the method fails when the first lateral boundary conditions are read by the model. The suggestion is to use BDINT=3 and forecast length 3 h. FULL-POS should also be deactivated in config_exp.h.","category":"page"},{"location":"DataAssimilation/CHKEVO/#Preparations-1","page":"CHKEVO","title":"Preparations","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"It is assumed you already have a well defined experiment called your_exp. The following instructions are valid for a 3h diagnostic forecast.","category":"page"},{"location":"DataAssimilation/CHKEVO/#NAMCHK-namelist-1","page":"CHKEVO","title":"NAMCHK namelist","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"Enable CHKEVO in the namelist (in the %arome entries):\ncd $HOME/hm_home/your_exp\n~hlam/Harmonie co nam/harmonie_namelists.pm\nEdit NAMCHK:\nNAMCHK=>{\n'LECHKEVO' => '.TRUE.,',\n'LECHKTND' => '.TRUE.,',\n'LECHKPS' => '.TRUE.,',\n},","category":"page"},{"location":"DataAssimilation/CHKEVO/#ecf/config_exp.h-1","page":"CHKEVO","title":"ecf/config_exp.h","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"Edit your ecf/config_exp.h  as follows:\nPOSTP=\"none\"                          # Postprocessing by Fullpos (inline|offline|none).\nBDINT=3\nHH_LIST=\"00-21:3\"                     # Which cycles to run, replaces FCINT\nLL_LIST=\"3\"                           # Forecast lengths for the cycles [h], replaces LL, LLMAIN\nAlternatively for a 6 h diagnostic forecast:\nPOSTP=\"none\"                          # Postprocessing by Fullpos (inline|offline|none).\nBDINT=6\nHH_LIST=\"00-18:6\"                     # Which cycles to run, replaces FCINT\nLL_LIST=\"6\"                           # Forecast lengths for the cycles [h], replaces LL, LLMAIN","category":"page"},{"location":"DataAssimilation/CHKEVO/#Results-1","page":"CHKEVO","title":"Results","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"After running the forecast with CHKEVO activated the statistics of surface pressure tendencies are written to NODE.001_01 log file. This log file is included in the HM_Date_YYYYMMDDHH.html log file (written to $SCRATCH/hm_home/your_exp/archive/log on ecgate). The results can be obtained by grepping the log file as follows:","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"grep \"^ CHKEVO : \" HM_Date_2013041118.html | tail -n +2","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"This gives the RMS and AVG of pressure tendency for each time step. (The first line is removed as the reading of the start file produces zeros):","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":" CHKEVO :   2.5683273661035013       0.42575646791552352     \n CHKEVO :   2.5432078820872874       0.36700119757663685     \n CHKEVO :   1.4402533781888094       0.23533175032737094     \n CHKEVO :   1.3677546254375832       0.22965677860570116     \n CHKEVO :   1.1506125378848564       0.20575065246468008     \n CHKEVO :  0.98597708942270756       0.19299583141063531\n.....","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"The first column contains the string CHKEVO :\nSecond column contains the RMS of dps/dt averaged over the domain.\nSecond column contains the AVG of dps/dt averaged over the domain.","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"The RMS of dps/dt alone can be extracted with:","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"grep \"^ CHKEVO : \" HM_Date_2013041118.html | tail -n +2 | awk '{print $3}'","category":"page"},{"location":"DataAssimilation/CHKEVO/#Plotting-1","page":"CHKEVO","title":"Plotting","text":"","category":"section"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"Some instructions here ...","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"grep \"^ CHKEVO : \" HM_Date_2013041118.html | tail -n +2 > dps.dat\nwget https://hirlam.org/trac/raw-attachment/wiki/HarmonieSystemDocumentation/CHKEVO/plotCHKEVO.py\nchmod 755 ./plotCHKEVO.py\n./plotCHKEVO.py -h\n./plotCHKEVO.py -i ps.dat  && eog plot.png\n# OR\n./plotCHKEVO.py -i ps.dat -t 75  && eog plot.png","category":"page"},{"location":"DataAssimilation/CHKEVO/#","page":"CHKEVO","title":"CHKEVO","text":"To get the unit of hPa/3h the time-step is taken into account using the -t option. If, for example, the time-step is 60 s the values in the second column will be multiplied with 60.*3. and then divided by 100.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#Controlling-the-namelists-in-HARMONIE-1","page":"Namelist","title":"Controlling the namelists in HARMONIE","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#Introduction-1","page":"Namelist","title":"Introduction","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"IFS is largely driven by namelists and has thousands of options. For each configuration a number of namelists controlling different parts are read. To make the maintenance of the namelists manageable and to assure consistency in terms on e.g. name conventions for fields, packing accuracy, physics settings and parallel options all namelists are generated as they are needed during the run. All the basic settings are defined in a perl dictionary nam/harmonie_namelists.pm for IFS and nam/surfex_namelists.pm and nam/surfex_selected_output.pm for SURFEX. surfex reference namelist settings. In future versions the commented namelists will be included and maintained as part of the code.   The IFS dictionary is structured in several sections:","category":"page"},{"location":"ExperimentConfiguration/Namelists/#harmone_namelists.pm-1","page":"Namelist","title":"harmone_namelists.pm","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Global settings\nTechnical settings\nHost specific settings\nMPP options\nFile settings\nDYNAMICS SETTINGS\nMain dynamics switches\nNon-hydrostatic settings\nVertical finite element\nDFI\nMain physics options. NB! These may contain switches for dynamics as well\nALADIN\nAROME\nEDMFM switches, to be applied after AROME\nAlaro\nOld surface\nSURFEX\nDDH\nE927 Interpolation settings\nMain fullpos settings\nE927\nE927 nh\nSURFEX initial file generation\nAladin e927\nALARO e927\nArome e927\nGeneral postprocessing switches \nDefault fullpos settings\nNH postprocessing\nSwitches for postprocessing with surfex\nSpecial cases for arome\nAssimilation\nCanari\nArome canari\nVarbc_rad\nVarbc_coldstart\nScreening\nArome screening\nAlaro screening\nMinimization\nAlaro minimization\n4DVAR \n4DVAR minimization\n4DVAR screening\n4DVAR trajectory\nClimate generation\nClimate generations (e923)\nMisc\nGeneral namelist settings for Tangent-Linear and Adjoint tests \nExtra Adjoint test options \nOulan\nBator","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The final namelists are build through the rules given in scr/Get_namelist and are generated by nam/gen_namelists.pl. Note that in several cases environment variables are still parsed in the scripts.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#surfex_namelists.pm-1","page":"Namelist","title":"surfex_namelists.pm","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"All possible SURFEX namelist setting are documented at the SURFEX web site. Use the search text area in the upper right corner to search for a specific namelist or namelist option. Please, keep in mind that the SURFEX web site documents the latest SURFEX version, i.e. SURFEXv8, while in cy40h SURFEXv7.3 is used. Therefore, some of the settings may be different or not available.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#PGD-1","page":"Namelist","title":"PGD","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"PGD represents in general the preparation of physiography data. The default PGD settings are listed here. Some modifications can be done for specific model configurations and will be specified as e.g. alaro_pgd or arome_pgd.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"# 2 layer ISBA scheme\n%isba_2L=(\n NAM_ISBA=>{\n  CISBA          => '\"2-L\",',\n  NGROUND_LAYER  => '2,',\n },\n);\n\n# 3 layer ISBA scheme\n%isba_3L=(\n NAM_ISBA=>{\n  CISBA          => '\"3-L\",',\n  NGROUND_LAYER  => '3,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The section used here is decided by setting CISBA=\"3-L\" (default) in config_exp.h.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%isba_pgd=(\n NAM_ISBA=>{\n   YCLAY         => 'YCLAY,',\n   YCLAYFILETYPE => '\"DIRECT\",' ,\n   YSAND         => 'YSAND,',\n   YSANDFILETYPE => '\"DIRECT\",'\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The clay/sand used is decided by setting SOIL_TEXTURE_VERSION=FAO (default) in config_exp.h. FAO corresponds to 10 km resolution clay/sand according to SURFEX Soil texture description. The 1 km HWSD_v2 is not used by default since is shows strange vales over Scandinavia.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%pgd=(\n NAM_IO_OFFLINE=>{\n  CSURF_FILETYPE => 'CSURF_FILETYPE,',\n   CPGDFILE      => 'CPGDFILE,',\n },\n NAM_PGD_GRID=>{\n   CGRID         => '\"CONF PROJ\",',\n },\n NAM_CONF_PROJ=>{\n   XLAT0         => $ENV{LAT0},\n   XLON0         => $ENV{LON0},\n   XRPK          => $ENV{SINLAT0},\n   XBETA         => 0.0,\n },\n NAM_CONF_PROJ_GRID=>{\n   XLATCEN       => $ENV{LATC},\n   XLONCEN       => $ENV{LONC},\n   NIMAX         => 'BNIMAX,',\n   NJMAX         => 'BNJMAX,',\n   XDX           => 'BXDX,', \n   XDY           => 'BXDY,',\n },\n NAM_COVER=> {\n   YCOVER        => 'YCOVER,',\n   YCOVERFILETYPE=> '\"DIRECT\",',\n },\n NAM_ZS=>{\n   YZS           => 'YTOPO,',\n   YZSFILETYPE   => '\"DIRECT\",',\n },\n NAM_SEABATHY=>{\n   XUNIF_SEABATHY=>'0.,', \n },\n NAM_PGD_SCHEMES=>{\n    CNATURE => '\"ISBA \",',\n    CSEA    => '\"SEAFLX\",',\n    CWATER  => '\"WATFLX\",',\n    CTOWN   => '\"TEB \",',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Most options here are specified in different scripts and are normally not supposed to be modified. Exceptions are e.g.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"ECOCLIMAP version used (YCOVER) is decided by setting ECOCLIMAP_VERSION=2.2 (default) in config_exp.h. Available ECOCLIMAP versions provided via the SURFEX team are documented in SURFEX Land use description. Some of these can be available on your system, see your $HM_CLDATA setting.\nOrography version used (YTOPO) is decided by setting TOPO_SOURCE=gmted2010 (default) in config_exp.h.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#PREP-1","page":"Namelist","title":"PREP","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"PREP represents in general initialisation of prognostic variables. The default PREP settings are listed here. Some modifications can be done for specific model configurations and will be specified as e.g. alaro_prep or arome_prep.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%sice_prep=(\n NAM_SEAFLUXn=>{\n    LHANDLE_SIC            =>'.TRUE.,',\n    LSIC_FROM_FILE         =>'.TRUE.,',\n    CSEA_ICE               =>'\"SICE\",',\n    NICE_LAYER             =>'4,',\n },\n NAM_PREP_SEAFLUX=>{\n    CFILE_SIC           =>'\"CFILE_SIC\",',\n    CTYPE_SIC           =>'\"GRIB  \"',\n },\n NAM_SIMPLE_ICE=>{\n    XICE_THICKNESS      =>'.75,',\n    LICE_HAS_SNOW       =>'.FALSE.,',\n    CICE_SNOW           =>'\"S-D\",',\n    NICE_SNOW_NLAYERS   =>'4,',\n    XICE_SNOW_HEIGHT    =>'.3,',\n    LSIC_DRIVEN_THICKNESS=>'.FALSE.',\n    XSIC_DRIVEN_MAX_THICKNESS=>'1.',\n },\n NAM_PREP_SIMPLE_ICE=>{\n    LINIT_FROM_SST => '.TRUE.,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"CSEA_ICE : selects preferred sea ice scheme.\nNONE – use default SURFEX ICEFLUX diagnostic scheme \nSICE – use SICE\nLHANDLE_SIC : activates ice fraction handling\nLSIC_FROM_FILE : ice fraction data from an external source\n.TRUE. – use the externally provided ice fraction data\n.FALSE. – assume that ice fraction data is encoded within SST field\nNICE_LAYER : number of ice layers (2 < NICE_LAYER < 100)\nCFILE_SIC : external data file that stores ice fraction data\nCTYPE_SIC : type of external data source\nXICE_THICKNESS : uniform thickness of the ice field\nLICE_HAS_SNOW : snow upon the ice\n.TRUE. – preform snow-enabled run\n.FALSE. – use bare ice configuration\nCICE_SNOW : snow scheme that used to parametrize snow upon the ice\nS-D – test heat diffusion scheme\nNICE_SNOW_NLAYERS : number of snow layers for S-D snow scheme\nXICE_SNOW_HEIGHT : thickness of snow pack for S-D snow scheme\n3-L – use 3-L explicit snow scheme \nLSIC_DRIVEN_THICKNESS : use ice fraction to estimate ice thickness. Untested, should be set to .FALSE.\nXSIC_DRIVEN_MAX_THICKNESS : unused if LSIC_DRIVEN_THICKNESS == .FALSE.\nLINIT_FROM_SST : use composite SST/SIST field to initialize sea ice temperatures","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"This part represents settings connected to the Simple Sea-ice Scheme (SICE) by Yurii Batrak. Please note that SICE is not yet an official contribution to SURFEX and therefore you will not find any documentation of SICE via the SURFEX web site. ","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%isba_prep=(\n NAM_PREP_ISBA=>{\n   LISBA_CANOPY  => '.TRUE.,',\n   LEXTRAP_TG    => '.TRUE.,',\n   LEXTRAP_WG    => '.TRUE.,',\n   LEXTRAP_WGI   => '.TRUE.,',\n   LEXTRAP_SN    => '.TRUE.,',\n   NDIM_EXTRAP   => '20,',\n },\n NAM_PREP_ISBA_SNOW=>{\n   LSWEMAX       => '.TRUE.,',\n },\n NAM_DIAG_ISBAn=>{\n   LPATCH_BUDGET=>'.TRUE.,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"LISBA_CANOPY : activates surface boundary multi layer scheme over vegetation\nLEXTRAP_XX : extrapolate XX points where LSM < 0.5 (buffer only)\nNDIM_EXTRAP : Size of search domain for extrapolation (not in official SURFEX)\nLSWEMAX : logical switch to set an upper limit on initial snow water equivalent (set by XSWEMAX (=500 kg/m2 default) ).","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%fullpos_prep=(\n NAM_FILE_NAMES=>{\n   HPGDFILE      =>'\"PGDFILE\",',\n   CINIFILE      =>'\"SURFXINI\",',\n },\n);\n\n%offline_prep=(\n NAM_IO_OFFLINE=>{\n   CSURF_FILETYPE       => '\"LFI   \",',\n   CPREPFILE            => '\"SURFXINI\",',\n   CPGDFILE             => '\"PGD\",',\n },\n NAM_PREP_SURF_ATM=>{\n   CFILEPGD      =>'\"PGD_host\",',\n   CFILEPGDTYPE  =>'\"LFI\",',\n   CFILE      =>'\"INFILE\",',\n   CFILETYPE  =>'CFILETYPE,',\n   NYEAR      =>'NYEAR,',\n   NMONTH     =>'NMONTH,',\n   NDAY       =>'NDAY,',\n   XTIME      =>'XTIME,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Most options here are specified in different scripts and are normally not supposed to be modified.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%arome_prep=(\n NAM_PREP_SEAFLUX=>{\n   LSEA_SBL     => '.FALSE.,',\n },\n NAM_SEAFLUXn=>{\n    CSEA_ICE               =>'\"NONE\",',\n    LHANDLE_SIC            =>'.FALSE.,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Please note these special settings for the AROME model configuration.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#FORECAST-1","page":"Namelist","title":"FORECAST","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"FORECAST represents in general the namelist settings used during Forecast. The default FORECAST settings are listed here. Some modifications can be done for specific model configurations and will be specified as e.g. alaro_forecast or arome_forecast.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%sice_forecast=(\n NAM_SEAFLUXn=>{\n    LHANDLE_SIC            =>'.TRUE.,',\n    LSIC_FROM_FILE         =>'.TRUE.,',\n    CSEA_ICE               =>'\"SICE\",',\n    NICE_LAYER             =>'4,',\n },\n NAM_SIMPLE_ICE=>{\n    XICE_THICKNESS            => '.75,',\n    LICE_HAS_SNOW             => '.FALSE.,',\n    CICE_SNOW                 => '\"S-D\",',\n    NICE_SNOW_NLAYERS         => '4,',\n    XICE_SNOW_HEIGHT          => '.3,',\n    LSIC_DRIVEN_THICKNESS     => '.FALSE.',\n    XSIC_DRIVEN_MAX_THICKNESS => '1.',\n },\n NAM_DIAG_SURFn=>{\n   LCOEF             => '.TRUE.,',\n   LSURF_VARS        => '.TRUE.,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"This part represents settings connected to the Simple Sea-ice Scheme (SICE) by Yurii Batrak. Please note that SICE is not yet an official contribution to SURFEX and therefore you will not find any documentation of SICE via the SURFEX web site.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%isba_forecast=(\n NAM_ISBAn=>{\n   CROUGH        => '\"NONE\",',\n },\n NAM_DIAG_ISBAn=>{\n   LPGD     => '.TRUE.,',\n   LSURF_MISC_BUDGET=> '.TRUE.,',\n },\n);\n\n%forecast=(\n NAM_IO_OFFLINE=>{\n  'CSURF_FILETYPE'      => '\"LFI    \",',\n  'CFORCING_FILETYPE'   => '\"ASCII\",',\n  'CTIMESERIES_FILETYPE'=> '\"LFI\",',\n  'XTSTEP_SURF'         => $ENV{TSTEP}.\",\",\n  'XTSTEP_OUTPUT'       => '3600.,',\n  'LRESTART'            => '.TRUE.,',\n  'CPREPFILE'           => '\"PREP\",',\n  'CPGDFILE'            => '\"PGD\",',\n },\n NAM_SURF_ATM=>{\n   XRIMAX=>'0.0,',\n },\n NAM_DIAG_SURFn=>{\n   LSURF_BUDGET      => '.TRUE.,',\n   N2M      =>'2,',\n },\n NAM_DIAG_SURF_ATMn=>{\n   LT2MMW            => '.TRUE.,',\n },\n NAM_DIAG_ISBAn=>{\n   LPATCH_BUDGET  => '.TRUE.,',\n },\n NAM_SSOn=>{\n   CROUGH   => \"'\".$ENV{CROUGH}.\"'\",\n   XFRACZ0  => '15.,',\n },\n NAM_SEAFLUXn=>{\n  CSEA_FLUX => '\"ECUME\",',\n  LPWG      => '.FALSE.,',\n  LPRECIP   => '.FALSE.,',\n  LPWEBB    => '.FALSE.,',\n  CSEA_ICE    =>'\"NONE\",',\n  LHANDLE_SIC =>'.FALSE.,',\n  LPERTFLUX   => 'LPERTSURF,',\n },\n NAM_ISBAn=>{\n  LCANOPY_DRAG => '.TRUE.,',\n  XCDRAG       => '0.01,',\n  LPERTSURF    => 'LPERTSURF,',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"XRIMAX: limitation of Richardson number in drag computation (=0 default).\nN2M : flag to compute surface boundary layer characteristics (=0 default). N2M=2 computes temperature at 2 m, specific humidity at 2 m, relative humidity, zonal and meridian wind at 10 m, and Richardson number. 2m and 10m quantities are calculated interpolating between atmospheric forcing variables and surface temperature and humidity. Please note that if the surface boundary multi layer scheme is activated over any tile (as with LISBA_CANOPY=T over land) it overrides the diagnostic N2M method. \nLT2MMW : Alternative weighting of grid average T2M giving more weight to the land tile (=FALSE default).\nCROUGH: type of orographic roughness length. CROUGH is decided by setting CROUGH=\"NONE\" in config_exp.h which means that no orographic treatment is applied.\nXFRACZ0 : Z0=Min(Z0, Href/XFRACZ0). Not applied here since CROUGH=\"NONE\".\nLPERTFLUX: multiplicative perturbation of Ecume fluxes for ensemble forecasting. In HARMONIE this is set in a number of scripts under scr.\nLPERTSURF: if .True. modification of surface fluxes for ensemble forecasting. In HARMONIE this is set in a number of scripts under scr.\nLCANOPY_DRAG: drag activated in SBL scheme within the canopy.\nXCDRAG: drag coefficient in canopy (=0.15 default in SURFEX).","category":"page"},{"location":"ExperimentConfiguration/Namelists/#ASSIMILATION-1","page":"Namelist","title":"ASSIMILATION","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"ASSIMILATION represents in general the surface assimilation namelist settings used for CANARI and SURFEX. The default ASSIMILATION settings are listed here. The SURFEX assimilation method used (OI or EKF) is decided by setting ANASURF=CANARI_OI_MAIN in config_exp.h. OI is default and EKF is still experimental.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%sice_assim=(\n NAM_SEAFLUXn=>{\n    LHANDLE_SIC            =>'.TRUE.,',\n    LSIC_FROM_FILE         =>'.TRUE.,',\n    CSEA_ICE               =>'\"SICE\",',\n    NICE_LAYER             =>'4,',\n },\n NAM_SIMPLE_ICE=>{\n   LICE_HAS_SNOW       =>'.FALSE.,',\n   XICE_THICKNESS      =>'.75,',\n   CICE_SNOW           =>'\"S-D\",',\n   NICE_SNOW_NLAYERS   =>'4,',\n   XICE_SNOW_HEIGHT    =>'.3,',\n   LSIC_DRIVEN_THICKNESS      =>'.FALSE.',\n   XSIC_DRIVEN_MAX_THICKNESS  =>'1.',\n \n},\n NAM_PREP_SEAFLUX=>{\n    CFILE_SIC          => 'CFILE_SIC,',\n    CTYPE_SIC          => '\"GRIB  \"',\n    LSEA_SBL           => '.FALSE.',\n },\n NAM_PREP_SIMPLE_ICE=>{\n    LINIT_FROM_SST             =>'.TRUE.,',\n    LPREP_ONLY_NEW_ICE         =>'.TRUE.,',\n    LEXTRAPOLATE_FROM_FORECAST =>'.TRUE.,',\n    CFORECAST_GRIB             =>'CFORECAST_GRIB',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"LPREP_ONLY_NEW_ICE : perform prep in current grid cell only if ice state is undefined\nLEXTRAPOLATE_FROM_FORECAST : use previous forecast to fill areas with new ice. If LINIT_FROM_SST == .TRUE. .AND. LEXTRAPOLATE_FROM_FORECAST == .TRUE. option LINIT_FROM_SST is forced to .FALSE.\nCFORECAST_GRIB : previous forecast in GRIB format","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"This part represents settings connected to the Simple Sea-ice Scheme (SICE) by Yurii Batrak. Please note that SICE is not yet an official contribution to SURFEX and therefore you will not find any documentation of SICE via the SURFEX web site. ","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%assim_surfex=(\n NAM_NACVEG=>{\n   NECHGU      => ''.$ENV{FCINT}.',',\n   RCLIMCA     => '0.,',\n   RCLISST     => '0.05,',\n   SIGH2MO     => '0.10,',\n   SIGT2MO     => '1.0,',\n   LOBS2M      => '.TRUE.,',\n   LOBSWG      => '.FALSE.,',\n },\n NAM_IO_OFFLINE=>{\n   CSURF_FILETYPE       => 'CSURF_FILETYPE,',\n   CTIMESERIES_FILETYPE => '\"LFI \",',\n   CFORCING_FILETYPE    => '\"ASCII\",',\n   LRESTART             => '.TRUE.,',\n   XTSTEP_SURF          => '3600.,',\n   XTSTEP_OUTPUT        => '3600.,',\n },\n NAM_ASSIM=>{\n   LASSIM              => '.TRUE.,',\n   LEXTRAP_WATER       => '.TRUE.,',\n   LEXTRAP_SEA         => '.FALSE.,',\n   LEXTRAP_NATURE      => '.FALSE.',\n   LREAD_SST_FROM_FILE => '.TRUE.,',\n   LWATERTG2           => '.TRUE.,',\n   LAESNM              => 'LAESNM,',\n   LECSST              => 'LECSST,',\n   LAROME              => 'LAROME,',\n   NPRINTLEV           => '1,',\n },\n);\n\n%oi_main=(\n NAM_ASSIM=>{\n   CASSIM_ISBA         => '\"OI\",',\n },\n);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#surfex_selected_output.pm-1","page":"Namelist","title":"surfex_selected_output.pm","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The output from SURFEX to the .sfx fa-files (e.g. ICMSHHARM+0002.sfx) is in general decided by SURFEX NAM_DIAG namelist settings. These settings activate or deactivate groups of variables in output files. When one or more such groups are activated it is possible to limit the output to a specific list of variables by the use of the LSELECT/CSELECT options in SURFEX. This way of specifying output from SURFEX is the default way in cy40h. The setting is SURFEX_LSELECT=\"yes\" in config_exp.h. When SURFEX_LSELECT=\"yes\" the namelist nam/surfex_selected_output.pm is used to specify the output variables. The style of surfex_selected_output.pm is","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"%surfex_output=(\n NAM_WRITE_DIAG_SURFn=>{\n   NSTEP_DUMP_STATE => 'NSTEP_DUMP_STATE,',\n   LSELECT     => '.TRUE.,',\n   CSELECT     => '\n\"Z0\",\n\"RNC\",\n\"HC\",\n\n\n\"T2M_P\",\n\"T2MMIN_P\",\n\"T2MMAX_P\",'\n },);","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Please note the \" ' \" character at the end of the last variable line \"T2MMAX_P\",'. Don't miss it, it is very important! The naming convention for variables in this file follows the SURFEX naming convention which is not exactly how they appear in fa-files. A fa-file output example from a .sfx file may look:","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"SFX.SST         > 001:011-  000-102@20160301_15:00+002h00m tri:000 000 SST\nSFX.TS_WATER    > 001:011-  770-105@20160301_15:00+002h00m tri:000 000 TS_WATER\nX001TG1         >                   20160301_15:00+002h00m         000\nX001TG2         >                   20160301_15:00+002h00m         000\nX001WG1         >                   20160301_15:00+002h00m         000\nX001WG2         >                   20160301_15:00+002h00m         000\nSFX.TROAD1      >                   20160301_15:00+002h00m         000\nSFX.WS_ROAD     > 001:024-  950-105@20160301_15:00+002h00m tri:000 000 WS_ROAD","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"You get the corresponding SURFEX names by removing \"SFX.\" or \"X001\" at the beginning of these fa-names.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The .sfx files are used as first guess for next forecast. However, the first guess needs ALL SURFEX variables and not only a subset as defined by LSELECT/CSELECT. Therefore, a full .sfx file (e.g. ICMSHFULL+0003.sfx) is created for each assimilation cycle hour in addition to the corresponding limited file ICMSHHARM+0003.sfx. The output frequency of full files is defined by SURFEX_DUMP_STATE_STEPS=\"\" in config_exp.h.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"The content of the FULL-files can be used to identify additional variables to add to surfex_selected_output.pm.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#Change-your-namelists-1","page":"Namelist","title":"Change your namelists","text":"","category":"section"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"There are several ways of changing namelists generated from the dictionary.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"Copy the harmonie_namelist.pm file to your local experiment directory and change the right section like for any source or script modification.\nIf you feel uncertain where to change in the dictionary you can copy the actual namelist used in your run. Every namelist used is listed in the logfile so copy it from there and put it under the nam directory in your local experiment. Make sure you give it a unique name. You must then also change the script(s) using this namelist like in the Forecast script scr/Forecast.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"#  Get namelist name\n#NAMELIST=$WRK/$WDIR/namelist_forecast\n#Get_namelist forecast $NAMELIST\nNAMELIST=$HM_LIB/nam/namelist_forecast_with_a_unique_name\n","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"For namelists not present in the dictionary you just copy them to you local nam directory.","category":"page"},{"location":"ExperimentConfiguration/Namelists/#","page":"Namelist","title":"Namelist","text":"There is also a description on how to generate new namelist dictionaries here.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#Model-Domain-1","page":"Domain","title":"Model Domain","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#Introduction-1","page":"Domain","title":"Introduction","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"There are four projections available in HARMONIE, polar stereographic, lambert, mercator and rotated mercator. The model itself chooses the best (least distortion) projection among the first three given your domain specifications. The rotated mercator projection is selected through the variable LROTMER. Note that the polar stereographic project is defined at 90^o N(S) whereas in GRIB1 it is defined at 60^o N(S).","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"(Image: projections)","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"Polar stereographic, Lambert and Mercator projection.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"(Image: Rotated Mercator)","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"Rotated mercator projection","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#Model-domain-settings-1","page":"Domain","title":"Model domain settings","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"For each domain we set variables related to the geometry and the resolution like:","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"HARMONIE model domains are defined in settings in scr/Harmonie_domains.pm. The following variables related to the geometry and the resolution are required:","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"TSTEP is model timestep in seconds\nNLON is number of points in x-direction.\nNLAT is number of points in y-direction.\nLONC is the longitude of domain centre in degrees.\nLATC is the latitude of domain center in degrees.\nLON0 is the reference longitude of the projection in degrees.\nLAT0 is the reference latitude of the projection in degrees. If LAT0 is set to 90, the projection is polar stereographic. If LAT0 < 90, the projection is lambert unless LMRT=.TRUE.  \nGSIZE is grid size in meters in both x- and y-direction.\nEZONE is number of points over extension zone in both x- and y-direction. Default value 11. \nLMRT switch for rotated Mercator projection. If LMRT=.TRUE. LAT0 should be zero.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"NLON and NLAT should satisfy the equation 5^b * 3^d * 2^e, where a-e are integers leq 0.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"~~BDNLON is number of points in x-direction for intermediate climate file. BDNLON > NLON.~~\n~~BDNLAT is number of points in y-direction for intermediate climate file. BDNLAT > NLAT.~~","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"The default area is the Denmark domain (DKCOECP). The following values for C+I zone and truncation are calculated in src/Harmonie_domains.pm from the values above. ","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"NDLUXG is number of points in x-direction without extension (E) zone.\nNDGUXG is number of points in y-direction without extension (E) zone.\nNMSMAX_LINE is truncation order in longitude. By default (NLON-2)/2. \nNSMAX_LINE is truncation order in latitude. By default (NLAT-2)/2. \nNMSMAX_QUAD is truncation order in longitude. By default (NLON-2)/3. It is used to create filtered orography with lower resolution.\nNSMAX_QUAD is truncation order in latitude. By default (NLAT-2)/3. It is used to create filtered orography with lower resolution.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"(Image: cie domain)","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"~~Note that to run with LSPSMORO=yes you have to use a linear grid. I.e. NLON/NLAT must satisfy~~","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#Domain-creation-tool-1","page":"Domain","title":"Domain creation tool","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"To help with the design of a new domain, there is an interactive tool that lets you experiment with the grid parameters described above, and visualize the resulting domain immediately on a map, see figure below.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"(Image: domain200)","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"At present, it only works for Lambert and polar stereographic projection, not rotated mercator.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#Creating-a-new-domain-1","page":"Domain","title":"Creating a new domain","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"If you are happy with your new domain created with the help of the domain creation tool you can add it to scr/Harmonie_domains.pm for your experiment, my_exp (assuming you have set up the experiment):","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie co scr/Harmonie_domains.pm\n#\n# add domain information for new domain called MYNEWDOM in this file\n#\nvi scr/Harmonie_domains.pm\n#\n# set DOMAIN=MYNEWDOM in the experiment config file\n#\nvi ecf/config_exp.h ","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"You can now start a new experiment with a newly defined domain called MYNEWDOM.","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#Create-a-test-domain-with-gl-1","page":"Domain","title":"Create a test domain with gl","text":"","category":"section"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"Before you go through the full climate generation process you can generate a test domain using gl. Define your domain in the namelist like:","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"&NAMINTERP\nOUTGEO%NLON = 300 ,\nOUTGEO%NLAT = 300,\nOUTGEO%PROJECTION = 3,\nOUTGEO%WEST = 17.0,\nOUTGEO%SOUTH = 58.0,\nOUTGEO%DLON = 2500.0\nOUTGEO%DLAT = 2500.0\nOUTGEO%PROJLAT = 60.0\nOUTGEO%PROJLAT2 = 60.0\nOUTGEO%PROJLON = 0.0,\n/","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"Running gl using this namelist by","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"gl -n namelist_file","category":"page"},{"location":"ExperimentConfiguration/ModelDomain/#","page":"Domain","title":"Domain","text":"will create an GRIB file with a constant orography which you can use for plotting. ","category":"page"},{"location":"QuickStart/QuickStartLocal/#Running-Harmonie-on-your-local-platform-1","page":"Local","title":"Running Harmonie on your local platform","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#Introduction-1","page":"Local","title":"Introduction","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"These \"quick start instructions\" assumes that someone has already put in place a valid configuration for your local platform, CONFIG=linux.local for example.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"The Harmonie system runs through a number of steps to help you complete your experiment. The chain can be summarized like:","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Configure and start the experiment: This is where you define your domain, choose your settings and specify the period for your experiment.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Once you have done this you can start the system and let it create the basic infrastructure","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Setup the necessary directories and copy the system files needed (InitRun, Prepare_cycle)\nCompile the binaries you need to run your experiment (Build)\nCreate the constant climate files specifying your domain (Climate)","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"With the basic setup and files in place we can proceed to the integration part where we have three loops taking care of ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Prepare boundaries and observations (MakeCycleInput)\nRun assimilation and forecasts (Date)\nPost process and archive the result (Postprocessing)","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"The three different task are allowed to run ahead/after each other to get a good throughput.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"The configuration, the full suite and the relation between different tasks is controlled by the scheduler. This documentation describes how to get started with your first experiment. The description is general for a single host. (The reference Harmonie system on ECMWF platform assumes a dual-hosts setup with the front-end ecgb used to configure and launch experiments and cca is used for all computations except those for operations related to observation verification and monitoring. ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Following example shows the steps to launch an Harmonie experiment my_exp.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"If this is the first time to install HARMONIE on your local platform please take a look at the basic install instructions here. ","category":"page"},{"location":"QuickStart/QuickStartLocal/#Configure-your-experiment-1","page":"Local","title":"Configure your experiment","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Create an experiment directory under HOME/hmhome and use the master script Harmonie to set up a minimum environment for your experiment.  ```bash  mkdir -p HOME/hmhome/myexp  cd HOME/hmhome/myexp  PATHTOHARMONIE/config-sh/Harmonie setup -r PATHTO_HARMONIE -h YOURHOST  ```","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"where","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"-r is the path to your downloaded version of HARMONIE\n-h tells which configuration files to use. At ECMWF config.ecgb is the default one. List PATH_TO_HARMONIE/config-sh/config.* for available HOST configurations\nThis setup command  provides the default setup which currently is AROME physics with CANARI+OI_MAIN surface assimilation and 3DVAR upper air assimilations with 3h cycling on a domain covering Denmark using 2.5km horizontal resolution and 65 levels in the vertical.\nNow you can edit the basic configuration file ecf/config_exp.h to configure your experiment scenarios. Modify specifications for model domain, physics (AROME, ALARO), data locations, settings for dynamics, physics, domain, coupling host model etc. Read more about the options in here. You can also use some of the predefined configurations by calling Harmonie with the -c option:","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"mkdir $HOME/hm_home/my_exp\ncd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST -c CONFIG ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"where CONFIG is one of the setups defined in scr/Harmonie_configurations.pm. If you give -c with out an argument or a non existing configuration a list of configurations will be printed.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"In some cases you might have to edit the general system configuration file, Env_system. See here for further information\nThe rules for how to submit jobs are defined in Env_submit. See here for further information\nIf you experiment in data assimilation you might also want to change scr/include.ass","category":"page"},{"location":"QuickStart/QuickStartLocal/#Start-your-experiment-1","page":"Local","title":"Start your experiment","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Launch the experiment by giving start time, DTG, end time, DTGEND, and forecast length, LL","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie start DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH LL=12\n# e.g., PATH_TO_HARMONIE/Harmonie start DTG=2012122400 DTGEND=2012122406 LL=12","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"If you would like to only run long forecasts at 00/12 UTC and short (3h) at 03/06/09/15/18/21, you specify the longer forecast length as LLMAIN. ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie start DTG=2012122400 LLMAIN=24","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"If successful, ecflow will identify your experiment name and start building your binaries and run your forecast. If not, you need to examine the mSMS log file $HM_DATA/mSMS.log. $HM_DATA is defined in your Env_system file. At ECMWF $HM_DATA=$SCRATCH/hm_home/$EXP where $EXP is your experiment name. Read more about where things happen further down.","category":"page"},{"location":"QuickStart/QuickStartLocal/#Continue-your-experiment-1","page":"Local","title":"Continue your experiment","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"If your experiment have successfully completed and you would like to continue for another period you should write","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie prod DTGEND=YYYYMMDDHH LL=12 ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"By using prod you tell the system that you are continuing the experiment and using the first guess from the previous cycle. The start date is take from a file progress.log created in your $HOME/hm_home/my_exp directory. If you would have used start the initial data would have been interpolated from the boundaries, a cold start in other words.","category":"page"},{"location":"QuickStart/QuickStartLocal/#Start/Restart-of-mXCdp-1","page":"Local","title":"Start/Restart of mXCdp","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"To start the graphical window for mSMS on ecgb type","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie mon","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"The graphical window, mXCdp runs independently of the mSMS job and can be closed and restarted again with the same command. With the graphical interface you can control and view logfiles of each task. ","category":"page"},{"location":"QuickStart/QuickStartLocal/#Making-local-changes-1","page":"Local","title":"Making local changes","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Very soon you will find that you need to do changes in a script or in the source code. Once you have identified which file to edit you put it into the current $HOME/hm_home/my_exp directory, with exactly the same subdirectory structure as in the reference. e.g, if you want to modify a namelist setting ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"cd $HOME/hm_home/my_exp\nPATH_TO_HARMONIE/config-sh/Harmonie co nam/harmonie_namelists.pm         # retrieve default namelist harmonie_namelists.pm\nvi nam/harmonie_namelists.pm                        # modify the namelist","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Next time you run your experiment the changed file will be used. You can also make changes in a running experiment. Make the change you wish and rerun the InitRun task in the mXCdp window. The !InitRun task copies all files from your local experiment directory to your working directory $HM_DATA. Once your InitRun task is complete your can rerun the task you are interested in. If you wish to recompile something you will also have to rerun the Build tasks. Read more about how to control and rerun tasks in mini-SMS from mXCdp.","category":"page"},{"location":"QuickStart/QuickStartLocal/#Directory-structure-1","page":"Local","title":"Directory structure","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"On most platforms HARMONIE compiles and produces all its output data under HM_DATA (defined in ~/hmhome/myexp/Env_system)","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"= Description                            = = Location                                                                                  =\nBinaries $BINDIR (set in ecf/config_exp.h ), default is $HM_DATA/bin\nlibraries, object files & source code $HM_DATA/lib/src if MAKEUP=yes, $HMDATA/gmkpack_build if MAKEUP=no\nScripts $HM_DATA/lib/scr\nconfig files (Envsystem & Envsystem $HM_DATA/lib linked to files in $HM_DATA/config-sh\nsms $HM_DATA/lib/sms\nmsms definitions $HM_DATA/lib/msms\nUtilities such as gmkpack, gl & monitor $HM_DATA/lib/util\nClimate files $HM_DATA/climate\nWorking directory for the current cycle $HM_DATA/YYYYMMDD_HH\nArchived files $HM_DATA/archive\nArchived cycle output $HM_DATA/archive/YYYY/MM/DD/HH\nArchived log files $HM_DATA/archive/log/HM_TaskFamily_YYYYMMDDHH.html where TaskFamily=MakeCycleInput,Date,Postprocessing\nTask log files $JOBOUTDIR (set in Env_system) usually $HM_DATA/sms_logfiles\nVerification data (vfld/vobs/logmonitor) $HM_DATA/archive/extract\nVerification (monitor) results $HM_DATA/archive/extract/WebgraF\n\"Fail\" directory $HM_DATA/YYYYMMDD_HH/Failed_Family_Task (look at ifs.stat,NODE.001_01, fort.4","category":"page"},{"location":"QuickStart/QuickStartLocal/#Archive-contents-1","page":"Local","title":"Archive contents","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"$HM_DATA/archive/YYYY/MM/DD/HH is used to store \"archived\" output from HARMONIE cycles. The level of archiving depends on ARSTRATEGY in ecf/config_exp.h . The default setting is medium which will keep the following cycle data:","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Surface analysis: ICMSHANAL+0000\nAtmospheric analysis result: MXMIN1999+0000\nBlending between surface/atmospheric analysis and cloud variable from the first guess: ANAB1999+0000\nICMSHHARM+NNNN and ICMSHHARM+NNNN.sfx are atmospheric and surfex forecast output files\nPFHARM* files produced by the inline postprocessing \nGRIB files produced by the conversion of FA output files to GRIB if MAKEGRIB=yes in ecf/config_exp.h \nODB databases and feedback information in odb_stuff.tar","category":"page"},{"location":"QuickStart/QuickStartLocal/#Cleanup-of-old-experiments-1","page":"Local","title":"Cleanup of old experiments","text":"","category":"section"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Once you have complete your experiment you may wish to remove code, scripts and data from the disks. Harmonie provides some simple tools to do this. First check the content of the different disks by","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":" Harmonie CleanUp -ALL","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"Once you have convinced yourself that this is OK you can proceed with the removal.","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":" Harmonie CleanUp -ALL -go ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"If you would like to exclude the data stored  HM_DATA ( as defined in Env_system ) you run ","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":" Harmonie CleanUp -d","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"to list the directories intended for cleaning. Again, convince yourself that this is OK and proceed with the cleaning by","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":" Harmonie CleanUp -d -go","category":"page"},{"location":"QuickStart/QuickStartLocal/#","page":"Local","title":"Local","text":"NOTE that these commands may not work properly in all versions. Do not run the removal before you're sure it's OK","category":"page"},{"location":"Overview/Source/#Harmonie-Source-Code-1","page":"Source","title":"Harmonie Source Code","text":"","category":"section"},{"location":"Overview/Source/#Introduction-1","page":"Source","title":"Introduction","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"This wiki page summaries the ARPEGE/IFS source code made available in the HARMONIE system. It is based on documents made available by YESSAD K. (METEO-FRANCE/CNRM/GMAP/ALGO). The relevant document for cycle 40 is available here (or directly here). Documents for other versions are available in the \"References and documentation\" section. This page used the 40T1 document.","category":"page"},{"location":"Overview/Source/#HARMONIE-Source-Library-Structure-1","page":"Source","title":"HARMONIE Source Library Structure","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"The main source of HARMONIE system originates from IFS/ARPEGE and it consists of a number of \"project\" sources. These are:","category":"page"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"aeolus: Aeolous source code, a package for pre-processing satellite lidar wind data. Inactive for us.\naladin: specific routines only relevant to LAM, (limited area models, in particular ALADIN and AROME).\nalgor: application routines, e.g. to read LFI or Arpege files,interface routines for distributed memory environment, some linear algebra routines, such as lanczos algorithm, minimizers.\narpifs: global model routines (ARPEGE, IFS), and routines common to global and LAM models. This is the core of the ARPEGE/IFS software. The core of ARPEGE/IFS software.\nbiper: Biperiodization routines for the LAM\nblacklist: package for blacklisting\ncoupling: lateral coupling and spectral nudging for LAM models\netrans: spectral transforms for plane geometry, used for LAM\nifsaux: some application routines, for example reading or writing on “LFI” or ARPEGE files, interface routines for distributed memory environment\nmpa: upper air meso-NH/AROME physics (also used in ARPEGE/ALADIN)\nmse: surface processes in meso-NH/AROME (interface for SURFEX)\nodb: ODB (Observational Data Base software), needed by ARPEGE/ALADIN for their analysis or their assimilation cycle\nsatrad: satellite data handling package, needed to run the model analysis/assimilation\nsurf: ECMWF surface scheme\nsurfex: surface processes in meso-NH/AROME - the externalized surface scheme SURFEX\ntrans: spectral transforms for spherical geometry, used for ARPEGE/IFS\nutilities: utility packages, for operational FA to GRIB (PROGRID), OULAN, BATOR, or programs to operate on ODB and radiances bias correction","category":"page"},{"location":"Overview/Source/#Dependencies-and-hierarchy-between-each-project-1","page":"Source","title":"Dependencies and hierarchy between each project","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"Note: these project names are no longer valid – need to update","category":"page"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"ARP+TFL+XRD+XLA+MPA+MSE+SURFEX: for ARPEGE forecasts with METEO-FRANCE physics.\nARP+ALD+TFL+TAL+XRD+XLA+BIP+MPA+MSE+SURFEX: for ALADIN or AROME forecasts.\nARP+TFL+XRD+XLA+SUR: for IFS forecasts with ECMWF physics.\nARP+TFL+XRD+XLA+MPA+MSE+SURFEX+BLA+ODB+SAT+AEO: for ARPEGE assimilations with METEO-FRANCE physics.\nARP+ALD+TFL+TAL+XRD+XLA+BIP+MPA+MSE+SURFEX+BLA+ODB+SAT+AEO: for ALADIN or AROME assimilations.\nARP+TFL+XRD+XLA+SUR+BLA+ODB+SAT+OBT+SCR+AEO: for IFS assimilations with ECMWF physics.","category":"page"},{"location":"Overview/Source/#Libraries-under-each-project-1","page":"Source","title":"Libraries under each project","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"Note: this information made need to be updated for CY40","category":"page"},{"location":"Overview/Source/#ARPIFS-1","page":"Source","title":"ARPIFS","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"adiab\nAdiabatic dynamics\nAdiabatic diagnostics and intermediate quantities calculation, for example the geopotential height (routines GP... or GNH...).\nEulerian advections\nSemi-Lagrangian advection and interpolators (routines LA...)\nSemi-implicit scheme and linear terms calculation (routines SI..., SP..SI..)\nHorizontal diffusion (routines SP..HOR..)\nald inc\nfunction: functions used only in ALADIN\nnamelist: namelists read by ALADIN.\nc9xx: specific configurations 901 to 999 routines (mainly configuration 923). Routines INCLI.. are used in configuration 923. Routines INTER... are interpolators used in configurations 923, 931, 932.\ncanari: routines used in the CANARI optimal interpolation. Their names generally starts by CA.\ncanari common: empty directory to be deleted.\nclimate: some specific ARPEGE-CLIMAT routines.\ncommon: often contains includes\ncontrol: control routines. Contains in particular STEPO and CNT... routines.\ndfi: routines used in the DFI (digital filter initialisation) algorithm\ndia: diagnostics other than FULL-POS. One finds some setup SU... routines specific to some diagnostics and some WR... routines doing file writing.\nfunction: functions (in includes). The qa....h functions are used in CANARI, the fc....h functions are used in a large panel of topics.\ninterface: not automatic interfaces (currently empty).\nkalman: Kalman filter.\nmodule: all the types of module (variables declarations, type definition, active code).\nmwave: micro-wave observations (SSM/I) treatment.* namelist: all namelists.\nnmi: routines used in the NMI (normal mode initialisation) algorithm.\nobs error: treatment of the observation errors in the assimilation.\nobs preproc: observation pre-processing (some of them are called in the screening).\nocean: oceanic coupling, for climatic applications.\nonedvar: 1D-VAR assimilation scheme used at ECMWF.\nparallel: parallel environment, communications between processors.\nparameter: empty directory to be deleted.\nphys dmn: physics parameterizations used at METEO-FRANCE, and HIRLAM physics, ALARO physics.\nphys ec: ECMWF physics. Some of these routines (FMR radiation scheme, Lopez convection scheme) are now also used in the METEO-FRANCE physics.\npointer: empty directory to be deleted.\npp obs: several applications\nobservation horizontal and vertical interpolator. \nFULL-POS. \nvertical interpolator common to FULL-POS and the observation interpolator; some of these routines may be used elsewhere.\nsetup: setup routines not linked with a very specific domain. More specific setup routines are spread among some other subdirectories.\nsinvect: singular vectors calculation (configuration 601).\nsupport: empty directory to be deleted.\ntransform: hat routines for spectral transforms.\nutility: miscellaneous utilitaries, linear algebra routines, array deallocation routines.\nvar: routines involved in the 3DVAR and 4DVAR assimilation, some minimizers (N1CG1, CONGRAD), some specific 3DVAR and 4DVAR setup routines.\nwave: empty directory to be deleted.","category":"page"},{"location":"Overview/Source/#ALADIN-1","page":"Source","title":"ALADIN","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"adiab: adiabatic dynamics.\nblending: blending scheme (currently only contains the procedure blend.ksh).\nc9xx: specific configurations E901 to E999 routines (mainly configuration E923). Routines EINCLI.. are used in configuration E923. Routines EINTER... are interpolators used in configurations E923, E931, E932.\ncontrol: control routines.\ncoupling: lateral coupling by external lateral boundary conditions.\ndia: diagnostics other than FULL-POS.\ninidata: setup routines specific to file reading (initial conditions, LBC).\nmodule: active code modules only used in ALADIN.\nobs preproc: observation pre-processing (some of them are called in the screening).\nparallel: parallel environment, communications between processors.\npp obs: several applications:\nobservation horizontal and vertical interpolator. \nFULL-POS.\nvertical interpolator common to FULL-POS and the observation interpolator; some of these routines may be used elsewhere.\nprograms: probably designed to contain procedures, but currently contains among others some blending routines, the place of which would be probably better in subdirectory \"blending\".\nsetup: setup routines not linked with a very specific domain. More specific setup routines are spread among some other subdirectories.\nsinvect: singular vectors calculation (configuration E601).\ntransform: hat routines for spectral transforms.\nutility: miscellaneous utilitaries, array deallocation routines.\nvar: routines involved in the 3DVAR and 4DVAR assimilation, some specific 3DVAR and 4DVAR setup routines.","category":"page"},{"location":"Overview/Source/#TFL-1","page":"Source","title":"TFL","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"build: contains procedures.\nexternal: routines which can be called from another project.\ninterface: not automatically generated interfaces which match with the \"external\" directory routines.\nmodule: all the types of module (variables declarations, type definition, active code).\ntpm ...F90: variable declaration + type definition modules. \nlt.... mod.F90: active code modules for Legendre transforms. \nft.... mod.F90: active code modules for Fourier transforms. \ntr.... mod.F90: active code modules for transpositions. \nsu.... mod.F90: active code modules for setup.\nprograms: specific entries which can be used for TFL code validation. These routines are not called elsewhere.   ","category":"page"},{"location":"Overview/Source/#TAL-1","page":"Source","title":"TAL","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"external: routines which can be called from another project.\ninterface: not automatically generated interfaces which match with the \"external\" directory routines.\nmodule: all the types of module (variables declarations, type definition, active code). \ntpmald ...F90: variable declaration + type definition modules. \nelt.... mod.F90: active code modules for N-S Fourier transforms. \neft.... mod.F90: active code modules for E-W Fourier transforms. \nsue.... mod.F90: active code modules for setup. \nprograms: specific entries which can be used for TAL code validation. These routines are not called elsewhere.                                                             ","category":"page"},{"location":"Overview/Source/#XRD-1","page":"Source","title":"XRD","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"arpege: empty directory to be deleted.\nbufr io: BUFR format files reading and writing.\ncma: CMA format files reading and writing.\nddh: DDH diagnostics.\nfa: ARPEGE (FA) files reading and writing.\ngrib io: ECMWF GRIB format files reading and writing.\ngrib mf: METEO-FRANCE GRIB format files reading and writing.\nioassign: empty directory to be deleted.\nlanczos: linear algebra routines for Lanczos algorithm.\nlfi: LFI format files reading and writing.\nminim: linear algebra routines for minimizations. Contains the M1QN3 (quasi-Newton) minimizer.\nmisc: miscellaneous decks.* module: all the types of module (variables declarations, type definition, active code). There are a lot of mpl...F90 modules for parallel environment (interface to MPI parallel environment).\nmrfstools: empty directory to be deleted.\nnewbufrio: empty directory to be deleted.\nnewcmaio: empty directory to be deleted.\nnot used: miscellaneous decks (unused decks to be deleted?).\npcma: empty directory to be deleted.\nsupport: miscellaneous routines. Some of them do Fourier transforms, some others do linear algebra.\nsvipc: contains only svipc.c .\nutilities: miscellaneous utilitaries.","category":"page"},{"location":"Overview/Source/#SUR-1","page":"Source","title":"SUR","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"build: contains procedures.\nexternal: routines which can be called from another project.* function: specific functions.\ninterface: not automatically generated interfaces which match with the \"external\" directory routines.\nmodule: all the types of module (variables declarations, type definition, active code).\nyos ...F90: variable declaration + type definition modules. \nsu.... mod.F90 but not surf.... mod.F90: active code modules for setup. \nsurf.... mod.F90, v.... mod.F90: other active code modules.\noffline: specific entries which can be used for SUR code validation. These routines are not called elsewhere.","category":"page"},{"location":"Overview/Source/#BLA-1","page":"Source","title":"BLA","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"compiler.\ninclude: not automatically generated interfaces, functions, and some other includes.\nlibrary: the only containing .F90 decks.\nold2new.\nscripts.","category":"page"},{"location":"Overview/Source/#SAT-1","page":"Source","title":"SAT","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"bias.\nemiss.\ninterface.\nmodule.\nmwave.\nonedvar.\npre screen.\nrtlimb.\nrttov.\nsatim.\ntest. (Not described in detail; more information has to be provided by someone who knows the content of this project, but there is currently no specific documentation about this topic)","category":"page"},{"location":"Overview/Source/#UTI-1","page":"Source","title":"UTI","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"add cloud fields: program to add 4 cloud variables (liquid water, ice, rainfall, snow) in ARPEGE files.\nbator: BATOR software (reads observations data in a ASCII format file named OBSOUL and the blacklist, writes them on a ODB format file with some additional information).\ncombi: combination of perturbations in an ensemble forecast (PEARP).\ncontrodb: control of the number of observations.\nextrtovs: unbias TOVS.\nfcq: does quality control and writes this quality control in ODB files.\ngobptout: PROGRIB? (convert ARPEGE files contained post-processed data into GRIB files).\ninclude: all .h decks (functions, COMMON blocks, parameters).\nmandalay: software MANDALAY.\nmodule: all types of modules.\nnamelist: namelists specific to the applications stored in UTI (for example OULAN, BATOR).\noulan: OULAN software (the step just before BATOR: observation extractions in the BDM, samples data in space and time, and writes the sampled data in an ASCII file called \"OBSOUL\").\npregpssol: Surface GPS processing.\nprescat: Scatterometer data processing.\nprogrid: PROGRID? (convert ARPEGE files contained post-processed data into GRIB files).\nprogrid cadre: cf. progrid?\nsst nesdis: program to read the SST on the BDAP. This project has its own entries.","category":"page"},{"location":"Overview/Source/#MPA-1","page":"Source","title":"MPA","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"It contains first layer of directory","category":"page"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"chem: chemistry.\nconv: convection.\nmicro: microphysics.\nturb: turbulence.","category":"page"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"Each directory contains the following subdirectories","category":"page"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"externals: routines which can be called from another project.\ninclude: all the \"include\" decks (functions, COMMON blocks, parameters).\ninterface: not automatically generated interfaces which match with the \"external\" directory routines.\ninternals: other non-module routines; they cannot be called from another project.\nmodule: all types of modules.","category":"page"},{"location":"Overview/Source/#SURFEX-1","page":"Source","title":"SURFEX","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"ASSIM: Surface assimilation routines (please note that programs soda.F90, oi_main.F90 and varassim.F90 are located under mse/programs).\nOFFLIN: Surface offline routines (please note that programs pgd.F90, prep.F90 and offline.F90 are located under mse/programs).\nSURFEX: Surface routines for physiography (PGD), initialisation (PREP) and physical processes including e.g. land (ISBA), sea, town (TEB) and lakes.\nTOPD: TOPMODEL (TOPography based MODEL) for soil hydrology.\nTRIP: River routing model TRIP","category":"page"},{"location":"Overview/Source/#MSE-1","page":"Source","title":"MSE","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"dummy: empty versions of some routines.\nexternals: routines which can be called from another project.\ninterface: not automatically generated interfaces which match with the \"external\" directory routines.\ninternals: other non-module routines; they cannot be called from another project.\nmodule: all types of modules.\nnew: file conversion routines, e.g. fa2lfi, lfi2fa\nprograms: SURFEX programs","category":"page"},{"location":"Overview/Source/#References-and-documentation-1","page":"Source","title":"References and documentation","text":"","category":"section"},{"location":"Overview/Source/#","page":"Source","title":"Source","text":"Yessad K.: Jul 2015: LIBRARY ARCHITECTURE AND HISTORY OF THE TECHNICAL ASPECTS IN ARPEGE/IFS, ALADIN AND AROME IN THE CYCLE 42 OF ARPEGE/IFS\nYessad K.: Mar 2014: LIBRARY ARCHITECTURE AND HISTORY OF THE TECHNICAL ASPECTS IN ARPEGE/IFS, ALADIN AND AROME IN THE CYCLE 40T1 OF ARPEGE/IFS\nYessad K.: Jul 2013: LIBRARY ARCHITECTURE AND HISTORY OF THE TECHNICAL ASPECTS IN ARPEGE/IFS, ALADIN AND AROME IN THE CYCLE 40 OF ARPEGE/IFS\nYessad K.: Nov 2011: BASICS ABOUT ARPEGE/IFS, ALADIN AND AROME IN THE CYCLE 38 OF ARPEGE/IFS\nYessad K.: Nov 2011: LIBRARY ARCHITECTURE AND HISTORY OF THE TECHNICAL ASPECTS IN ARPEGE/IFS, ALADIN AND AROME IN THE CYCLE 38 OF ARPEGE/IFS","category":"page"},{"location":"System/GitDeveloperDocumentation/#Developing-in-the-Hirlam-GitHub-organization-1","page":"GitHub","title":"Developing in the Hirlam GitHub organization","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#Introduction-1","page":"GitHub","title":"Introduction","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Since 2018 and CY43 HIRLAM have used git for code revision control and gitolite as the git server on hirlam.org. HIRLAM is now moving to using Github for ''software development and version control''. This page provides information on how to access the GitHub Hirlam organisation and how to commit your developments, specifically Harmonie. As was the case with hirlam.org's gitolite a fork-and-branch workflow will be used to manage developments.","category":"page"},{"location":"System/GitDeveloperDocumentation/#Becoming-a-member-of-Hirlam-1","page":"GitHub","title":"Becoming a member of Hirlam","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Create a GitHub account: https://github.com – click on Sign up. Details here\nAdd your public ssh key(s) to the account. Details here\nContact your friendly System-core to be invited to the GitHub Hirlam organisation","category":"page"},{"location":"System/GitDeveloperDocumentation/#Fork-and-branch-1","page":"GitHub","title":"Fork and branch","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"You can create a user fork of Harmonie by doing the following:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Go to https://github.com/Hirlam/Harmonie\nClick on Fork to create a fork of Harmonie for your user (USER)\nClone your fork:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git clone git@github.com:USER/Harmonie.git $HOME/git_harmonie/USER/Harmonie","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Further information is available here: https://docs.github.com/en/github/getting-started-with-github/fork-a-repo ","category":"page"},{"location":"System/GitDeveloperDocumentation/#Keep-your-fork-synced-1","page":"GitHub","title":"Keep your fork synced","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"In a terminal change directory to the clone of you fork:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"List the current configured remote repository for your fork.","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git remote -v\norigin\tgit@github.com:USER/Harmonie.git (fetch)\norigin\tgit@github.com:USER/Harmonie.git (push)","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Specify a new remote upstream repository that will be synced with the fork.","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git remote add upstream git@github.com:Hirlam/Harmonie.git","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Verify the new upstream repository you've specified for your fork.","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git remote -v\norigin\tgit@github.com:ewhelan/Harmonie.git (fetch)\norigin\tgit@github.com:ewhelan/Harmonie.git (push)\nupstream\tgit@github.com:Hirlam/Harmonie.git (fetch)\nupstream\tgit@github.com:Hirlam/Harmonie.git (push)","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Update develop in your fork.","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git checkout develop\n$ git pull upstream develop\n$ git push origin develop","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Update pre-CY46h1 in your fork.","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ git checkout pre-CY46h1\n$ git pull upstream pre-CY46h1\n$ git push origin pre-CY46h1","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Further information is available here: https://docs.github.com/en/github/getting-started-with-github/fork-a-repo#keep-your-fork-synced","category":"page"},{"location":"System/GitDeveloperDocumentation/#Contributing-developments-–-develop-1","page":"GitHub","title":"Contributing developments – develop","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Contributions for develop should be developed in your Harmonie fork in a development branch (feature/bugfix/...). The following details how you can get your development upstream.","category":"page"},{"location":"System/GitDeveloperDocumentation/#Create-a-feature-branch-1","page":"GitHub","title":"Create a feature branch","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout develop\n$ git checkout -b feature/descriptive_name_for_developments","category":"page"},{"location":"System/GitDeveloperDocumentation/#Keep-up-to-date-with-develop-1","page":"GitHub","title":"Keep up to date with develop","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Sync your fork as described above\nMerge develop updates in to your branch","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout feature/descriptive_name_for_developments\n$ git merge develop","category":"page"},{"location":"System/GitDeveloperDocumentation/#Creating-a-pull-request-1","page":"GitHub","title":"Creating a pull request","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Once you have committed to your feature branch and wanted them included in the upstream repo you should do the following:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Push your branch to your fork:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout feature/descriptive_name_for_developments\n$ git push origin feature/descriptive_name_for_developments","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"When you push your branch information on how to create a pull request will be presented:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"remote: Resolving deltas: 100% (x/x), completed with x local objects.\nremote: \nremote: Create a pull request for 'feature/descriptive_name_for_developments' on GitHub by visiting:\nremote:      https://github.com/USER/Harmonie/pull/new/feature/descriptive_name_for_developments\nremote: ","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Follow this link","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"request a reviewer\nadd labels to the developemnt (feature/enhancement/...)\nadd comments to help with the review process (Testbed members used/Changes expected if any/...)","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Once the pull request has been approved by the System-core team it will be merged in to develop","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Further information is available here: https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request","category":"page"},{"location":"System/GitDeveloperDocumentation/#Contributing-developments-–-pre-CY46h1-1","page":"GitHub","title":"Contributing developments – pre-CY46h1","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Contributions to pre-CY46h1 should be developed in your Harmonie fork in a development branch (feature/bugfix/...). The following details how you can get your development ''upstream''.","category":"page"},{"location":"System/GitDeveloperDocumentation/#Create-a-''feature''-branch-1","page":"GitHub","title":"Create a ''feature'' branch","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout pre-CY46h1\n$ git checkout -b feature/descriptive_name_for_developments","category":"page"},{"location":"System/GitDeveloperDocumentation/#Keep-up-to-date-with-pre-CY46h1-1","page":"GitHub","title":"Keep up to date with pre-CY46h1","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Sync your fork as described above\nMerge develop updates in to your branch","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout feature/descriptive_name_for_developments\n$ git merge pre-CY46h1","category":"page"},{"location":"System/GitDeveloperDocumentation/#Creating-a-pull-request-2","page":"GitHub","title":"Creating a pull request","text":"","category":"section"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Once you have committed to your feature branch and wanted them included in the upstream repo you should do the following:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Push your branch to your fork:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"$ cd $HOME/git_harmonie/USER/Harmonie\n$ git checkout feature/descriptive_name_for_developments\n$ git push origin feature/descriptive_name_for_developments","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"When you push your branch information on how to create a pull request will be presented:","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"remote: Resolving deltas: 100% (x/x), completed with x local objects.\nremote: \nremote: Create a pull request for 'feature/descriptive_name_for_developments' on GitHub by visiting:\nremote:      https://github.com/USER/Harmonie/pull/new/feature/descriptive_name_for_developments\nremote: ","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Follow this link","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"request a reviewer\nadd labels to the developemnt (feature/enhancement/...)\nadd comments to help with the review process (Testbed members used/Changes expected if any/...)","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Once the pull request has been approved by the System-core team it will be merged in to develop","category":"page"},{"location":"System/GitDeveloperDocumentation/#","page":"GitHub","title":"GitHub","text":"Further information is available here: https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request","category":"page"},{"location":"System/GitDeveloperDocumentation/#Moving-my-branches-from-hirlam.org-1","page":"GitHub","title":"Moving my branches from hirlam.org","text":"","category":"section"}]
}
